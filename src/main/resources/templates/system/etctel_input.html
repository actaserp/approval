<html layout:decorate="~{layout_page}" xmlns:layout="http://www.w3.org/1999/xhtml">
<style>

</style>
<th:block layout:fragment="content">

    <div class="layout-contents">
        <!-- Page Title -->
        <div class="page-title-wrap">
            <div class="left">
                <h2>비상연락망등록</h2>
                <a  title="북마크" class="bookmark toggle">
                    내메뉴
                </a>
            </div>
            <ul class="page-navi">
                <li><img src="/images/icon/ico-nav-home.svg" alt="홈아이콘"></li>
                <li>시스템관리</li>
                <li>비상연락망등록</li>
            </ul>
        </div>
        <!-- Select -->
        <div class="search-wrap">
            <ul>
                <li>
                    <select title="지역">
                        <option>대구</option>
                    </select>
                </li>
                <li>
                    <select title="구">
                        <option>성서산단</option>
                    </select>
                </li>
                <li>
                    <select title="동">
                        <option>성서</option>
                    </select>
                </li>
            </ul>
        </div>
        <div class="tab-wrap">
            <ul class="tab-links">
                <li>
                    <a href="#tab1" title="목록">목록</a>
                </li>
                <li>
                    <a href="#tab2" title="등록">등록</a>
                </li>
            </ul>
            <div class="tab-contents">
                <!-- Section -->
                <section class="tab-item" id="tab1">
                    <div class="section-top">
                        <div class="search-wrap">
                            <dl>
                                <dt>
                                    <label for="select1">
                                        협력사 <span class="eq">*</span>
                                    </label>
                                </dt>
                                <dd>
                                    <select id="select1" class="w120">
                                        <option>전체</option>
                                        <option>대구에너지</option>
                                        <option>경북에너지</option>
                                    </select>
                                </dd>
                            </dl>
                            <dl>
                                <dt>
                                    <label for="text1">
                                        성명<span class="eq">*</span>
                                    </label>
                                </dt>
                                <dd>
                                    <div class="srch-box">
                                        <input type="text" id="checkusr" name="checkusr" class="input-srch">
                                        <!--                                        <a href="#a" class="btn-srch" id="searchgrid" title="검색" onclick="searchData()" onkeyup="searchData()"></a>-->
                                    </div>
                                </dd>
                            </dl>
                            <dl>
                                <dt>
                                    <label for="text2">
                                        모바일<span class="eq">*</span>
                                    </label>
                                </dt>
                                <dd>
                                    <div class="srch-box">
                                        <input type="text" id="checkph" name="checkph" class="input-srch">
                                        <a class="btn-srch" id="searchgrid" title="검색" onclick="searchData()"
                                           onkeyup="searchData()"></a>
                                    </div>
                                </dd>
                            </dl>
                        </div>
                        <div class="button-wrap">
                            <ul>
                                <li>
                                    <a  class="btn btn-excell" title="엑셀다운로드">
                                        <img src="/images/icon/ico-excell.svg" alt="엑셀 아이콘">
                                        엑셀다운로드
                                    </a>
                                </li>
                                <li>
                                    <a  class="btn btn-delete" title="삭제">
                                        <img src="/images/icon/ico-delete.svg" alt="엑셀 아이콘">
                                        삭제
                                    </a>
                                </li>
                                <li>
                                    <a  class="btn btn-edit" title="수정">
                                        <img src="/images/icon/ico-edit.svg" alt="엑셀 아이콘">
                                        수정
                                    </a>
                                </li>
                                <!--                                <li>-->
                                <!--                                    <a href="#" class="btn btn-print" title="순회점검일지 출력">-->
                                <!--                                        <img src="/images/icon/ico-print.svg" alt="엑셀 아이콘">-->
                                <!--                                        순회점검일지 출력-->
                                <!--                                    </a>-->
                                <!--                                </li>-->
                            </ul>
                        </div>
                    </div> <!--//section-top end -->
                    <div class="container-fluid">
                        <p id="selectedItem"></p>
                        <div id="theGrid" style="height: 400px"></div>
                    </div>
                </section>


                <!-- Section -->
                <section class="tab-item" id="tab2">
                    <div class="section-top">
                        <div class="title-wrap">
                            <h3>비상연락망등록</h3>
                        </div>
                        <div class="button-wrap">
                            <ul>
                                <li>
                                    <a  class="btn btn-excell" title="엑셀다운로드">
                                        <img src="/images/icon/ico-plus.svg" alt="등록 아이콘">
                                        신규등록
                                    </a>
                                </li>
                                <li>
                                    <a  class="btn btn-delete" title="삭제">
                                        <img src="/images/icon/ico-delete.svg" alt="삭제 아이콘">
                                        삭제
                                    </a>
                                </li>
                                <li>
                                    <a class="btn btn-edit" id="btnSave" title="저장">
                                        <img src="/images/icon/ico-save.svg" alt="저장 아이콘">
                                        저장
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="table-wrap">
                        <form id="980_form">
                            <input type="hidden" id="emcontno" name="emcontno">
                            <input type="hidden" id="inuserid" name="inuserid">
                            <input type="hidden" id="inusernm" name="inusernm">
                            <table class="write-table">
                                <caption>비상연락망등록 테이블</caption>
                                <colgroup>
                                    <col class="wp12">
                                    <col class="wp40">
                                    <col class="wp12">
                                    <col class="wp40">
                                </colgroup>
                                <tbody>
                                <tr>
                                    <th>
                                        <label for="emconcomp">
                                            협력사명
                                        </label>
                                    </th>
                                    <td>
                                        <ul>
                                            <li>
                                                <select title="지역">
                                                    <option>대구</option>
                                                </select>
                                            </li>
                                        </ul>
                                    </td>
                                    <th>
                                        <label for="divinm">
                                            소속부서
                                        </label>
                                    </th>
                                    <td>
                                        <input type="text" id="divinm" name="divinm" class="wp100" maxlength="50">
                                    </td>
                                </tr>

                                <tr>
                                    <th>
                                        <label for="emconper">
                                            성명
                                        </label>
                                    </th>
                                    <td>
                                        <input type="text" id="emconper" name="emconper" class="wp100" maxlength="50">
                                    </td>
                                    <th>
                                        <label for="emconmno">
                                            모바일
                                        </label>
                                    </th>
                                    <td>
                                        <input type="text" id="emconmno" name="emconmno" class="wp100" maxlength="50">
                                    </td>
                                </tr>


                                <tr>
                                    <th>
                                        <label for="emconemail">
                                            이메일
                                        </label>
                                    </th>
                                    <td>
                                        <input type="text" id="emconemail" name="emconemail" class="wp100"
                                               maxlength="50">
                                    </td>
                                    <th>
                                        <label for="emcontel">
                                            사무실전화
                                        </label>
                                    </th>
                                    <td>
                                        <input type="text" id="emcontel" name="emcontel" class="wp100" maxlength="50">
                                    </td>
                                </tr>

                                <tr>
                                    <th>
                                        <label for="spworkcd">
                                            지역
                                        </label>
                                    </th>
                                    <td>
                                        <ul>
                                            <li>
                                                <select title="지역">
                                                    <option>대구</option>
                                                </select>
                                            </li>
                                        </ul>
                                    </td>
                                    <th>
                                        <label for="spcompcd">
                                            산단
                                        </label>
                                    </th>
                                    <td>
                                        <ul>
                                            <li>
                                                <select title="구">
                                                    <option>성서산단</option>
                                                </select>
                                            </li>
                                        </ul>
                                    </td>
                                </tr>

                                <tr>
                                    <th>
                                        <label for="taskwork">
                                            담당업무
                                        </label>
                                    </th>
                                    <td>
                                        <input type="text" id="taskwork" name="taskwork" class="wp100" maxlength="50">
                                    </td>
                                    <th>
                                        <label for="indatem">
                                            생성일시
                                        </label>
                                    </th>
                                    <td>
                                        <input type="text" id="" name="" autocomplete="off" readonly value="2024.07.04">
                                    </td>
                                </tr>

                                </tbody>
                            </table>
                        </form>
                    </div>
                </section>
            </div> <!--//tab-contens end-->
        </div> <!--//tab-wrap end-->
    </div> <!--//layout-contents end -->

<!--    &lt;!&ndash; 팝업 &ndash;&gt;-->
<!--    <div class="modal">-->

<!--        <div class="popup-wrapper w700" id="popup1">-->
<!--            <div class="popup-title">-->
<!--                <h3>점검일지 업로드</h3>-->
<!--                <a href="#" title="팝업닫기" onclick="closePopup()" class="btn-popup-close">-->
<!--                    <img src="/images/icon/btn-popup-close.svg" alt="닫기">-->
<!--                </a>-->
<!--            </div>-->
<!--            <div class="popup-contents">-->
<!--                <div class="table-wrap">-->
<!--                    <table class="write-table">-->
<!--                        <caption>점검등록 테이블</caption>-->
<!--                        <colgroup>-->
<!--                            <col class="wp20">-->
<!--                            <col class="wp80">-->
<!--                        </colgroup>-->
<!--                        <tbody>-->
<!--                        <tr>-->
<!--                            <th>-->
<!--                                <label for="date6">-->
<!--                                    등록일자-->
<!--                                </label>-->
<!--                            </th>-->
<!--                            <td>-->
<!--                                <div class="input-clear">-->
<!--                                    <input type="date" id="date6" name="" value="2024-06-27">-->
<!--                                </div>-->
<!--                            </td>-->
<!--                        </tr>-->
<!--                        <tr>-->
<!--                            <th>-->
<!--                                <label for="popuptext1">-->
<!--                                    점검자-->
<!--                                </label>-->
<!--                            </th>-->
<!--                            <td>-->
<!--                                <div class="input-clear"><input type="text" id="popuptext1" class="wp60"-->
<!--                                                                placeholder="점검자"><span class="btn-clear">×</span></div>-->
<!--                            </td>-->
<!--                        </tr>-->
<!--                        <tr>-->
<!--                            <th>-->
<!--                                <label for="popuptext2">-->
<!--                                    점검장소-->
<!--                                </label>-->
<!--                            </th>-->
<!--                            <td>-->
<!--                                <div class="input-clear"><input type="text" id="popuptext2" class="wp100"-->
<!--                                                                placeholder="점검장소"><span class="btn-clear">×</span>-->
<!--                                </div>-->
<!--                            </td>-->
<!--                        </tr>-->
<!--                        <tr>-->
<!--                            <th>-->
<!--                                첨부파일-->
<!--                            </th>-->
<!--                            <td>-->
<!--                                <div id="uploadComponent2" class="upload-component">-->
<!--                                    <div class="upload-filebox">-->
<!--                                        <img src="/images/icon/ico-fileupload.svg" alt="업로드아이콘">-->
<!--                                        <a href="#" class="btn" title="파일업로드">파일업로드</a>-->
<!--                                        <input type="file" id="fileInput2" class="fileInput" multiple="">-->
<!--                                        <p>Maximun upload file size <span>1GiB</span></p>-->
<!--                                    </div>-->
<!--                                    <div class="upload-filelist">-->
<!--                                        <div class="title">-->
<!--                                            <h5>Files (0)</h5>-->
<!--                                            <a href="#" title="Delete all" class="btn-file-deleteall">Delete all</a>-->
<!--                                        </div>-->
<!--                                        <ul class="filelist">-->
<!--                                        </ul>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </td>-->
<!--                        </tr>-->
<!--                        </tbody>-->
<!--                    </table>-->
<!--                </div>-->
<!--            </div>-->
<!--            <div class="popup-button">-->
<!--                <button onclick="closePopup()"-->
<!--                        style="border: 1px solid #03428E !important; font-size: 15px !important;">취소-->
<!--                </button>-->
<!--                <button style="border: 1px solid #03428E !important;color: white;background: #03428E !important;font-size: 15px !important;">-->
<!--                    저장-->
<!--                </button>-->
<!--            </div>-->

<!--        </div>-->

<!--    </div>-->


</th:block>
<th:block layout:fragment="scripts">
    <th:block th:replace="/common/approve_box :: approve_box"></th:block>
    <th:block th:replace="/common/ax5_uploader :: ax5_uploader"></th:block>
    <th:block th:replace="/common/upload_one_image_box :: upload_one_image_box"></th:block>
    <th:block th:replace="/common/popup_select_user_code :: popup_select_user_code"></th:block>
    <script type="text/javascript">

        var theGrid;
        var viewdata;


        function closePopup() {
            const modal2 = document.querySelector('.modal');
            const modalOpen = document.querySelector('.popup-wrapper');
            modal2.style.display = 'none';
            modalOpen.style.display = 'none';
        }

        function showPopup() {

            const modal2 = document.querySelector('.modal');
            const modalOpen = document.querySelector('.popup-wrapper');
            modal2.style.display = 'block';
            modalOpen.style.display = 'block';
            /*var popup = document.getElementById('popup1');

            popup.style.display = 'block';*/
        }

        function submitTextarea(event){
            let key = event.key || event.keyCode;

            if(key === 'Enter' || key == 13){
                searchData();
            }
        }

        let searchusrval = document.getElementById('emconper');
        let searchusrval2 = document.getElementById('emconmno');

        searchusrval.addEventListener('keyup', event => submitTextarea(event))
        searchusrval2.addEventListener('keyup', event => submitTextarea(event))


        document.readyState === 'complete' ? init() : window.onload = init;


        <!-- 초반 페이지 진입시 그리드 바인딩 끝-->
        function init() {
            let data2 = [];
            let emconper = $('#emconper').val();
            let emconmno = $('#emconmno').val();
            this.base_url = '/api/system/tel_List';

            $.ajax({
                url: '/api/system/tel_List/read',
                type: 'GET',
                data: {
                    'emconper': emconper,
                    'emconmno': emconmno
                },
                async: false,
                success: function (data) {
                    console.log('wijmo', data.data);
                    data2 = data.data;
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.error('Error fetching log_list data:', textStatus, errorThrown);
                }
            });

            viewdata = new wijmo.collections.CollectionView(data2);
            // 데이터 그리드에 바인딩
            theGrid = new wijmo.grid.FlexGrid('#theGrid', {
                autoGenerateColumns: false,
                showMarquee: true,
                columns: [
                    {binding: 'rownum', header: 'NO', width: 80, align: 'center'},
                    {binding: 'workcd', header: '지역명', width: 140, align: 'center'},
                    {binding: 'compcd', header: '산단명', width: 140, align: 'center'},
                    {binding: 'emconcomp', header: '협력사', width: 140, align: 'center'},
                    {binding: 'indatem', header: '생성일시', width: 140, align: 'center'},
                    {binding: 'divinm', header: '소속부서', width: 140, align: 'center'},
                    {binding: 'emconper', header: '성명', width: 140, align: 'center'},
                    {binding: 'taskwork', header: '담당업무', width: 160, align: 'center'},
                    {binding: 'emcontel', header: '사무실전화', width: 140, align: 'center'},
                    {binding: 'emconmno', header: '모바일', width: 160, align: 'center'},
                    {binding: 'emconemail', header: '이메일', width: 160, align: 'center'},

                ],

                itemsSource: viewdata
            });

            // theGrid.setCellData(0,'workcd','대구');
            // theGrid.setCellData(0,'compcd','성서산단');
            // theGrid.setCellData(0,'emconcomp','레플러스');
            // theGrid.setCellData(0,'divinm','유지보수');
            // theGrid.setCellData(0,'taskwork','유지보수');




            // 선택이 변경될 때, 현재 항목 업데이트

            theGrid.rowHeaders.columns.splice(0, 1);  //맨 앞에 헤더부분 없애기
        }

        <!-- 초반 페이지 진입시 그리드 바인딩 끝-->



        <!-- 점검자 추가 버튼 이벤트 끝-->

        let filelist = [];

        function filevalueinit(param) {
            filelist = param;

        }

        let page = null;

        //검색
        function searchData() {
            let data = {
                'emconper': $('#emconper').val(),
                'emconmno' : $('#emconmno').val()
            }

            let result = AjaxUtil.getSyncData('/api/system/tel_List/read', data);

            if (result.success) {
                console.log(result.data);
                grid_binding(result.data);
            }
        }

        // 비상연락망 저장
        function saveTel(type) {
            let _this = this;

            let data = FormUtil.extractForm($('#980_form'));
            let fnSuccess = function (res) {
                data.type = type;
                console.log(res, "+", data);

                if (res.success) {
                    Notify.success("등록되었습니다.");

                    location.reload();
                } else if (!res.success) {
                    Alert.alert('', res.message);
                }
            };
            AjaxUtil.postAsyncData(_this.base_url + '/save', data, fnSuccess);
        }


        function delTel(){
            let _this = this;

            let data = {

            }
            let fnSuccess = function (res){

                if(res.success){
                    Notify.syccess("삭제되었습니다.");

                    location.reload();
                }else if(!res.success){
                    Alert.alert('',res.message);
                }
            };
            AjaxUtil.postAsyncData(_this.base_url+'/delete', data, fnSuccess);

        }

        function grid_binding(data){
            var tb_rp980Dto = data;
            var tb_rp980Data = [];
            console.log(tb_rp980Data+"/"+data);

            for (var i = 0; i < tb_rp980Dto.length; i++) {
                tb_rp980Data.push({
                    rownum: tb_rp980Dto[i]["rownum"],
                    workcd: tb_rp980Dto[i]["workcd"],
                    compcd: tb_rp980Dto[i]["compcd"],
                    emconcomp: tb_rp980Dto[i]["emconcomp"],
                    indatem: tb_rp980Dto[i]["indatem"],
                    divinm: tb_rp980Dto[i]["divinm"],
                    emconper: tb_rp980Dto[i]["emconper"],
                    taskwork: tb_rp980Dto[i]["taskwork"],
                    emcontel: tb_rp980Dto[i]["emcontel"],
                    emconmno: tb_rp980Dto[i]["emconmno"],
                    emconemail: tb_rp980Dto[i]["emconemail"],


                });

            }

            theGrid.columns.clear();
            theGrid.autoGenerateColumns = false;
            viewdata.sourceCollection = tb_rp980Data;

            for (var i =0; i <columns.length; i++){
                var col = new wijmo.grid.Column(columns[i]);
                theGrid.columns.push(col);
            }

            // var cols = new wijmo.grid.Column();
            // cols.binding = 'rownum';
            // cols.header = '순번';
            // cols.align = "center";
            // cols.width = 60;
            // theGrid.columns.push(cols);
            //
            // cols = new wijmo.grid.Column();
            // cols.binding = 'spworknm';
            // cols.header = '지역명';
            // cols.align = "center";
            // cols.width = 140;
            // theGrid.columns.push(cols);
            //
            // cols = new wijmo.grid.Column();
            // cols.binding = 'sspcompcd';
            // cols.header = '산단명';
            // cols.align = "center";
            // cols.width = 140;
            // theGrid.columns.push(cols);
            //
            // cols = new wijmo.grid.Column();
            // cols.binding = 'emconcomp';
            // cols.header = '협력사';
            // cols.align = "center";
            // cols.width = 140;
            // theGrid.columns.push(cols);
            //
            // cols = new wijmo.grid.Column();
            // cols.binding = 'indatem';
            // cols.header = '생성일시';
            // cols.align = "center";
            // cols.width = 140;
            // theGrid.columns.push(cols);
            //
            // cols = new wijmo.grid.Column();
            // cols.binding = 'divinm';
            // cols.header = '소속부서';
            // cols.align = "center";
            // cols.width = 140;
            // theGrid.columns.push(cols);
            //
            // cols = new wijmo.grid.Column();
            // cols.binding = 'emconper';
            // cols.header = '성명';
            // cols.align = "center";
            // cols.width = 200;
            // theGrid.columns.push(cols);
            //
            // cols = new wijmo.grid.Column();
            // cols.binding = 'taskwork';
            // cols.header = '담당업무';
            // cols.align = "center";
            // cols.width = 260;
            // theGrid.columns.push(cols);
            //
            // cols = new wijmo.grid.Column();
            // cols.binding = 'emcontel';
            // cols.header = '사무실전화';
            // cols.align = "center";
            // cols.width = 260;
            // theGrid.columns.push(cols);
            //
            // cols = new wijmo.grid.Column();
            // cols.binding = 'emconmno';
            // cols.header = '모바일';
            // cols.align = "center";
            // cols.width = 260;
            // theGrid.columns.push(cols);
            //
            // cols = new wijmo.grid.Column();
            // cols.binding = 'emconemail';
            // cols.header = '이메일';
            // cols.align = "center";
            // cols.width = 260;
            // theGrid.columns.push(cols);





        }

        $(document).ready(function (e) {


            // page = new CheckResultDiaryPage();


            // $('#btnSave').click(function (e){
            //     console.log("22")
            //
            //
            //     Alert.confirm('', '저장하시겠습니까?', function() {
            //
            //             let fileInput = document.getElementById('fileInput1');
            //             let files = fileInput.files;
            //             let formData = new FormData();
            //
            //             for (var i = 0; i < files.length; i++) {
            //                 formData.append('filelist', files[i]);
            //             }
            //
            //             const randomString = generateRandomStringWithDate();
            //
            //             var inputs = document.querySelectorAll('input[name="checkusr"]');
            //             var values = [];
            //
            //             inputs.forEach(function(input){
            //                 values.push(input.value);
            //
            //             })
            //
            //             var checkusrString = values.join(',');
            //
            //
            //
            //             // 다른 데이터를 FormData에 추가합니다.
            //             formData.append('workcd ', $('#workcd').val());
            //             formData.append('compcd', $('#compcd').val());
            //             formData.append('emconcomp', $('#emconcomp').val());
            //
            //             formData.append('indatem', $('#indatem').val());
            //             formData.append('checkusr', checkusrString); // 이미 문자열로 변환된 checkusr
            //             formData.append('divinm', $('#divinm').val());
            //             formData.append('emconper', $('#emconper').val());
            //             formData.append('taskwork', $('#taskwork').val());
            //             formData.append('emcontel', $('#emcontel').val());
            //             formData.append('emconmno', $('#emconmno').val());
            //             formData.append('emconemail', $('#emconemail').val());
            //
            //
            //
            //             $.ajax({
            //                 url: '/api/system/tel_List/save',
            //                 type: 'POST',
            //                 data: formData,
            //                 processData: false,  // 기본적으로 jQuery는 데이터를 문자열로 변환하려고 하므로 이를 비활성화
            //                 contentType: false,  // 기본적으로 jQuery는 Content-Type을 설정하려고 하므로 이를 비활성화
            //                 success: function (response) {
            //                     if(response.success){
            //                         Alert.alert('', response.message);
            //                     }
            //                 },
            //                 error: function (jqXHR, textStatus, errorThrown) {
            //                     Alert.alert('', '에러가발생하였습니다.');
            //                 }
            //             });
            //
            //
            //         },
            //         function () {}
            //
            //
            //     )
            // })

            $('#btnSave').click(function (e) {
                Alert.confirm('',
                    '등록하시겠습니까?',
                    function () {
                        saveTel("S")
                    },
                    function () {
                    // 취소 버튼을 눌렀을 때 처리
                    }
                );
            });


            $('#btnDelete').click(function(e){
                console.log('삭제버튼클릭');
                Alert.confirm('',
                '삭제하시겠습니까?',
                function() {
                    delTel()
                },
                    function(){
                    // 취소 버튼을 눌렀을 때 수행 하는 곳
                    }
                );
            });


            // page.setUploader();


        });
    </script>
</th:block>

</html>