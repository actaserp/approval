<!DOCTYPE html>
<html lang="ko" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="-1">
    <link rel="icon" type="image/png" href="/img/favicon.png">

    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" /> <!-- Slide css -->
    <link rel="stylesheet" href="/css/import.css"/>
    <link rel="stylesheet" href="/css/login_mes.css" />
    <link rel="stylesheet" href="/resource/ax5ui/ax5ui.all.css" />


    <title>SMART FOMS</title>
</head>
<body>

<div class="page-wrapper page-login"><!-- ★페이지 Class명 -->
    <div class="dashboard-login-wrap">
        <div class="login-wrap">
            <div class="left">
                <img src="/images/icon/login-img2.svg" alt="로그인 이미지">
            </div>
            <div class="right">
                <form method="post" class="form" role="form" id="loginFrm" action="/postLogin">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <div class="login-logo">
                    <img src="/images/logo/login-logo.png" alt="로고">
                </div>
                <div class="login-form">
                    <dl>
                        <dt><label for="loginId">아이디</label></dt>
                        <dd>
                            <input type="text" id="loginId" name="username" required autofocus title="아이디 입력" placeholder="아이디를 입력해주세요">
                        </dd>
                        <!-- 에러메시지 출력 -->
                        <dd class="hint-red" id="hint-red" style="display: none">
                            <img src="/images/icon/ico-info-red.svg" alt="힌트메세지">
                            계정이 맞지 않습니다.
                        </dd>
                    </dl>
                    <dl>
                        <dt><label for="loginPwd">비밀번호</label></dt>
                        <dd>
                            <input type="password" id="loginPwd" name="password" placeholder="비밀번호를 입력해주세요" required title="패스워드 입력" autocomplete="off">
                        </dd>
                        <!--<dd class="hint">
                            <img src="/images/icon/ico-info.svg" alt="힌트메세지">
                            힌트메세지
                        </dd>-->
                    </dl>
                    <div class="check-save">
                        <input type="checkbox" id="login_chk">
                        <label for="login_chk">아이디 저장</label>
                    </div>
                    <button type="submit" class="btn-login" id="login">로그인</button>
                    <ul class="btn-login-etc">
                        <li>
                            <a class="btn btn-popup-open" data-popup="popup1" title="사용자신청" onclick="RegisterUser()">사용자신청</a>
                        </li>
                        <li>
                            <a href="#" class="btn" title="아이디 찾기">아이디 찾기</a>
                        </li>
                        <li>
                            <a href="#" class="btn" title="비밀번호 찾기">비밀번호 찾기</a>
                        </li>
                    </ul>
                </div>
                </form>
            </div>
        </div>
        <p class="copyright">ⓒ Kt Corp. All rights reserved.</p>
    </div>
    <!-- [사용자권한] 팝업  -->
    <div class="dashboard-layout-popup">
        <div class="popup-overlay"  id="popup1"></div>
        <div class="popup-wrapper" id="wrapper1">
            <div class="popup-title">
                <h3>사용자권한신청</h3>
                <a onclick="RegisterUserClose()" title="팝업닫기" class="btn-popup-close">
                    <img src="/images/icon/btn-popup-close.svg" alt="닫기">
                </a>
            </div>
            <div class="popup-contents">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <form id="bomForm">
                <div class="table-wrap">
                    <table class="write-table">
                        <caption>사용자권한신청 테이블</caption>
                        <colgroup>
                            <col class="wp20">
                            <col class="wp30">
                            <col class="wp20">
                            <col class="wp30">
                        </colgroup>
                        <tbody>
                        <tr>
                            <th>
                                <label for="">
                                    소속사
                                </label>
                            </th>
                            <td>
                                <div class="input-clear">
                                    <!--<select class="mg-r5" id="agency" name="agency" style="width: 100%">
                                        <option value='CO_ID'>에너지발전소관련업체</option>
                                        <option value='C001'>블룸에너지</option>
                                        <option value='C002'>ESG Corp</option>
                                    </select>-->
                                    <select class="mg-r5" id="agency" name="agency" style="width: 100%">
                                        <option></option>
                                    </select>
                                </div>
                            </td>
                            <th>
                                <label for="">
                                    소속부서
                                </label>
                            </th>
                            <td>
                                <div class="input-clear">
                                    <input type="text" id="agencyDepartment" name="agencyDepartment">
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                <label for="">
                                    직급
                                </label>
                            </th>
                            <td>
                                <div class="input-clear">
                                    <input type="text" id="level" name="level">
                                </div>
                            </td>
                            <th>
                                <label for="">
                                    성명
                                </label>
                            </th>
                            <td>
                                <div class="input-clear">
                                    <input type="text" id="name" name="name">
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                <label for="">
                                    핸드폰
                                </label>
                            </th>
                            <td>
                                <div class="input-clear">
                                    <input type="text" id="tel" name="tel">
                                </div>
                            </td>
                            <th>
                                <label for="">
                                    이메일
                                </label>
                            </th>
                            <td>
                                <div class="input-clear">
                                    <input type="text" id="email" name="email">
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                <label for="">
                                    ID
                                </label>
                            </th>
                            <td colspan="3">
                                <div class="input-clear">
                                    <input type="text" id="id" name="id" class="wp50">
                                </div>
                                <a href="#" class="btn" id="btnDuplicate">중복확인</a>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                <label for="password">
                                    비밀번호
                                </label>
                            </th>
                            <td>
                                <input type="password" id="password" name="password">
                            </td>
                            <th>
                                <label for="passwordchk">
                                    비밀번호확인
                                </label>
                            </th>
                            <td>
                                <input type="password" id="passwordchk" name="passwordchk">
                            </td>
                        </tr>
                        <tr>
                            <th>
                                <label for="">
                                    권한그룹
                                </label>
                            </th>
                            <td colspan="3">
                                <div class="input-clear">
                                    <!--<select class="wp100 mg-r5" id="authType" name="authType">
                                        <option value='bloomuser'>BloomEnergy담당자</option>
                                        <option value='esguser'>ESG담당자</option>
                                        <option value='admin'>관리자</option>
                                        <option value='User'>사용자</option>
                                        <option value='Master'>시스템마스터</option>
                                        <option value='elecuser'>전기안전관리자</option>
                                    </select>-->
                                    <select class="wp25 mg-r5" id="authType" name="authType" >
                                        <option></option>
                                    </select>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                <label for="">
                                    발전시설
                                </label>
                            </th>
                            <td colspan="3">
                                <div class="fl-ac">
                                    <select class="wp25 mg-r5" id="firstSelect" name="spworkcd" onchange="updateNextSelect(this)">
                                        <option></option>
                                    </select>
                                    <select class="wp25 mg-r5" id="secondSelect" name="spcompcd" onchange="updateNextSelect(this)">
                                        <option></option>
                                    </select>
                                    <select class="wp25 mg-r5" id="thirdSelect" name="spplancd">
                                        <option></option>
                                    </select>
                                    <button type="button" onclick="addselectField(this)" class="btn" id="z" style="width: 145px">발전시설 추가</button>
                                </div>
                            </td>
                        </tr>
                        <!--<tr>
                            <th>
                                권한그룹
                            </th>
                            <td colspan="3">
                                <div class="check-box">
                                    <input type="checkbox" id="">
                                    <label for="">대구</label>
                                </div>
                                <div class="check-box">
                                    <input type="checkbox" id="">
                                    <label for="">성서</label>
                                </div>
                                <div class="check-box">
                                    <input type="checkbox" id="">
                                    <label for="">대관령</label>
                                </div>
                                <div class="check-box">
                                    <input type="checkbox" id="">
                                    <label for="">창원</label>
                                </div>
                                <div class="check-box">
                                    <input type="checkbox" id="">
                                    <label for="">대덕</label>
                                </div>
                                <div class="check-box">
                                    <input type="checkbox" id="">
                                    <label for="">울산</label>
                                </div>
                            </td>
                        </tr>-->
                        <tr>
                            <th>
                                <label for="">
                                    신청사유
                                </label>
                            </th>
                            <td colspan="3">
                                <div class="input-clear">
                                    <input type="text" id="reason" name="reason" class="wp100">
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                </form>
            </div>
            <div class="popup-button">
                <button class="btn-popup-close" onclick="RegisterUserClose()">취소</button>
                <button class="btn-navy" id="btnSaveAuth">권한신청</button>
            </div>
        </div>
    </div> <!-- //dashboard-layout-popup end -->
</div> <!-- //page-wrapper end-->


<script type="text/javascript" src="/resource/jquery.min.js"></script>
<script type="text/javascript" src="/resource/jquery-validation/1.17.0/jquery.validate.min.js"></script>
<script type="text/javascript" src="/resource/ax5ui/ax5ui.all.min.js"></script>
<script type="text/javascript" src="/resource/moment.min.js"></script>
<script type="text/javascript" src="/js/js.cookie.js"></script>
<script type="text/javascript" src="/js/common.js?v=1050"></script>
<script type="text/javascript" src="/resource/JavaScript-Templates/tmpl.js"></script>




<script type="text/javascript" src="/js/ax5commUtil.js?v=1050"></script>




<script type="text/javascript">



    <!-- 점검자 추가 버튼 이벤트-->
    function addselectField(button) {
        // 새로운 td 요소를 생성합니다.
        var newTd = document.createElement('div');
        newTd.className = 'fl-ac new-fl-ac';

        if(!window.cloneCounter){
            window.cloneCounter = 1;
        } else {
            window.cloneCounter++;
        }

        // 새로운 input 요소를 생성합니다.
        var originalSelect1 = document.getElementById('firstSelect');
        var newInput = originalSelect1.cloneNode(true);
        newInput.name = 'spworkcd';
        newInput.id = originalSelect1.id + window.cloneCounter;
        // newInput.className = 'wp100';
        newInput.type = 'select';
        newInput.width = 180;

        var originalSelect2 = document.getElementById('secondSelect');
        var newInput2 = originalSelect2.cloneNode(true);
        newInput2.name = 'spcompcd';
        // newInput2.className = 'wp100';
        newInput2.type = 'select';
        newInput2.id = originalSelect2.id + window.cloneCounter;
        newInput2.width = 180;

        var originalSelect3 = document.getElementById('thirdSelect');
        var newInput3 = originalSelect3.cloneNode(true);
        newInput3.name = 'spplancd';
        // newInput2.className = 'wp100';
        newInput3.type = 'select';
        newInput3.id = originalSelect3.id + window.cloneCounter;
        newInput3.width = 180;

        // 삭제 버튼을 생성합니다.
        var deleteButton = document.createElement('button');
        deleteButton.textContent = '발전시설 삭제';
        deleteButton.onclick = function() {
            deleteSelectField(newInput); // 삭제 버튼을 클릭하면 해당 입력 필드를 삭제하는 함수 호출
            deleteSelectField(newInput2);
            deleteSelectField(newInput3);
        };
        deleteButton.style.marginLeft = '8px';
        deleteButton.style.color = 'red';
        deleteButton.style.marginTop = '5px';
        // 새로운 td에 input 요소와 삭제 버튼을 추가합니다.
        newTd.appendChild(newInput);
        newTd.appendChild(newInput2);
        newTd.appendChild(newInput3);
        newTd.appendChild(deleteButton);

        // 클릭된 버튼의 부모 td 요소를 찾습니다.
        var parentTd = button.parentElement;

        // 부모 td 요소 다음에 새로운 td 요소를 추가합니다.
        parentTd.parentElement.insertBefore(newTd, parentTd.nextSibling);


    }

    function deleteSelectField(inputField) {
        // 입력 필드의 부모 요소(td)를 찾아서 삭제합니다.
        var tdToDelete = inputField.parentElement;
        tdToDelete.parentElement.removeChild(tdToDelete);
    }







    function updateNextSelect(param) {
        let code = param.value;
        let value = param.options[param.selectedIndex].text;

        console.log(code);
        console.log(value);

        // param의 다음 형제 요소를 찾습니다.
        let nextSelect = $(param).next('select');

        if (nextSelect.length) {
            let nextSelectId = nextSelect.attr('id');

            $.ajax({
                url: '/user-codes/code',
                type: 'GET',
                data: { code: code, value: value },
                success: function(data) {
                    nextSelect.empty();
                    nextSelect.append('<option value="">선택하세요</option>');
                    data.forEach(function(item) {
                        nextSelect.append('<option value="' + item.code + '">' + item.value + '</option>');
                    });
                },
                error: function(xhr, status, error) {
                    // 통신 실패 시 처리


                    // 선택 옵션을 비우거나 기본 옵션을 설정할 수 있습니다.
                    nextSelect.empty();
                    nextSelect.append('<option value=""></option>');
                }
            });
        } else {
            console.error('다음 select 요소를 찾을 수 없습니다.');
        }
    }


    const requiredFields = [
        { id: 'agency', name: '소속사' },
        { id: 'agencyDepartment', name: '소속부서' },
        { id: 'name', name: '성명' },
        { id: 'id', name: 'ID' },
        { id: 'password', name: '비밀번호' },
        { id: 'passwordchk', name: '비밀번호확인' },
        { id: 'authType', name: '권한그룹' },
        { id: 'firstSelect', name: '관할지역' },
        { id: 'secondSelect', name: '발전산단' },
        { id: 'thirdSelect', name: '발전소' }
    ];

    // 필드명과 name값으로 유효성 검사할 필드 배열
    const nameBasedFields = [
        { name: 'spworkcd', displayName: '관할지역' },
        { name: 'spcompcd', displayName: '발전산단' },
        { name: 'spplancd', displayName: '발전소' }
    ];

    const clearFieldList = ['agency', 'agencyDepartment', 'name', 'id', 'password', 'passwordchk', 'authType', 'firstSelect', 'secondSelect', 'thirdSelect', 'tel', 'level', 'email', 'reason']

    // 유효성 검사
    function validateFields() {
        for (let field of requiredFields) {
            if (!validateFieldById(field.id, field.name)) {
                return false;
            }
        }

        for (let field of nameBasedFields) {
            if (!validateFieldsByName(field.name, field.displayName)) {
                return false;
            }
        }

        return true;  // 모든 유효성 검사를 통과했을 경우
    }

    // ID로 유효성 검사 함수
    function validateFieldById(id, fieldName) {
        const value = document.getElementById(id)?.value.trim();

        if (!value) {
            Alert.alert('', `${fieldName}이(가) 입력되지 않았습니다.`);
            return false;
        }

        return true;
    }

    // name 속성으로 유효성 검사 함수
    function validateFieldsByName(name, fieldName) {
        const elements = document.getElementsByName(name);

        if (elements.length === 0) {
            console.error(`이름이 ${name}인 요소를 찾을 수 없습니다.`);
            return false;
        }

        for (let element of elements) {
            const value = element.value.trim();
            if (!value) {
                Alert.alert('', `${fieldName}이(가) 입력되지 않았습니다.`);
                return false;
            }
        }

        return true;
    }

    function RegisterUser(){
        let popup = document.getElementById('popup1');
        let wrapper = document.getElementById('wrapper1');

        popup.style.display = 'block';
        wrapper.style.display = 'block';
    }

    function RegisterUserClose(){
        let popup = document.getElementById('popup1');
        let wrapper = document.getElementById('wrapper1');

        popup.style.display = 'none';
        wrapper.style.display = 'none';
    }


    function initializeSelect({
                                  url,               // API 엔드포인트 URL
                                  params = {},       // 요청 매개변수 (기본값은 빈 객체)
                                  elementId,         // 셀렉트 요소의 ID
                                  defaultOption = "선택하세요",  // 기본 옵션 텍스트
                                  valueField = "code",    // 데이터의 값 필드 이름
                                  textField = "value"     // 데이터의 표시 필드 이름
                              }) {
        $.get(url, params, function(data){
            let selectElement = $(`#${elementId}`);
            selectElement.empty();
            selectElement.append(`<option value="">${defaultOption}</option>`);
            data.forEach(function(item) {
                selectElement.append(`<option value="${item[valueField]}">${item[textField]}</option>`);
            });
        });
    }




    var userinfo = {
        username: '',
        login_id: '',
        group_code: '',
        read_flag: '{',
        write_flag: '',
        ip_address: '',
        crtfcKey: ''
    };

    var gui = {
        gui_code: '',
        template_key: '',
        action: '',
    };

    userinfo.can_read = function () {
        let result = false;
        if (userinfo.read_flag == 'True') {
            result = true;
        }
        return result;
    };

    userinfo.can_write = function () {
        let result = false;
        if (userinfo.write_flag == 'True') {
            result = true;
        }
        return result;
    };


</script>

<script type="text/javascript">
    var isChangeLang = 'N';



    $(document).ready(function () {




        initializeSelect({
            url: '/user-codes/parent',
            params: { parentId: 154 },
            elementId: 'agency'
        })

        initializeSelect({
            url: '/user-codes/parent',
            params: { parentId: 110 },
            elementId: 'firstSelect'
        })

        initializeSelect({
            url: '/user-auth/type',
            params: {},
            elementId: 'authType',
            valueField: "code",
            textField: 'name'
        })


        let AuthCode = false;

        let _csrf = document.getElementsByName('_csrf');

        console.log(_csrf);


        let _CsrfValue = _csrf[0].value;


        //아이디 중복확인 신청
        let btnDuplicate = $('#btnDuplicate');
        btnDuplicate.click(function (e){



            let userid = document.getElementById('id').value;
            if(userid.trim() === '' || userid === null){
                Alert.alert('', '빈 값은 불가능합니다.');
                return;
            }

            let data = {
                _CsrfValue,
                userid
            }

            let fnSuccess = function (res) {
                if(res.success){
                    AuthCode = true;
                    Alert.alert('', res.message);
                    document.getElementById('id').readOnly = true;

                } else if (!res.success){
                    AuthCode = false;
                    Alert.alert('', res.message);
                }
            };
            AjaxUtil.postAsyncData("/useridchk", data, fnSuccess);

        })




        //권한신청 버튼 클릭
        let btnRegistersend = $('#btnSaveAuth');

        btnRegistersend.click(function (e) {

            let authType = document.getElementById('authType');


            let authTypeText = authType.options[authType.selectedIndex].text;


            if (!validateFields()) {
                return false;
            }



            if(!AuthCode){
                Alert.alert('', '아이디중복 확인을 하지 않으셨습니다.');
                return;
            }

            const emailInput = document.getElementById('email');
            const emailValue = emailInput.value.trim();

            // 이메일 형식의 정규 표현식
            const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;

            if (!emailPattern.test(emailValue)) {
                Alert.alert('', '유효한 이메일 주소를 입력하세요.');
                return;
            }

            let password = document.getElementById('password').value;
            let password2 = document.getElementById('passwordchk').value;

            if(password !== password2){
                Alert.alert('', '비밀번호가 맞지 않습니다.');
                return;
            }

            function extractSelectValues(selectName) {
                let inputs = document.querySelectorAll(`select[name="${selectName}"]`);
                return Array.from(inputs).map(input => input.value).join(',');
            }

            function extractSelectTexts(selectName) {
                let inputs = document.querySelectorAll(`select[name="${selectName}"]`);
                return Array.from(inputs).map(input => input.options[input.selectedIndex].text).join(',');
            }

            let spworkcdString = extractSelectValues('spworkcd');
            let spcompcdString = extractSelectValues('spcompcd');
            let spplancdString = extractSelectValues('spplancd');


            let firstText  = extractSelectTexts('spworkcd');
            let secondText = extractSelectTexts('spcompcd');
            let thirdText  = extractSelectTexts('spplancd');


            console.log('spplancdString', spplancdString)

            let data = FormUtil.extractForm($('#bomForm'));

            data.spworkcd = spworkcdString;
            data.spcompcd = spcompcdString;
            data.spplancd = spplancdString;

            data.firstText = firstText;
            data.secondText = secondText;
            data.thirdText = thirdText;
            data.authTypeText = authTypeText;

            console.log(data);



            let fnSuccess = function (res) {
                if(res.success){
                    Alert.alert('', res.message);
                    $("#modal-close-button").trigger('click');
                }else if (!res.success){
                    Alert.alert('', res.message);
                }
            };
            AjaxUtil.postAsyncData("/Register/save", data, fnSuccess);

            AuthCode = false;
            for(let i=0; i < clearFieldList.length; i++){
                clearForm(clearFieldList[i]);
            }
            let idfield = document.getElementById('id')
            idfield.removeAttribute('readonly')

            //추가된 발전지역 요소들 삭제
            const elements = document.getElementsByClassName('new-fl-ac');
            const elementsArray = Array.from(elements);

            elementsArray.forEach(element => {
                element.remove();
            });
            //끝


            RegisterUserClose();

        })

        function clearForm(param){
            let clearValue = document.getElementById(param);
            if(clearValue){
                clearValue.value = '';
            }
        }


        if (top.location != window.location) {
            alert('로그아웃 되었습니다. 로그인 화면으로 이동합니다.')
            top.location.reload();

        }

        if (localStorage.getItem('theme-top') === null && localStorage.getItem('theme-left') === null) {
            dynamicLinkCss('/css/theme-top-a', '/css/theme-left-a');
        } else {
            dynamicLinkCss(localStorage.getItem('theme-top'), localStorage.getItem('theme-left'));
        }

        // Password show/hide
        $('.pass_box i').on('click', function () {
            $('.pass_box input').toggleClass('active');
            if ($('.pass_box input').hasClass('active')) {
                $(this).attr('class', "icon ion-md-eye").css({ "color": "#5567ff" }).prev('input').attr('type', "text");
            } else {
                $(this).attr('class', "icon ion-md-eye-off").css({ "color": "#989db1" }).prev('.pass_box input').attr('type', 'password');
            }
        });

        //// 로그인ID 저장 Cokiee 관련 처리
        $('#loginId').val(Cookies.get('loginId'));
        if ($('#loginId').val() != '') {
            $('#login_chk').attr('checked', true);
            $('#loginPwd').focus();
        }

        $('#login_chk').change(function () {
            if ($('#login_chk').is(':checked')) {
                Cookies.set('loginId', $('#loginId').val(), { expires: 7 });
            } else {
                Cookies.remove('loginId');
            }
        });

        $('#loginId').keyup(function () {
            if ($('#login_chk').is(':checked')) {
                Cookies.set('loginId', $('#loginId').val(), { path: '/', expires: 7 });
            }
        });

        function clearFields() {
            $('#loginId').val('');
            $('#loginPwd').val('');
            $('#loginId').focus();
        }

        function submitHandler(form) {

            var submitData = $(form).serialize() + '&isChangeLang=' + isChangeLang;
            $.post('/login', submitData, function (result) {
                let code = result.data.code;
                if (code == 'NOUSER') {

                    Alert.alert('', '아이디 또는 비밀번호가 일치하지 않습니다.');
                    return false;
                }
                if (code == 'NOID') {

                    let redtext = document.getElementById('hint-red');
                    redtext.style.display = 'block';
                    Alert.alert('', '아이디 또는 비밀번호가 일치하지 않습니다.', clearFields);
                }
                else if (code == 'NOPW') {
                    Alert.alert('', '비밀번호가 일치하지 않습니다', function () { $('#loginPwd').val(''); $('#loginPwd').focus(); });
                }
                else if (code == 'ETC') {
                    Alert.alert('', '로그인에 실패했습니다.&lt;br&gt;다시 시도하십시요', clearFields);
                } else if (code == 'NOAUTH') {
                    Alert.alert('', '시스템 접근 권한이 없습니다. 시스템관리자에게 확인하시기 바랍니다', clearFields);
                } else if (code == 'FIRST') {
                    Alert.alert('', '비밀번호를 변경하십시요.', function () { location.href = '/pwdchange'; });
                } else if (code == 'NOTCONFIRM') {
                    Alert.alert('', '승인되지 않은 사용자입니다.', clearFields);
                }
                else {
                    if (code == 'OK') {
                        let lang_cd = sessionStorage.getItem('lang_code');
                        let url = '/api/common/labels';
                        let pData = { lang_code: lang_cd };
                        let fnsuccess = function (result) {
                            dic = {};
                            $.each(result, function (idx, item) {
                                let storageKey = lang_cd + '_' + item.gui_code + '_' + item.template_key;
                                let data = [];
                                if (dic.hasOwnProperty(storageKey)) {
                                    data = dic[storageKey];
                                } else {
                                    dic[storageKey] = data;
                                }
                                data.push({ 'label_code': item.label_code, 'text': item.text, 'desc': item.descr });
                            });

                            $.each(dic, function (k, v) {
                                let sessionData = JSON.stringify(v);
                                sessionStorage.setItem(k, sessionData);
                            });
                            location.href = "/";
                        };

                        let fnfailure = function () {
                            location.href = "/login";
                        };
                        AjaxUtil.getAsyncData(url, pData, fnsuccess, fnfailure);
                        //location.href = "/";
                    } else {
                        location.href = '/';
                    }
                }
            }).fail(function (e) {
                Alert.alert('', JSON.parse(e.responseText).message);
            });
        }

        $('#loginFrm').validate({ submitHandler: submitHandler });

    });

</script>

</body>
</html>
