<html layout:decorate="~{layout_page}" xmlns:layout="http://www.w3.org/1999/xhtml">
<th:block layout:fragment="content">
    <div class="content_wrap">

        <section class="section">

            <div class="title_box ">
                <div class="left_align">
                    <h3 data-labelCd="REC거래동향">REC거래동향</h3>
                </div>

                <button type="button" class="btn-default pull-right " id="btnHedaerFilter" title="필터 보이기/감추기"><i class="fas fa-filter"></i></button>
                <button type="button" class="btn-default pull-right mr-1" id="btnHeaderCompress" title="화면 확대/축소"><i class="fas fa-compress" id="iCompress"></i></button>
            </div>

            <div class="table_box search">

                <div class="row">

                    <div class="col-6 col-md-6 col-lg-5" style="max-width: 12%">
                        <div class="input-group" style="width: 110%">
                            <div class="input-group-prepend">
                                <span class="input-group-text fit_box_sm" data-labelCd="일자">일자</span>
                            </div>
                            <div data-ax5picker="multi" id="srchDt">
                                <div class="input-group-append">
                                    <input class="tac " type="text" id="date_from" name="date_from" data-picker-date="month" />
                                    <span class="input-group-text fs-xl">
                                    <i class="fas fa-calendar-alt calendar_color" ></i>
                                </span>

                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="col-1" >
                        <button type="button" class="btn-default" id="btnSearch" title="조회"><i class="fas fa-search"></i></button>
                    </div>
                    <div class="col-5" style="
    width: 131%;
">

                    </div>
                    <div class="col">
                        <a href="https://onerec.kmos.kr/portal/rec/selectRecReport_tradePerformanceList.do?key=1971" target="_blank" style="line-height: 2; font-size: 16px; font-family: inherit; float: right;">REC 거래동향 바로가기</a>
                    </div>

                </div>
            </div>


        </section>


        <section class="section ">
            <div class="grid_box">
                <div class="title_box">
                    <div >
                        <span class="right_align rpt" data-labelCd="발전량내역">발전량내역</span>
                        <button type="button" class="btn-danger y_write_auth" id="btnDelete" ><i class="fas fa-trash"></i></button>
                        <button type="button" class="btn-default" id="btnDownloadTemplate"><span data-labelCd="양식 다운로드">양식 다운로드</span></button>
                        <button type="button" class="btn-default" id="btnExcel" title="엑셀 다운로드"><i class="fas fa-file-excel"></i></button>
                    </div>
                </div>
                <div class="h-650" data-ax5grid="sujuGrid" ></div>
            </div>
        </section>

        <section>
            <div class="title_box">
                <span class="right_align rpt" data-labelCd="상세정보">상세정보</span>
                <button type="button" class="btn-default" id="btnNew"><i class="fas fa-plus"></i></button>
                <button type="button" class="btn-cancel" id="btnDel"><i class="fas fa-trash"></i></button>
                <button type="button" class="btn-default" id="btnSave" ><i class="fas fa-save"></i></button>
            </div>
            <form id="usergroupForm">
                <div class="table_box sub">
                    <div class="row">
                        <input type="hidden" id="id" name="id" value="" />

                        <div class="col-6 col-md-3 col-lg-3" >
                            <div class="input-group" >
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_t7" data-labelCd="적용년월">시작일자</span>
                                </div>
                                <input type="text" class="form-control2" id="code" name="code" disabled required/>
                            </div>
                        </div>

                        <div class="col-6 col-md-3 col-lg-3" >
                            <div class="input-group" >
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_t7" data-labelCd="SMP단가">종료일자</span>
                                </div>
                                <input type="text" class="form-control2" id="name" name="name" disabled required/>
                            </div>
                        </div>

                        <div class="col-6 col-md-3 col-lg-3" >
                            <div class="input-group" >
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_t7" data-labelCd="단가적용">REC단가</span>
                                </div>
                                <input type="text" class="form-control2" id="name" name="name" disabled required/>
                            </div>
                        </div>

                        <div class="col-6 col-md-3 col-lg-3" >
                            <div class="input-group" >
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_t7" data-labelCd="단가적용">단가적용</span>
                                </div>
                                <input type="text" class="form-control2" id="name" name="name" disabled required/>
                            </div>
                        </div>

                        <div class="col-12">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_t7_area" data-labelCd="비고">비고</span>
                                </div>
                                <textarea class="form-control2" id="description" name="description" disabled></textarea>
                            </div>
                        </div>


                    </div>
                </div>
            </form>
        </section>


    </div>


</th:block>

<th:block layout:fragment="scripts">
    <script type="text/javascript">
        class SujuUploadPage {
            constructor() {
                this.grid = null;
                this.baseUrl = '/api/sale/upload/sale_upload_main';
                this.init();
            }

            init() {
                let _this = this;
                let config = {
                    target: $('[data-ax5grid="sujuGrid"]'),
                    frozenColumnIndex: 0, // 열 고정
                    frozenRowIndex: 0,    // 행 고정
                    showLineNumber: false, // 열의 번호 보이기 여부
                    showRowSelector: true,  // checkbox(선택) 보이기 여부
                    multipleSelect: true, // 여러행 선택 가능 여부 (false시 단독 선택)
                    sortable: true, // 모든 컬럼에 정렬 아이콘 표시 (columns에서 컬럼별 소팅여부 재설정 가능)
                    multiSort: true, // 다중 정렬 여부
                    header: {
                        align: 'center',  // 헤더의 기본 정렬
                        columnHeight: 35  // 헤더 높이
                    },
                    body: {
                        columnHeight: 25, // body의 기본 높이
                        onClick: function (e) {
                            this.self.select(this.dindex);
                            console.log(this.item.__index);

                        }
                    },
                    page: {
                        display: true,  // 페이징 보이기 여부
                        statusDisplay: true,
                    },
                    columns: [
                        { key: 'number', label: 'No.', width: 0, align: 'center' },
                        { key: 'number2', label: '적용일자', width: 200, align: 'center' },
                        { key: 'number3', label: '단가', width: 200, align: 'center' },
                        { key: 'number4', label: '적용', width: 200, align: 'center' },

                    ],

                };
                this.grid = new ax5.ui.grid(config);

                let nowDate = CommonUtil.getYYYYMMDD();
                let dueDate = CommonUtil.getYYYYMMDD(10);

                // 엔터키 검색
                $('#keyword').on('keypress', function (e) {
                    if (event.keyCode == 13) {
                        _this.searchDataBind();
                    }
                });
            }






            searchDataBind(){
                let _this = this;

                let start = $('#date_from').val();
                let end = $('#date_to').val();

                let data = {
                    'start' : start + '-01-01',
                    'end'   : end + '12-31',
                    'flag'  : 'list'
                };


                let fnseccess = function (result) {
                    if(result.data != null) {
                        let recordsTotal = result.data.length;
                        _this.grid.setData({
                            list: result.data,
                            page: {
                                display: true,
                                totalElements: recordsTotal,
                            }
                        });
                    }
                };
                AjaxUtil.getAsyncData(_this.baseUrl + '/read',data, fnseccess);

            }

            //삭제
            deleteSujuBulkData(items) {
                let _this = this;
                /*
                let data = {
                    'list_data': items,
                }
                let Q = {
                    value :JSON.stringify(data)
                }
                */
                let data = {
                    Q: JSON.stringify(items)
                }

                let fnSuccess = function (res) {
                    if (res.success) {
                        Notify.success('삭제되었습니다');
                        _this.searchDataBind();
                    } else {
                        Alert.alert('', res.message);
                    }
                };

                AjaxUtil.postAsyncData(_this.baseUrl + '/delete', data, fnSuccess);
            }


        }

        let page = null;
        var picker = new ax5.ui.picker();

        $(document).ready(function (e) {
            page = new SujuUploadPage();

            picker.bind({
                target: $('[data-picker-date="month"]'),
                content: {
                    type: 'date',
                    config: {
                        mode: "month", selectMode: "month"
                    },
                    formatter: {
                        pattern: 'date(month)'
                    }
                }
            });

            $('#date_from').val(CommonUtil.getYYYYMMDD().substring(0,7));


            //검색
            $('#btnSearch').click(function (e){
                page.searchDataBind();
            });

            // 삭제 버튼
            $('#btnDelete').click(function (e) {
                let items = page.grid.getList('selected');
                if (items.length > 0) {
                    Alert.confirm('', '삭제하시겠습니까?',
                        function () {
                            page.deleteSujuBulkData(items);
                        },
                        function () { }
                    );
                } else {
                    Alert.alert('', '삭제할 항목을 선택해주세요.', function () {
                        $(this).focus();
                    });
                }
            });

        })
    </script>
</th:block>
</html>