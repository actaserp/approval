<html layout:decorate="~{layout_page}" xmlns:layout="http://www.w3.org/1999/xhtml">

<head>
    <style>
        #theGrid2.wj-flexgrid .wj-cell {
            padding: 12px;
        }

        #theGrid2.wj-flexgrid .downloads {
            padding-top: 0px;
        }

    </style>
</head>

<th:block layout:fragment="content">

    <!--- (레이아웃) Contents 영역 -->
    <div class="layout-contents">
        <!-- Page Title -->
        <div class="page-title-wrap">
            <div class="left">
                <h2>기간별 발전량 조회</h2>
                <a title="북마크" class="bookmark toggle">
                    내메뉴
                </a>
            </div>
            <ul class="page-navi">
                <li><img src="/images/icon/ico-nav-home.svg" alt="홈아이콘"></li>
                <li>서비스 분석</li>
                <li>매출 관리</li>
                <li>기간별 발전량 조회</li>
            </ul>
        </div>

        <!-- Select -->
        <div class="search-wrap">
            <ul>
                <li>
                    <select title="지역" id="spworkcd" name="spworkcd" onchange="updateSelect('spworkcd', 'spworknm')">
                        <option value="001">대구</option>
                        <input type="hidden" id="spworknm" name="spworknm">
                    </select>
                </li>
                <li>
                    <select title="구" id="spcompcd" name="spcompcd" onchange="updateSelect('spcompcd', 'spcompnm')">
                        <option value="001">성서산단</option>
                        <input type="hidden" id="spcompnm" name="spcompnm">
                    </select>
                </li>
                <li>
                    <select title="시설" id="spplancd" name="spplancd" onchange="updateSelect('spplancd', 'spplannm')">
                        <option value="001">대구물류센터</option>
                        <input type="hidden" id="spplannm" name="spplannm">
                    </select>
                </li>
            </ul>
        </div>

        <div class="tab-wrap">
            <ul class="tab-links">
                <li>
                    <a href="#tab1" title="기간별조회">기간별 조회</a>
                </li>
                <li>
                    <a href="#tab2" title="기간별대비">기간별 대비</a>
                </li>
            </ul>

            <div class="tab-contents">
                <!-- tab1 -->
                <section class="tab-item" id="tab1">
                    <div class="section-top">
                        <div class="search-wrap">
                            <dl>
                                <dt>
                                    조회기간<span class="eq">*</span>
                                </dt>
                                <dd>
                                    <ul class="date-box">
                                        <li id="startDateContainer">
                                            <!--<input type="month" id="startDate" name="startDate" value="2024-01">
                                            <label for="startDate" class="hide">시작일</label>-->
                                            <input type="month" id="startDate" name="startDate">
                                        </li>
                                        <li id="endDateContainer">
                                            <!--<input type="month" id="endDate" name="endDate" value="2024-12">
                                            <label for="endDate" class="hide">종료일</label>-->
                                            <input type="month" id="endDate" name="endDate">
                                        </li>
                                    </ul>
                                </dd>
                            </dl>

                            <dl>
                                <dt>
                                    <label for="genename">
                                        발전기명<span class="eq">*</span>
                                    </label>
                                </dt>
                                <dd>
                                    <ul class="date-box">
                                        <li>
                                            <select id="genename" name="genename">
                                                <!-- 동적으로 발전기명을 가져와서 옵션으로 추가 -->
                                            </select>
                                        </li>
                                    </ul>
                                </dd>
                            </dl>

                            <dl>
                                <dt>
                                    <label for="periodType">
                                        기간유형<span class="eq">*</span>
                                    </label>
                                </dt>
                                <dd>
                                    <ul class="date-box">
                                        <li>
                                            <select id="periodType" name="periodType" onchange="updatePeriodInputs()">
                                                <option value="hourly">시간별</option>
                                                <option value="monthly" selected>월별</option>
                                                <option value="quarterly">분기별</option>
                                                <option value="halfyearly">반기별</option>
                                                <option value="yearly">연도별</option>
                                            </select>
                                        </li>

                                        <li>
                                            <a class="btn btn-navy" title="차트설정초기화" id="btn-reset-chart">
                                                차트설정 초기화
                                            </a>
                                        </li>

                                        <li>
                                            <a class="btn btn-delete" title="검색" id="btn-search" onclick="searchData()">
                                                <img src="/images/icon/btn-srch.svg" alt="검색 아이콘">
                                                검색
                                            </a>
                                        </li>
                                    </ul>
                                </dd>
                            </dl>
                        </div>

                        <div class="button-wrap">
                            <ul>
                                <li>
                                    <a class="btn btn-excell" title="엑셀다운로드">
                                        <img src="/images/icon/ico-excell.svg" alt="엑셀 아이콘">
                                        엑셀다운로드
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div> <!--//section-top end -->

                    <div class="row row-2">
                        <section class="wp50" style="height: 530px; border-radius: 15px;">
                            <!-- 그래프 -->
                            <div id="chartHolder1" style="width:600px; height:400px;">
                            </div>
                        </section>
                        <section class="wp50" style="height: 530px">
                            <div class="container-fluid">
                                <p id="selectedItem"></p>
                                <div id="theGrid" style="max-height: 485px"></div>
                            </div>
                        </section>
                    </div>
                </section>

                <!-- tab2 -->
                <section class="tab-item" id="tab2">
                    <div class="section-top">
                        <div class="search-wrap">
                            <dl>
                                <dt>
                                    조회기간<span class="eq">*</span>
                                </dt>
                                <dd>
                                    <ul class="date-box">
                                        <li>
                                            <select id="yearSelect" name="yearSelect">
                                                <option th:each="year : ${years}" th:value="${year}" th:text="${year} + '년'"></option>
                                            </select>
                                        </li>
                                    </ul>
                                </dd>
                            </dl>

                            <dl>
                                <dt>
                                    <label for="generatorSelect">
                                        발전기명<span class="eq">*</span>
                                    </label>
                                </dt>
                                <dd>
                                    <ul class="date-box">
                                        <li>
                                            <select id="generatorSelect" name="generatorSelect">
                                                <option value="all">전체</option>
                                                <option value="AJ380">AJ380</option>
                                                <option value="AJ390">AJ390</option>
                                            </select>
                                        </li>
                                    </ul>
                                </dd>
                            </dl>

                            <dl>
                                <dt>
                                    <label for="comparisonType">
                                        비교 유형<span class="eq">*</span>
                                    </label>
                                </dt>
                                <dd>
                                    <ul class="date-box">
                                        <li>
                                            <select id="comparisonType" name="comparisonType">
                                                <option value="YoY">YoY</option>
                                                <option value="QoQ">QoQ</option>
                                                <option value="MoM">MoM</option>
                                                <option value="YTD">YTD</option>
                                            </select>
                                        </li>

                                        <li>
                                            <a class="btn btn-navy" title="차트설정초기화" id="btn-reset-chart2">
                                                차트설정 초기화
                                            </a>
                                        </li>

                                        <li>
                                            <a class="btn btn-delete" title="검색" id="btn-search2" onclick="searchComparisonData()">
                                                <img src="/images/icon/btn-srch.svg" alt="검색 아이콘">
                                                검색
                                            </a>
                                        </li>
                                    </ul>
                                </dd>
                            </dl>
                        </div>

                        <div class="button-wrap">
                            <ul>
                                <li>
                                    <a class="btn btn-excell" title="엑셀다운로드">
                                        <img src="/images/icon/ico-excell.svg" alt="엑셀 아이콘">
                                        엑셀다운로드
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div> <!--//section-top end -->

                    <div class="row row-2">
                        <section class="wp50" style="height: 530px; border-radius: 15px;">
                            <div id="chartHolder2" style="width:600px; height:400px;"></div>
                        </section>
                        <section class="wp50" style="height: 530px;">
                            <div class="container-fluid">
                                <p id="selectedItem"></p>
                                <div id="theGrid2" style="max-height: 485px;"></div>
                            </div>
                        </section>
                    </div>
                </section>
            </div><!--//tab-contents end -->
        </div>
    </div> <!--//layout-contents end -->

</th:block>

<th:block layout:fragment="scripts">
    <th:block th:replace="/common/columns_setting :: columns_setting"></th:block>
    <th:block th:replace="/common/approve_box :: approve_box"></th:block>
    <th:block th:replace="/common/ax5_uploader :: ax5_uploader" ></th:block>
    <th:block th:replace="/common/upload_one_image_box :: upload_one_image_box" ></th:block>
    <th:block th:replace="/common/popup_select_user_code :: popup_select_user_code"></th:block>

    <script type="text/javascript">

        // 차트 초기화 및 레이아웃 설정
        function initChart(chartId, holderId, chartData) {
            if (!chartData || !chartData.itemsSource || !chartData.columns) {
                console.error("Invalid chart data provided:", chartData);
                return;
            }

            console.log("Initializing chart with data:", chartData); // 디버깅을 위한 로그 추가

            rMateChartH5.create(chartId, holderId, "", "120%", "120%");

            // 차트 데이터를 분석하여 최대값을 동적으로 설정
            const maxDataValue = Math.max(...chartData.itemsSource.sourceCollection.map(item => {
                const values = Object.values(item).filter(val => typeof val === 'number');
                return Math.max(...values);
            }));
            const vAxisMax = Math.ceil(maxDataValue / 100) * 100; // 최대값을 적절한 단위로 올림

            // 레이아웃 정의
            var layoutStr =
                '<rMateChart backgroundColor="#FFFFFF" borderStyle="none">' +
                '<Options>' +
                '<Caption text="기간별 발전현황" />' +
                '<SubCaption text="From 01 To 12" textAlign="center" paddingBottom="35"/>' +
                '<Legend defaultMouseOverAction="true" useVisibleCheck="true"/>' +
                '</Options>' +
                '<Column3DChart seriesMouseOverAction="none" showDataTips="true" columnWidthRatio="0.56" paddingBottom="25">' +
                '<horizontalAxis>' +
                '<CategoryAxis id="hAxis" categoryField="period"/>' + // 데이터 필드 매핑
                '</horizontalAxis>' +
                '<verticalAxis>' +
                '<LinearAxis id="vAxis" maximum="' + vAxisMax + '"/>' +
                '</verticalAxis>' +
                '<series>';


            // 각 발전소에 대한 시리즈 추가
            chartData.columns.forEach(column => {
                if (column.binding !== 'period') {
                    layoutStr +=
                        '<Column3DSeries labelPosition="outside" yField="' + column.binding + '" displayName="' + column.header + '" showValueLabels="[3]" outsideLabelXOffset="7">' +
                        '<showDataEffect>' +
                        '<SeriesInterpolate duration="1000"/>' +
                        '</showDataEffect>' +
                        '</Column3DSeries>';
                }
            });

            layoutStr +=
                '</series>' +
                '<backgroundElements>' +
                '<GridLines showBorderStroke="false"/>' +
                '</backgroundElements>' +
                '</Column3DChart>' +
                '</rMateChart>';

            // 차트 레이아웃 및 데이터 설정
            rMateChartH5.calls(chartId, {
                "setLayout": layoutStr,
                "setData": chartData.itemsSource.sourceCollection
            });

            console.log("Chart data successfully set.");
        }



        // rMateChartH5 차트 설정
        // var chart1;
        // var chart2;

        // 그리드 생성
        function buildGridColumns(data) {
            const columns = [
                {binding: 'period', header: '기간', width: 180, align: 'center'},
            ];

            // 모든 powernm(발전기명)을 확인하여 열을 동적으로 생성
            const powerNames = [...new Set(data.map(item => item.powernm))];
            powerNames.forEach(powerName => {
                columns.push({
                    binding: powerName,
                    header: powerName,
                    width: "*",
                    align: 'right',
                    format: 'n0'
                });
            });

            return columns;
        }

        // 데이터 변환 + 그리드 업데이트
        function transformDataForGrid(data, periodType) {
            const gridData = {};

            data.forEach(row => {
                const period = row.period ? row.period.toString() : ''; // 기간 데이터가 없는 경우 빈 문자열로 설정
                const powernm = row.powernm ? row.powernm.toString() : ''; // 발전기명이 없는 경우 빈 문자열로 설정

                if (periodType === 'hourly') {
                    // 시간별 데이터를 처리하는 로직
                    for (let i = 1; i <= 24; i++) {
                        const hourKey = `hour${i.toString().padStart(2, '0')}`;
                        if (row[hourKey] !== undefined) {
                            const periodWithHour = `${period} ${i.toString().padStart(2, '0')}시`;
                            if (!gridData[periodWithHour]) {
                                gridData[periodWithHour] = { period: periodWithHour };
                            }
                            gridData[periodWithHour][powernm] = row[hourKey] ? parseFloat(row[hourKey].toString().replace(/,/g, '')) : 0;
                        }
                    }
                } else {
                    // 월별, 분기별, 반기별, 연도별 데이터를 처리하는 로직
                    if (!gridData[period]) {
                        gridData[period] = { period: period };
                    }
                    Object.keys(row).forEach(key => {
                        if (key !== 'period' && key !== 'powernm') {
                            // 쉼표 제거 후 숫자로 변환
                            gridData[period][powernm] = row[key] ? parseFloat(row[key].toString().replace(/,/g, '')) : 0;
                        }
                    });
                }
            });

            return Object.values(gridData);
        }

        // 그리드 생성
        function updateGrid(grid, data, periodType) {
            console.log("Updating grid with data:", data); // 디버깅을 위한 로그 추가
            console.log("Period Type:", periodType); // periodType이 올바르게 전달되었는지 확인

            const columns = buildGridColumns(data); // 그리드의 컬럼을 동적으로 생성
            const transformedData = transformDataForGrid(data, periodType); // 데이터를 그리드에 맞게 변환

            // console.log("Transformed Data:", transformedData); // 변환된 데이터 확인!

            grid.initialize({
                autoGenerateColumns: false,
                columns: columns,
                itemsSource: new wijmo.collections.CollectionView(transformedData), // 변환된 데이터를 소스로 설정
                showMarquee: true,
                isReadOnly: true,
                headersVisibility: wijmo.grid.HeadersVisibility.Column // 컬럼 헤더만 보이도록 설정 (행 헤더는 숨김)
            });

            // 이전 데이터를 완전히 초기화 후 새 데이터 적용
            grid.itemsSource = new wijmo.collections.CollectionView(transformedData);


            // 헤더 중앙 정렬을 위해 formatItem 이벤트 핸들러 추가
            grid.formatItem.addHandler((s, e) => {
                if (e.panel === s.columnHeaders) {
                    e.cell.style.textAlign = 'center';
                }
            });

            // 그리드 데이터를 그대로 차트에 전달
            initChart("chart1", "chartHolder1", {
                columns: columns,
                itemsSource: grid.itemsSource
            });
        }

        // 검색
        function searchData() {
            const periodType = document.getElementById("periodType").value;
            let startDate, endDate, startHour, endHour;
            const generator = document.getElementById("genename").value; // 발전기명 선택

            // console.log("Selected powerid:", document.getElementById("genename").value);

            if (periodType === "hourly") { // 시간별 조회가 선택된 경우
                startDate = document.getElementById("startDate").value;
                startHour = document.getElementById("startHour").value;
                endHour = document.getElementById("endHour").value;
                endDate = startDate;

                let query = `/api/gene/upload/periodSearch?periodType=${periodType}&startdt=${startDate}&enddt=${endDate}&powerid=${generator}&startHour=${startHour}&endHour=${endHour}`;

                fetch(query)
                    .then(response => response.json())
                    .then(data => {
                        if (data.length === 0) {
                            alert('데이터가 존재하지 않습니다.');
                        } else {
                            updateGrid(theGrid, data, periodType); // periodType 전달
                        }
                    })
                    .catch(error => console.error('Error fetching search data:', error));


            } else if (periodType === "quarterly" || periodType === "halfyearly" || periodType === "yearly") {
                const periodValue = periodType === "quarterly" ? document.getElementById("startQuarter").value :
                    periodType === "halfyearly" ? document.getElementById("startHalf").value :
                        document.getElementById("startYear").value;
                const generator = document.getElementById("genename").value; // 여기에서 generator 변수를 선언하고 초기화

                if (periodValue === "ALLQ" || periodValue === "ALLH") {
                    getFullYearRangeFromData().then(([startDate, endDate]) => {
                        let query = `/api/gene/upload/periodSearch?periodType=${periodType}&startdt=${startDate}&enddt=${endDate}&powerid=${generator}`;
                        fetch(query)
                            .then(response => response.json())
                            .then(data => {
                                if (data.length === 0) {
                                    Alert.alert('', '데이터가 존재하지 않습니다.');
                                } else {
                                    updateGrid(theGrid, data); // 가져온 데이터로 그리드를 업데이트
                                }
                            })
                            .catch(error => console.error('Error fetching search data:', error));
                    });
                    return;

                } else {
                    [startDate, endDate] = convertPeriodToDateRange(periodType, periodValue);
                }
            } else if (document.getElementById("startDate")) {
                startDate = document.getElementById("startDate").value;
                endDate = document.getElementById("endDate").value;
            }

            let query = `/api/gene/upload/periodSearch?periodType=${periodType}&startdt=${startDate}&enddt=${endDate}&powerid=${generator}`;

            fetch(query)
                .then(response => response.json())
                .then(data => {
                    if (data.length === 0) {
                        alert('데이터가 존재하지 않습니다.');
                    } else {
                        updateGrid(theGrid, data);
                    }
                })
                .catch(error => console.error('Error fetching search data:', error));
        }



        function filterDataByHourRange(data, startHour, endHour) {
            return data.map(row => {
                const filteredRow = { period: row.period, powernm: row.powernm };
                for (let i = parseInt(startHour); i <= parseInt(endHour); i++) {
                    const hourKey = `hour${i.toString().padStart(2, '0')}`;
                    filteredRow[hourKey] = row[hourKey];
                }
                return filteredRow;
            });
        }



        function getFullYearRangeFromData() {
            return fetch('/api/gene/upload/dateRange')
                .then(response => response.json())
                .then(dateRange => {
                    const startDate = dateRange.startdt;  // 데이터베이스에서 가져온 최소 날짜
                    const endDate = dateRange.enddt;      // 데이터베이스에서 가져온 최대 날짜
                    return [startDate, endDate];
                });
        }

        function convertPeriodToDateRange(periodType, periodValue) {
            const year = new Date().getFullYear(); // 기본적으로 현재 연도 사용, 필요시 다른 연도를 사용 가능
            let startMonth, endMonth;

            switch (periodType) {
                case "quarterly":
                    switch (periodValue) {
                        case "Q1":
                            startMonth = "01";
                            endMonth = "03";
                            break;
                        case "Q2":
                            startMonth = "04";
                            endMonth = "06";
                            break;
                        case "Q3":
                            startMonth = "07";
                            endMonth = "09";
                            break;
                        case "Q4":
                            startMonth = "10";
                            endMonth = "12";
                            break;
                    }
                    break;
                case "halfyearly":
                    switch (periodValue) {
                        case "H1":
                            startMonth = "01";
                            endMonth = "06";
                            break;
                        case "H2":
                            startMonth = "07";
                            endMonth = "12";
                            break;
                    }
                    break;
                case "yearly":
                    startMonth = "01";
                    endMonth = "12";
                    break;
                default:
                    throw new Error(`Unknown period type: ${periodType}`);
            }

            const startDate = `${year}-${startMonth}-01`; // 기간의 시작 날짜
            const endDate = new Date(year, parseInt(endMonth), 0); // 해당 월의 마지막 날짜 계산
            return [startDate, `${year}-${endMonth}-${endDate.getDate()}`]; // 시작 날짜와 끝 날짜 반환
        }


        function searchComparisonData() {
            const year = document.getElementById("yearSelect").value;
            const generator = document.getElementById("generatorSelect").value;
            const comparisonType = document.getElementById("comparisonType").value;

            let query = `/api/gene/upload/searchComparison?year=${year}&generator=${generator}&comparisonType=${comparisonType}`;

            fetch(query)
                .then(response => response.json())
                .then(data => {
                    // updateChart(chart2, data); // 차트 업데이트
                    updateGrid(theGrid2, data); // 그리드 업데이트
                })
                .catch(error => console.error('Error fetching comparison data:', error));
        }


        // 페이지 로드 시
        function init() {
            // 차트 초기화
            initChart("chart1", "chartHolder1");
            // initChart("chart2", "chartHolder2");
            // chart1 = rMateChartH5.create("chart1", "chartHolder1", "", "120%", "120%");
            // chart2 = rMateChartH5.create("chart2", "chartHolder2", "", "100%", "100%");

            // 그리드 초기화
            // theGrid = new wijmo.grid.FlexGrid('#theGrid');
            theGrid = new wijmo.grid.FlexGrid('#theGrid', {
                autoGenerateColumns: false, // 이 옵션은 그리드 초기화 시 자동 생성된 열을 비활성화합니다.
                columns: [] // 초기 열 설정
            });


            // 기본으로 월별이 선택되도록 설정
            document.getElementById("periodType").value = "monthly";

            loadGeneratorNames(); // 발전기명 로드
            updatePeriodInputs(); // 페이지 로드 시 초기화
            loadMonthlyData(); // 페이지 로드 시 월별 데이터 자동 로드
        }

        $(document).ready(function (e) {
            init();
        });

        // 월별 데이터
        function loadMonthlyData() {
            const generator = 'all';  // 기본적으로 전체 발전기명에 대해 로드

            // 최소/최대 날짜를 서버에서 받아오는 API 호출
            fetch('/api/gene/upload/dateRange')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(dateRange => {
                    const startDate = dateRange.startdt;  // 서버에서 받은 최소 날짜
                    const endDate = dateRange.enddt;      // 서버에서 받은 최대 날짜

                    let query = `/api/gene/upload/periodSearch?periodType=monthly&startdt=${startDate}&enddt=${endDate}&powerid=${generator}`;

                    return fetch(query);
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Received data:', data); // 데이터 확인

                    if (!data || data.length === 0) {
                        console.warn('No data received.');
                        alert('조회된 데이터가 없습니다.');
                        return;
                    }

                    initChart("chart1", "chartHolder1", data); // 차트 업데이트
                    updateGrid(theGrid, data); // 그리드 업데이트
                })
                .catch(error => console.error('Error fetching initial monthly data:', error));
        }


        // 발전기명
        function loadGeneratorNames() {
            fetch('/api/gene/upload/generatornames') // API endpoint는 예시입니다.
                .then(response => response.json())
                .then(generatorNames => {
                    const selectElement = document.getElementById('genename');
                    if (selectElement) {
                        selectElement.innerHTML = ''; // 기존 옵션들을 지움
                        selectElement.appendChild(new Option('전체', 'all')); // '전체' 옵션 추가
                        generatorNames.forEach(name => {
                            selectElement.appendChild(new Option(name, name)); // 각 발전기명에 대한 옵션 추가
                        });
                    }
                })
                .catch(error => console.error('Error loading generator names:', error));
        }

        function updatePeriodInputs() {
            const periodType = document.getElementById("periodType").value;
            const startDateContainer = document.getElementById("startDateContainer");
            const endDateContainer = document.getElementById("endDateContainer");

            startDateContainer.innerHTML = "";
            endDateContainer.innerHTML = "";

            if (periodType === "hourly") { // 시간별 조회가 선택된 경우
                startDateContainer.innerHTML = `
            <input type="date" id="startDate" name="startDate" value="${new Date().toISOString().slice(0, 10)}">
        `;

                endDateContainer.innerHTML = `
            <select id="startHour" name="startHour" style="width: 60px;">
                ${generateHourOptions()}
            </select>
            -
            <select id="endHour" name="endHour" style="width: 60px;">
                ${generateHourOptions(true)}
            </select>
        `;
            } else if (periodType === "monthly") {
                startDateContainer.innerHTML = '<input type="month" id="startDate" name="startDate">';
                endDateContainer.innerHTML = '<input type="month" id="endDate" name="endDate">';
            } else if (periodType === "quarterly")
            {
                startDateContainer.innerHTML = '<select id="startQuarter" name="startQuarter">'
                    +
                    '<option value="ALLQ">전체분기</option>' +
                    '<option value="Q1">1분기</option>' +
                    '<option value="Q2">2분기</option>' +
                    '<option value="Q3">3분기</option>' +
                    '<option value="Q4">4분기</option>'
                    +
                    '</select>';
            } else if (periodType === "halfyearly") {
                startDateContainer.innerHTML
                    = '<select id="startHalf" name="startHalf">'
                    +
                    '<option value="ALLH">전체반기</option>' +
                    '<option value="H1">상반기</option>' +
                    '<option value="H2">하반기</option>' +
                    '</select>';
            } else if (periodType === "yearly") {
                // 초기 UI: 전체년도만 표시
                startDateContainer.innerHTML = '<select id="startYear" name="startYear">'
                    + '<option value="ALLY">전체년도</option>'
                    + '</select>';

                // 비동기로 데이터를 로드하고 UI 업데이트
                loadYearsAndUpdateUI('startYear');
            }
        }

        // 비동기로 연도를 로드하고 기존 UI를 업데이트하는 함수
        function loadYearsAndUpdateUI(selectId) {
            fetch('/api/gene/upload/distinctYears')
                .then(response => response.json())
                .then(years => {
                    const selectElement = document.getElementById(selectId);

                    // 기존 옵션 삭제
                    selectElement.innerHTML = '';

                    // "전체년도" 옵션 추가
                    const allOption = document.createElement('option');
                    allOption.value = "ALLY";
                    allOption.textContent = "전체년도";
                    selectElement.appendChild(allOption);

                    // 서버에서 가져온 연도 목록을 <option>으로 추가
                    years.forEach(year => {
                        const option = document.createElement('option');
                        option.value = year;
                        option.textContent = year + "년";
                        selectElement.appendChild(option);
                    });
                })
                .catch(error => console.error('Error loading years:', error));
        }

        // 시간 옵션 생성 함수
        function generateHourOptions(isEnd = false) {
            let options = '';
            for (let i = 1; i < 25; i++) { // 01~24
                const hour = i.toString().padStart(2, '0');
                options += `<option value="${hour}">${hour}</option>`;
            }
            // 시작 시간과 종료 시간을 기본 선택값으로 설정
            if (isEnd) {
                options = options.replace(`value="24"`, `value="24" selected`);
            } else {
                options = options.replace(`value="01"`, `value="01" selected`);
            }
            return options;
        }
    </script>
</th:block>
</html>