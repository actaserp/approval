<html layout:decorate="~{layout_page}">
<head>
<style>
    .greenText span {
        color: #66DA26;
    }

    .redText span {
        color: #FF0000;
    }

    .blueText span {
        color: #4374D9;
    }

    .select2-container--open {
        z-index: 9001;
    }

    .grid-cell-red {
        background: #f8d2cb;
    }

    .grid-cell-blue {
        background: #dcf0f8;
    }

    .grid-cell-white {
        background: #ffffff;
    }
</style>
<style id="print_css">
    @media print {
        .pagebreak {
            page-break-before: always;
        }
        /* page-break-after works, as well */
    }

    .bg_gray {
        background: #dedede;
    }

    /*align*/
    .table_1 td.tar {
        text-align: right;
    }

    .table_1 td.tal {
        text-align: left;
    }

    .table_1 td.tac {
        text-align: center;
    }

    .table_1 {
        width: 100%;
        border-collapse: collapse;
    }

        /*.table_1 th.b2 {border: 2px solid #166614;}
        .table_1 th.b2lt {border-left: 2px solid #166614;border-top: 2px solid #166614;}
        .table_1 th.b2rt {border-right: 2px solid #166614;border-top: 2px solid #166614;}
        .table_1 th.b2l {border-left: 2px solid #166614;}
        .table_1 th.b2r {border-right: 2px solid #166614;}
        .table_1 th.b2lrt {border-left: 2px solid #166614;border-right: 2px solid #166614;border-top: 2px solid #166614;}
        .table_1 th.b2t {border-top: 2px solid #166614;}*/

        .table_1 td.b2lr {
            border-left: 2px solid #166614;
            border-right: 2px solid #166614;
        }

        .table_1 td.b2lbr {
            border-left: 2px solid #166614;
            border-right: 2px solid #166614;
            border-bottom: 2px solid #166614;
        }

        .table_1 td.b2tr {
            border-top: 2px solid #166614;
            border-right: 2px solid #166614;
        }

        .table_1 td.b2t {
            border-top: 2px solid #166614;
        }

        .table_1 td.b2tb {
            border-top: 2px solid #166614;
            border-bottom: 2px solid #166614;
        }

        .table_1 td.b2lt {
            border-left: 2px solid #166614;
            border-top: 2px solid #166614;
        }

        .table_1 td.b2ltb {
            border-left: 2px solid #166614;
            border-top: 2px solid #166614;
            border-bottom: 2px solid #166614;
        }

        .table_1 td.b2rtb {
            border-right: 2px solid #166614;
            border-top: 2px solid #166614;
            border-bottom: 2px solid #166614;
        }

        .table_1 td.b2l {
            border-left: 2px solid #166614;
        }

        .table_1 td.b2r {
            border-right: 2px solid #166614;
        }

        .table_1 td.b2lb {
            border-bottom: 2px solid #166614;
            border-left: 2px solid #166614;
        }

        .table_1 td.b2b {
            border-bottom: 2px solid #166614;
        }

        .table_1 td.b2rb {
            border-bottom: 2px solid #166614;
            border-right: 2px solid #166614;
        }

        .table_1 th, td {
            border: 1px solid black;
            text-align: center;
            padding-left: 3px;
            padding-right: 3px;
        }

        .table_1 .line {
            border: 1px solid #166614;
            color: #166614;
            font-size: 14px;
        }

        .table_1 .line.clb {
            color: black;
            font-weight: 600;
            font-size: 12px;
            font-family: 휴먼고딕;
        }

        .table_1 .line.clb.money {
            font-size: 20px;
        }

        .table_1 td > .ts {
            font-size: 10px;
        }

        .table_1 td > .ts2 {
            font-size: 18px;
            position: relative;
            top: 10px;
        }

        .table_1 .title {
            font-size: 24px;
            font-weight: 600;
            padding: 5px;
        }
</style>
</head>

<th:block layout:fragment="content">
<div class="content_wrap">
    <section class="section">
        <div class="title_box ">
            <div class="left_align">
                <h3 data-labelCd="자재 입출고">자재 입출고</h3>
            </div>
            <button type="button" class="btn-default pull-right " id="btnHedaerFilter" title="필터 보이기/감추기"><i class="fas fa-filter"></i></button>
            <button type="button" class="btn-default pull-right mr-1" id="btnHeaderCompress" title="화면 확대/축소"><i class="fas fa-compress" id="iCompress"></i></button>
        </div>
        <div class="table_box search">
            <form id="searchForm" autocomplete="off">
                <div class="row">

                    <div class="col-12 col-lg-5 col-xl-3">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text fit_box_sm" data-labelCd="입출일">입출일</span>
                            </div>
                            <div data-ax5picker="multi" id="srchDt">
                                <div class="input-group-append">
                                    <input class="tac " type="text" id="srchStartDt" name="srchStartDt" />
                                    <span class="input-group-text fs-xl">
                                        <i class="fas fa-calendar-alt calendar_color"></i>
                                    </span>
                                    <span class="slow_sign">~</span>
                                    <input class="tac " type="text" id="srchEndDt" name="srchEndDt" />
                                    <span class="input-group-text fs-xl">
                                        <i class="fas fa-calendar-alt calendar_color"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-mg-3 col-lg-3">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text fit_box_sm" data-labelCd="창고">창고</span>
                            </div>
                            <select class="form-control2" id="cboHouse" name="cboHouse"></select>

                        </div>
                    </div>

                    <div class="col-6  col-mg-3 col-lg-3">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text fit_box_sm" data-labelCd="품목유형">품목유형</span>
                            </div>
                            <select class="form-control2" id="cboMatType" name="cboMatType"></select>

                        </div>
                    </div>

                    <div class="col-6  col-mg-3 col-lg-3">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text fit_box_sm" data-labelCd="품목그룹">품목그룹</span>
                            </div>
                            <select class="form-control2" id="cboMatGroup" name="cboMatGroup"></select>

                        </div>
                    </div>

                    <div class="col-5 col-mg-3 col-lg-3">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text fit_box_sm" data-labelCd="품명">품명</span>
                            </div>
                            <input id="txtMatName" name="txtMatName" class="form-control2" title="품명" />

                        </div>
                    </div>

                    <div class="col-1">
                        <button type="button" class="btn-default" id="btnSearch" title="조회"><i class="fas fa-search"></i></button>
                    </div>

                </div>
            </form>
        </div>
    </section>
    <section>
        <div class="grid_box">
            <div class="title_box">
                <span class="right_align rpt" data-labelCd="입출고 내역">입출고 내역</span>
                <button type="button" class="btn-default" id="btnExcel" title="엑셀 다운로드"><i class="fas fa-file-excel"></i></button>
                <button type="button" class="btn-default" id="btnGridSetting" style="visibility:hidden"><i class="fas fa-cog"></i> Setting</button>
                <button type="button" class="btn-default" id="btnShowMovePopup"><span data-labelCd="창고이동">창고 이동</span></button>
                <button type="button" class="btn-default" id="btnInput"><span data-labelCd="품목 입고">품목 입고</span></button>
                <button type="button" class="btn-default" id="btnOutput"><span data-labelCd="품목 출고">품목 출고</span></button>
                <button type="button" class="btn-default" id="btnMultiInput"><span data-labelCd="다중 입고">다중 입고</span></button>
                <button type="button" class="btn-default" id="btnInputTest"><span data-labelCd="입고검사">입고검사</span></button>
                <button type="button" class="btn-default" id="btnLotInput"><span data-labelCd="로트입고등록">로트입고등록</span></button>
            </div>
            <div class="h-620" data-ax5grid="material-storehouse-grid"></div>
        </div>
    </section>
</div>

<script type="text/x-tmpl" id="addDataPopup">
    <div class="content_wrap popup">
        <!--<header>
            <h4 id="popTitle">확인 메시지</h4>
            <div class="popup_close_box"><button class="btn_popup_close" id="modal-close"><i class="fas fa-times"></i></button></div>
        </header>-->

        <section class="pt-2">
                <div class="table_box sub">

                    <form id="materialInoutForm">
                        <input hidden="hidden" />
                <div class="row">

                    <div class="col-12">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text fit_box_t4" data-labelCd="품목유형">품목유형</span>
                            </div>
                             <select class="form-control2" id="cboMaterialType" name="cboMaterialType"  ></select>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text fit_box_t4" data-labelCd="품목그룹">품목그룹</span>
                            </div>
                             <select class="form-control2" id="cboMaterialGroup" name="cboMaterialGroup"  ></select>
                        </div>
                    </div>

                    <div class="col-10">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text fit_box_t4" data-labelCd="품목">품목</span>
                            </div>
                             <select class="form-control2" id="Material_id" name="Material_id" ></select>
                        </div>
                    </div>
                    
                    <div class="col-2">
                        <div class="input-group">
                          <button type="button" class="btn-popup y_write_auth" id="btnMaterial" ><span data-labelCd="품목조회">품목조회</span></button>
                        </div>
                    </div>
                    
                    <div class="col-12">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text fit_box_t4" data-labelCd="수량">수량</span>
                            </div>
                             <input class="form-control2" id="InoutQty" name="InoutQty" />
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text fit_box_t4" data-labelCd="창고지정">창고지정</span>
                            </div>
                             <select class="form-control2" id="StoreHouse_id" name="StoreHouse_id"  />
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text fit_box_t4" data-labelCd="구분">구분</span>
                            </div>
                             <select class="form-control2 tar"id="InoutType" name="InoutType"></select>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text fit_box_t4_area" data-labelCd="비고">비고</span>
                            </div>
                             <textarea class="form-control2" id="Description" name="Description"></textarea>
                        </div>
                    </div>

                    </div>

                    </form>
                </div>

        </section>
        <section class="popupcontent" >
            <div class="align_left">
                <button type="button" class="btn-popup y_write_auth" id="btnSave" ><span data-labelCd="저장">저장</span></button>
                <button type="button" class="btn-popup" id="modal-close-button"><span data-labelCd="닫기">닫기</span></button>
            </div>
        </section>

    </div>
</script>

<script type="text/x-tmpl" id="addMultiDataPopup">
    <div class="content_wrap popup">
        <!--<header>
            <h4 id="popTitle">확인 메시지</h4>
            <div class="popup_close_box"><button class="btn_popup_close" id="modal-close"><i class="fas fa-times"></i></button></div>
        </header>-->

        <section class="pt-2">
            <div class="table_box sub">

                <form id="mat_multi_input_form">
                    <input hidden="hidden" />
                    <div class="row">
                        <div class="col-12">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_t4" data-labelCd="구분">구분</span>
                                </div>
                                 <select class="form-control2 tal"id="InoutType" name="InoutType"></select>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_t4" data-labelCd="업체">업체</span>
                                </div>
                                 <select class="form-control2" id="Company_id" name="Company_id"  ></select>
                            </div>
                        </div>

                        <div class="col-12">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_t4" data-labelCd="창고지정">창고지정</span>
                                </div>
                                 <select class="form-control2" id="StoreHouse_id" name="StoreHouse_id" ></select>
                            </div>
                        </div>
                    </div>
                </form>
                <section>
                    <div class="tabs" data-tab="tabWrap" >
                        <div class="title_box">
                            <div class="left_align">
                                <ul class="tab_links">
                                    <li><a href="#" data-tablink="#tab_copy_text" name="tab_copy_text" class="tab" >다중입력텍스트</a></li>
                                    <li><a href="#" data-tablink="#tab_multi_grid" name="tab_multi_grid" class="tab" >그리드</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="tab-content">
                        <div class="tab" id="tab_copy_text">
                            <div class="tab_con_box">
                                <div class="title_box">
                                    <span class="left_align lpt">품목코드+수량을 엑셀에서 붙여넣으세요.</span>
                                </div>
                                <div class="table_box">
                                    <div class="table_box sub">
                                        <div class="row" >
                                            <div class="col-12">
                                                <div class="input-group">
                                                    <textarea class="form-control2" id="txtCopyText" name="txtCopyText" rows="20"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab" id="tab_multi_grid" >
                            <div class="tab_con_box">
                                <div class="title_box">
                                    <span class="left_align lpt">여러 품목,수량을 한꺼번에 저장합니다.</span>
                                    <button type="button" class="btn-default" id="btnTextToGrid"><span data-labelCd="변환">변환</span></button>

                                    <button type="button" class="btn-popup y_write_auth" id="btnSaveMultiData" ><span data-labelCd="저장">저장</span></button>
                                </div>
                                <div class="grid_box">
                                    <div class="h-400" data-ax5grid="multi_input_grid" ></div>
                                </div>

                            </div>
                        </div>
                    </div>

                </section>


            </div>

        </section>
        <section class="popupcontent" >
            <div class="align_left">

                <button type="button" class="btn-popup" id="modal-close-button"><span data-labelCd="닫기">닫기</span></button>
            </div>
        </section>

    </div>
</script>

<script type="text/x-tmpl" id="matMovePopup">
    <form id="materialMoveForm">
    <div class="content_wrap popup">
        <section class="pt-2">
            <div class="table_box search">
                <div class="row">
                    <div class="title_box">
                         <span class="tal" data-labelCd="창고선택">창고 선택</span>
                    </div>
                    <div class="col-6">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text fit_box_md" data-labelCd="From 창고">From 창고</span>
                            </div>
                             <select class="form-control2 tac" id="cboFrom" name="from" ></select>
                        </div>
                    </div>

                    <div class="col-6">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text fit_box_md" data-labelCd="To 창고">To 창고</span>
                            </div>
                             <select class="form-control2 tac" id="cboTo" name="to" ></select>
                        </div>
                    </div>

                    <div class="title_box">
                         <span class="tal" data-labelCd="제품 생산 수량 기준">제품 생산 수량 기준</span>
                    </div>

                    <div class="col-6">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text fit_box_md" data-labelCd="제품/반제품">제품/반제품</span>
                            </div>
                            <select class="form-control2" id="cboMaterialType" name="MaterialType">
                                                <option value='product' data-labelCd="제품">제품</option>
                                                <option value='semi' data-labelCd="반제품">반제품</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-6">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text fit_box_md" data-labelCd="제품">제품</span>
                            </div>
                             <select class="form-control2" id="cboMaterial" name="Material_id" ></select>
                        </div>
                    </div>

                    <div class="col-6">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text fit_box_md" data-labelCd="기준수량">기준수량</span>
                            </div>
                             <input class="form-control2 tar" type="number" id='moveQuantity' name="moveQuantity" />
                        </div>
                    </div>

                    </div>

            </div>

            <div class="grid_box">
                <div class="title_box">
                    <button type="button" class="btn-popup" id="btnMatSearch"><span data-labelCd="조회">조회</span></button>
                    <button type="button" class="btn-popup y_write_auth" id="btnMoveAction"><span data-labelCd="이동처리">이동처리</span></button>
                </div>
                <div class="h-400" data-ax5grid="material-grid" ></div>
            </div>

        </section>

        <section class="popupcontent" >
            <div class="popup_button_group bottom align_left">
                <button type="button" class="btn-popup" id="modal-close-button"><span data-labelCd="닫기">닫기</span></button>
                <button type="button" class="btn-popup" id="btnTest"><span data-labelCd="새로고침">새로고침</span></button>
            </div>
        </section>

    </div>
    </form>
</script>

<script type="text/x-tmpl" id="lotInputPopup">
    <div class="content_wrap popup">
        <section class="pt-2">
            <div class="table_box sub">
                <form id="lotInputForm">
                    <input hidden="hidden" />
                    <div class="row">
                        <div class="col-6">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_md" data-labelCd="품목유형">품목유형</span>
                                </div>
                                <input type="text" class="form-control2" id="MaterialTypeName" name="MaterialTypeName" readonly />
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_md" data-labelCd="품목">품목</span>
                                </div>
                                <input type="text" class="form-control2" id="MaterialName" name="MaterialName" readonly />
                            </div>
                        </div>
                       <div class="col-6">
                            <div class="input-group" data-ax5picker="basic" id="popSrchDt1">
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_md" data-labelCd="기본유효일">기본유효일</span>
                                </div>
                                <input class="form-control2 tac" type="text" id="ValidDays" name="ValidDays" readonly />
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_md" data-labelCd="입고창고">입고창고</span>
                                </div>
                                <input class="form-control2" id="StoreHouseName" name="StoreHouseName" readonly />
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_md" data-labelCd="단위">단위</span>
                                </div>
                                <input class="form-control2 tac" type="text" id='UnitName' name="UnitName" readonly />
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_md" data-labelCd="입고수량">입고수량</span>
                                </div>
                                <input class="form-control2 tar" type="number" id='InputQty' name="InputQty" />
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="input-group" data-ax5picker="basic" id="popSrchDt1">
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_md" data-labelCd="유효일시">유효일시</span>
                                </div>
                                <input class="form-control2 tac" type="text" id="EffectiveDate" name="EffectiveDate">
                                <span class="input-group-text fs-xl"><i class="fas fa-calendar-alt calendar_color" ></i></span>
                            </div>
                        </div>

                        <div class="col-6">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_md" data-labelCd="로트당수량">로트당수량</span>
                                </div>
                                <input class="form-control2 tar" type="number" id='LotSize' name="LotSize" />
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_md" data-labelCd="입고번호">입고번호</span>
                                </div>
                                <input class="form-control2 tar" type="number" id='mio_pk' name="mio_pk" readonly />
                            </div>
                        </div>
                        <div class="col-2">
                            <button type="button" class="btn-default align_left" id="btnLotCalc"><span data-labelCd="로트계산">로트계산</span></button>
                        </div>
                    </div>
                </form>
            </div>

            <div class="grid_box">
                <div class="h-300" data-ax5grid="mat-lot-grid" ></div>
            </div>
        </section>
        <section class="popupcontent" >
            <div class="popup_button_group bottom align_left">
                <button type="button" class="btn-popup" id="modal-close-button"><span data-labelCd="닫기">닫기</span></button>
                <button type="button" class="btn-default" id="btnLotRefresh"><span data-labelCd="새로고침">새로고침</span></button>
                <button type="button" class="btn-default y_write_auth" id="btnLotSave"><span data-labelCd="로트저장">로트저장</span></button>
                <button type="button" class="btn-default" id="btnBarcordPrint"><span data-labelCd="바코드출력">바코드출력</span></button>
            </div>
        </section>
    </div>

</script>

<script type="text/x-tmpl" id="inputTestPopup">
    <div class="content_wrap popup">
        <section class="pt-2">
            <div class="table_box sub">
                <form id="lotInputForm">
                    <input hidden="hidden" />
                    <div class="row">
                        <div class="col-6">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_md" data-labelCd="검사유형">검사유형</span>
                                </div>
                                <select class="form-control2 tac" id="cboTestMaster" name="cboTestMaster" ></select>
                            </div>
                        </div>
                        <div class="col-6">
                        	<input type="hidden" id="testResultId" name="testResultId">
                        </div>
                        <div class="col-6">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_md" data-labelCd="품목유형">품목유형</span>
                                </div>
                                <input type="text" class="form-control2" id="MaterialTypeName" name="MaterialTypeName" readonly />
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_md" data-labelCd="품목코드">품목코드</span>
                                </div>
                                <input type="text" class="form-control2" id="MaterialCode" name="MaterialCode" readonly />
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_md" data-labelCd="품목명">품목명</span>
                                </div>
                                <input type="text" class="form-control2" id="MaterialName" name="MaterialName" readonly />
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_md" data-labelCd="입고일시">입고일시</span>
                                </div>
                            	<input class="form-control2 col-8" id="InoutDate" name="InoutDate" readonly />
                            	<input class="form-control2 col-4" id="InoutTime" name="InoutTime" readonly />
                            </div>
                       </div>
                        <div class="col-6">
                            <div class="input-group" data-ax5picker="basic" id="popSrchDt2">
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_md" data-labelCd="유효기한">유효기한</span>
                                </div>
                                <input class="form-control2 tac" id="EffectiveDate" name="EffectiveDate" readonly />
                            	<span class="input-group-text fs-xl"><i class="fas fa-calendar-alt calendar_color" ></i></span>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_md" data-labelCd="입고량">입고량</span>
                                </div>
                                <input type="text" class="form-control2 text-center" id="inputQty" name="inputQty" readonly />
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <div class="grid_box">
             		<div class="row">
                        <div class="col-4">
                            <div class="input-group" data-ax5picker="basic" id="popSrchDt3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_md" data-labelCd="검사일">검사일</span>
                                </div>
                                <input class="form-control2 tac" id="TestDate" name="testDate" readonly />
                            	<span class="input-group-text fs-xl"><i class="fas fa-calendar-alt calendar_color" ></i></span>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text fit_box_md" data-labelCd="검사자">검사자</span>
                                </div>
                                <input class="form-control2" id="TestName" name="testName" readonly />
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                     <button type="button" class="btn-default y_write_auth" id="btnAllItem"><span data-labelCd="전체적합">전체적합</span></button>
                                </div>
                            </div>
                  		 </div> 
           	 	</div>    
       	     	<div class="h-300 pt-2" data-ax5grid="mat_input_test_grid" ></div>
                
                <div class="row">
	                <div class="col-4">
	                    <div class="input-group">
	                        <div class="input-group-prepend">
	                            <span class="input-group-text fit_box_t4" data-labelCd="종합 판정">종합 판정</span>
	                        </div>
	                         <select class="form-control2" id="judgGroup" name="judgGroup"  ></select>
	                    </div>
	                </div>
	                <div class="col-8">
	                    <div class="input-group">
	                        <div class="input-group-prepend">
	                            <span class="input-group-text fit_box_t3" data-labelCd="부적합 시 조치내용">부적합 시 조치내용</span>
	                        </div>
	                         <textarea class="form-control2 tal" id="testRemark" name="testRemark"></textarea>
	                    </div>
	                </div>
                </div>
            </div>
        </section>
        <section class="popupcontent pb-2" style="overflow: hidden;" >
            <div class="popup_button_group bottom align_left">
                <button type="button" class="btn-default y_write_auth" id="btnTestSave"><span data-labelCd="저장">저장</span></button>
                <button type="button" class="btn-popup" id="modal-close-button"><span data-labelCd="닫기">닫기</span></button>
            </div>
        </section>
    </div>

</script>

<script type="text/x-tmpl" id="barcode_tmpl">
    <div class="content_wrap popup">
        <section class="pt-2" style="overflow:auto; height:600px;">
            <div class="row" id="barcodeDiv"></div>
        </section>
        <section class="popupcontent" >
            <div class="align_left">
                <button type="button" class="btn-popup" id="btnPopPrintBarcode" ><span data-labelCd="바코드인쇄">바코드인쇄</span></button>
                <button type="button" class="btn-popup" id="modal-close-button"><span data-labelCd="닫기">닫기</span></button>
            </div>
        </section>
    </div>
</script>

<script type="text/x-tmpl" id="barcode_table_tmpl">
    <table class="table_1" style="width: 400px;border-collapse: collapse;">
        <tr>
            <td class="tac">품목코드</td>
            <td>{%=o.MaterialCode%}</td>
            <td class="tac">보관방법</td>
            <td></td>
        </tr>
        <tr>
            <td class="tac">품명</td>
            <td colspan="3">{%=o.MaterialName%}</td>
        </tr>
        <tr>
            <td class="tac">LOT수량</td>
            <td>{%=o.InputQty%}</td>
            <td class="tac">포장단위</td>
            <td>{%=o.UnitName%}</td>
        </tr>

        <tr>
            <td class="tac">입고일자</td>
            <td colspan="3">{%=o.InputDateTime%}</td>
        </tr>
        <tr>
            <td class="tac">유효기한</td>
            <td colspan="3">{%=o.EffectiveDate%}</td>
        </tr>
        <tr>
            <td colspan="4" class="barcode_td">
            </td>
        </tr>
    </table>
    <div style="width:auto;height;0px;page-break-before:always;line-height:5px;">&nbsp;</div>

</script>
</th:block>


<th:block layout:fragment="scripts">
<script type="text/javascript" src="/resource/jsBarcode/JsBarcode.all.min.js"></script>
<th:block th:replace="/common/popup_material_multi :: popup_material_multi"></th:block>
<th:block th:replace="/common/columns_setting :: columns_setting" ></th:block>

<script type="text/javascript">
    class materialStorehouse {
        constructor() {
            this.url = '/api/inventory/material_inout';
            this.grid = null;
            this.init();
        }
        setClassName(e) {
            let classNmae = '';
            if (e.key === 'CurrentStock') {
                if (e.item.CurrentStock < e.item.SafetyStock)
                    classNmae = 'redText';
            }
            return classNmae;
        }

        init() {
            let _this = this;
            let config = {
                target: $('[data-ax5grid="material-storehouse-grid"]'),
                frozenColumnIndex: 0, // 열 고정
                frozenRowIndex: 0,    // 행 고정
                showLineNumber: true, // 열의 번호 보이기 여부
                showRowSelector: false,  // checkbox(선택) 보이기 여부
                multipleSelect: false, // 여러행 선택 가능 여부 (false시 단독 선택)
                sortable: true, // 모든 컬럼에 정렬 아이콘 표시 (columns에서 컬럼별 소팅여부 재설정 가능)
                multiSort: true, // 다중 정렬 여부
                header: {
                    align: 'center',  // 헤더의 기본 정렬
                    columnHeight: 38  // 헤더 높이
                },
                body: {
                    columnHeight: 25, // body의 기본 높이
                    onClick: function (e) {
                        _this.grid.select(this.dindex);
                    }
                },
                page: {
                    display: true,
                    statusDisplay: true,
                },
                columns: [
                    { key: 'mio_pk', label: '입고번호', width: 100, align: 'center', },
                    { key: 'store_house_name', label: '창고', width: 100, align: 'center', },
                    { key: 'inout_state', label: '입고 상태', width: 100, align: 'center', },
                    { key: 'state_name', label: '입고검사 결재', width: 100, align: 'center', },
                    { key: 'judge_code', label: '입고검사 판정', width: 100, align: 'center', },
                    { key: 'lot_use', label: '로트관리유무', width: 100, align: 'center', },
                    { key: 'inout', label: '입출', width: 100, align: 'center', },
                    { key: 'inout_type', label: '구분', width: 100, align: 'center', },
                    { key: 'material_type', label: '품목유형', width: 100, align: 'center' },
                    { key: 'material_code', label: '품목코드', width: 100, align: 'center' },
                    { key: 'material_name', label: '품목명', width: 250, align: 'left' },
                    { key: 'unit_name', label: '단위', width: 50, align: 'center' },
                    { key: 'InoutDate', label: '입출일', width: 100, align: 'center', },
                    { key: 'InoutTime', label: '시간', width: 50, align: 'center', },
                    { key: 'potentialInputQty', label: '가입고량', width: 100, align: 'right', formatter: 'money'},
                    {
                        key: 'InputQty', label: '입고량', width: 90, align: 'right',
                        formatter: 'money',
                    },
                    {
                        key: 'OutputQty', label: '출고량', width: 90, align: 'right',
                        formatter: 'money',
                    },
                    { key: 'Description', label: '비고', width: 150, align: 'left' },
                    {
                        key: 'HouseStock', label: '창고재고', width: 100, align: 'right',
                        formatter: 'money',
                        styleClass: function (e) {
                            return _this.setClassName(this);
                        },
                    },
                    { key: 'lot_count', label: '로트개수', width: 100, align: 'center', sortable: false },
                    {
                        key: 'CurrentStock', label: '전체재고', width: 100, align: 'right',
                        formatter: 'money',
                        styleClass: function (e) {
                            return _this.setClassName(this);
                        },
                    },
                    {
                        key: 'SafetyStock', label: '안전재고', width: 100, align: 'right',
                        formatter: 'money'
                    }
                ]
            };
            this.grid = new ax5.ui.grid(config);
            this.grid_config = config;

            //로트입고 버튼클릭
            $('#btnLotInput').click(function (e) {
                _this.showLotInputPopup();
            });
            
            $('#btnInputTest').click(function (e) {
                _this.showInputTestPopup();
            });
        }

        exportExcel() {
            var targetview = this.grid;
            // 현재 html코드로 데이터 만들어 확장자만 xls로 변경해주고 있음
            targetview.exportExcel('자재입출고내역.xls');
        }

        searchDataBind() {
            let _this = this;
            let srchStartDt = $('#searchForm').find("#srchStartDt").val();
            let srchEndDt = $('#searchForm').find("#srchEndDt").val();
            let house_pk = $('#searchForm').find('#cboHouse').val();
            let mat_type = $('#searchForm').find('#cboMatType').val();
            let mat_grp_pk = $('#searchForm').find('#cboMatGroup').val();
            let txtMatName = $('#searchForm').find('#txtMatName').val();
            let data = {
                'action': 'read',
                'srchStartDt': srchStartDt,
                'srchEndDt': srchEndDt,
                'house_pk': house_pk,
                'mat_type': mat_type,
                'mat_grp_pk': mat_grp_pk,
                'keyword': txtMatName
            };

            let result = AjaxUtil.getSyncData(this.url + "/read", data);
            if (result.data != null) {
                let recordsTotal = result.data.length;
                _this.grid.setData({
                    list: result.data,
                    page: {
                        display: true,
                        totalElements: recordsTotal,
                    }
                });
            }
        }

        addDataPopup(type) {
            let _this = this;
            let content = tmpl('addDataPopup', {});
            let $content = $(content);
            let form = $('#materialInoutForm');

            let modalContainer = null;
            if (type === 'in') {
                modalContainer = new PopupDraggable('품목 입고');
            }
            else {
                modalContainer = new PopupDraggable('품목 출고');
            }


            modalContainer.open({ width: 600, height: 400, $content });
            popup = new materialInoutPopup();
            //AjaxUtil.fillSelectOptions($content.find('#StoreHouse_id'), 'store_house', 'choose', 3);    // 3:자재창고
            AjaxUtil.fillSelectOptions($content.find('#StoreHouse_id'), 'store_house', 'choose', '');    // 3:자재창고

            AjaxUtil.fillSelectOptions($content.find('#cboMaterialType'), 'system_code', 'choose', '', 'mat_type');
            AjaxUtil.fillSelectOptions($content.find('#cboMaterialGroup'), 'material_group', 'choose', '', '');
            //AjaxUtil.fillSelectOptions($content.find('#cboMaterialGroup'), 'material_group', 'choose', '', 'raw_mat');
            AjaxUtil.fillSelectOptions($content.find('#Material_id'), 'material', 'choose', '');
            //$content.find('select').select2();

            if (type === 'in') {
                $content.find('#dialog_title').innerHTML = '품목 입고';
                AjaxUtil.fillSelectOptions($content.find('#InoutType'), 'system_code', '', 'etc_in', 'input_type');
            }
            else {
                $content.find('#dialog_title').innerHTML = '품목 출고';
                AjaxUtil.fillSelectOptions($content.find('#InoutType'), 'system_code', '', 'etc_out', 'output_type');
            }

            $content.find('#cboMaterialType').on('change', function (e) {
                let mat_type = $content.find('#cboMaterialType').val();
                AjaxUtil.fillSelectOptions($content.find('#cboMaterialGroup'), 'material_group', 'choose', '', mat_type);
            });

            $content.find('#cboMaterialGroup').on('change', function (e) {
                let mat_group = $content.find('#cboMaterialGroup').val();
                AjaxUtil.fillSelectOptions($content.find('#Material_id'), 'material', 'choose', '', mat_group);
            });
			
			$content.find('#btnMaterial').click(function () {
				let searchcallback = function (items) {
                    $content.find('#cboMaterialType').val(items[0].MaterialTypeCode)
                    $content.find('#cboMaterialGroup').val(items[0].MaterialGroup_id)
                    $content.find('#Material_id').val(items[0].id)
                };
                
				let poppage = new PopupMaterialPage('single');
                let $poppage = $(poppage);
                poppage.show(searchcallback);
			});
			
            $content.find('#btnSave').on('click', function () {
                if (!$('#cboMaterialGroup').val()) {
                    Alert.alert('', '품목그룹을 선택하세요.');
                    return false;
                }
                if (!$('#Material_id').val()) {
                    Alert.alert('', '품목을 선택하세요.');
                    return false;
                }
                if (!$('#StoreHouse_id').val()) {
                    Alert.alert('', '창고를 지정하세요.');
                    return false;
                }
                    
                if ($('#InoutQty').val() == "" || $('#InoutQty').val() <= 0) {
                    Alert.alert('', '수량을 확인해 주세요.');
                    return false;
                }

                popup.saveData(type, form);

                modalContainer.modal.close();
            });
        }

        addMultiDataPopup(type) {
            let _this = this;
            let content = tmpl('addMultiDataPopup', {});
            let $content = $(content);
            //let form = $('#mat_multi_input_form');
            modalContainer = new PopupDraggable('품목 다중입고 등록');

            modalContainer.open({ width: 600, height: 800, $content });
            popup = new matMultiInPopup($content);
        }

        showLotInputPopup() {
            let _this = this;
            let items = _this.grid.getList('selected');
            if (items.length == 0) {
                Alert.alert('로트입고등록', '선택된 입고 데이터가 없습니다. ', function () { });
                return;
            }
            if (items[0].inout_state == '미확인') {
            	Alert.alert('로트입고등록', '가입고 자재는 로트입고 할 수 없습니다. ', function () { });
                return;
			}
            let item = items[0];
            let content = tmpl('lotInputPopup', {});
            let $content = $(content);
            let modalContainer = new PopupDraggable('로트입고등록');
            modalContainer.open({ width: 800, height: 600, $content });

            let config = {
                target: $content.find('[data-ax5grid="mat-lot-grid"]'),
                frozenColumnIndex: 0, // 열 고정
                frozenRowIndex: 0,    // 행 고정
                showLineNumber: true, // 열의 번호 보이기 여부
                showRowSelector: false,  // checkbox(선택) 보이기 여부
                multipleSelect: false, // 여러행 선택 가능 여부 (false시 단독 선택)
                sortable: true, // 모든 컬럼에 정렬 아이콘 표시 (columns에서 컬럼별 소팅여부 재설정 가능)
                multiSort: true, // 다중 정렬 여부
                header: {
                    align: 'center',  // 헤더의 기본 정렬
                    columnHeight: 30  // 헤더 높이
                },
                body: {
                    columnHeight: 25, // body의 기본 높이
                    onClick: function (e) {
                        _this.grid.select(this.dindex);
                    }
                },
                page: {
                    display: true,
                    statusDisplay: true,
                },
                columns: [
                    { key: 'LotNumber', label: '로트번호', width: 120, align: 'center' },
                    { key: 'UnitName', label: '단위', width: 50, align: 'center' },
                    { key: 'InputDateTime', label: '입고일시', width: 120, align: 'center' },
                    { key: 'EffectiveDate', label: '유효일시', width: 120, align: 'center' },
                    { key: 'InputQty', label: '수량', width: 100, align: 'right', formatter: 'money' },
                    {
                        key: 'Description', label: '<span class="editable_clr">비고</span>', width: 200, align: 'left',
                        editor: {
                            type: 'text',
                        }
                    }
                ]
            };

            this.matLotGrid = new ax5.ui.grid(config);
            let $EffectiveDate = $content.find('#EffectiveDate');
            let $MaterialTypeName = $content.find('#MaterialTypeName');
            let $MaterialName = $content.find('#MaterialName');
            let $ValidDays = $content.find('#ValidDays');
            let $StoreHouseName = $content.find('#StoreHouseName');
            let $UnitName = $content.find('#UnitName');
            let $LotSize = $content.find('#LotSize');
            let $mio_pk = $content.find('#mio_pk');
            let $InputQty = $content.find('#InputQty');
            let $btnLotCalc = $content.find('#btnLotCalc');
            let $btnLotSave = $content.find('#btnLotSave');
            let $btnLotRefresh = $content.find('#btnLotRefresh');

            $EffectiveDate.ax5DatePicker({ direction: 'top' });
            $MaterialTypeName.val(item.material_type);
            $MaterialName.val(item.material_name);
            $mio_pk.val(item.mio_pk);
            $UnitName.val(item.unit_name);
            $LotSize.val(item.PackingUnitQty);
            $StoreHouseName.val(item.store_house_name);
            $InputQty.val(item.InputQty);
            $ValidDays.val(item.ValidDays);
            if (item.ValidDays) {
                let valDate = CommonUtil.getYYYYMMDD(item.ValidDays);
                $EffectiveDate.val(valDate);
            }

            let fnLoadLotList = function (mio_pk) {
                let fnsuccess = function (result) {
                    if (result.data.length > 0) {
                        //$btnLotSave.prop('disabled', 'disabled');
                        $btnLotCalc.prop('disabled', 'disabled');
                    }
                    _this.matLotGrid.setData(result.data);
                };
                let lotParam = {
                    mio_id: mio_pk,
                    action: 'mio_lot_list'
                };
                AjaxUtil.getAsyncData(_this.url + '/mio_lot_list', lotParam, fnsuccess);

            };

            fnLoadLotList(item.mio_pk);

            // 로트계산버튼 클릭
            $btnLotCalc.click(function (e) {
                _this.matLotGrid.setData([]);

                if ($EffectiveDate.val() == '' || $EffectiveDate.val() == null) {
			        Alert.alert('로트저장', '유효 일시를 입력해주세요.', function () { });
                    return;
				}
				
                let inputQty = $InputQty.val();
                let lotSize = $LotSize.val();
                let effectedDate = $EffectiveDate.val();

                if (inputQty == '' || inputQty == 0) {
                    alert(1);
                    return;
                }
                if (lotSize == '' || lotSize == 0) {
                    alert(2);
                    return;
                }
                let lotCount = (inputQty / lotSize);
                if (lotCount < 1) {
                    alert(3);
                    return;
                }
                lotCount = Math.ceil(lotCount);
                let remainQty = Number(inputQty);
                let now = CommonUtil.getYYYYMMDD();

                for (let idx = 0; idx < lotCount; idx++) {
                    let qty = lotSize;
                    if (remainQty < qty) {
                        qty = remainQty;
                    }
                    let r = {
                        InputQty: qty,
                        UnitName: item.unit_name,
                        InputDateTime: now,
                        Description: item.Description,
                        mio_id: item.mio_pk,
                        EffectiveDate: effectedDate,
                        LotNumber: ''
                    };

                    _this.matLotGrid.addRow(r);
                    remainQty = remainQty - qty;
                }

            });



            let $btnBarcordPrint = $content.find('#btnBarcordPrint');

            // 바코드출력
            $btnBarcordPrint.click(function (e) {
                let lotItems = _this.matLotGrid.getList();
                if (lotItems.length == 0) {
                    return;
                }
                let barcodeItems = [];
                $.each(lotItems, function (idx, lotItem) {
                    if (lotItem.LotNumber) {
                        barcodeItems.push(lotItem);
                    }
                });

                if (barcodeItems.length > 0) {
                    _this.showBarcodePrint(barcodeItems);
                }
            });

            // 로트저장
            $btnLotSave.click(function (e) {
                let lotItems = _this.matLotGrid.getList()
                if (lotItems.length == 0) {
                    Alert.alert('로트저장', '저장할 로트가 없습니다.', function () { });
                    return;
                }
                
                if ($EffectiveDate.val() == '' || $EffectiveDate.val() == null) {
			        Alert.alert('로트저장', '유효 일시를 입력해주세요.', function () { });
                    return;
				}
                let qty = Number($InputQty.val());
                let strLots = JSON.stringify(lotItems);
                let url = _this.url + '/lot_save';
                let sendData = {
                    mio_id: item.mio_pk,
                    Material_id: item.Material_id,
                    StoreHouse_id: item.StoreHouse_id,
                    Q: strLots
                };

                let lotSaveCallback = function (result) {
                    if (result.success) {
                        Notify.success('저장했습니다.');

                        fnLoadLotList(item.mio_pk);
                    } else {
                        Notify.error('에러가 발생했습니다.');
                    }
                };
                AjaxUtil.postAsyncData(url, sendData, lotSaveCallback);
            });

            // 새로고침
            $btnLotRefresh.click(function (e) {
                fnLoadLotList(item.mio_pk);
            });
        }

		//입고 검사
        showInputTestPopup() {
            let _this = this;
            let items = _this.grid.getList('selected');
            if (items.length == 0) {
                Alert.alert('입고검사', '선택된 입고 데이터가 없습니다. ', function () { });
                return;
            } else if (items[0].inout_state != '미확인') {
                Alert.alert('입고검사', '가입고 재고만 입고검사 할 수 있습니다. ', function () { });
                return;	
			}
            let item = items[0];
            let content = tmpl('inputTestPopup', {});
            let $content = $(content);
            let modalContainer = new PopupDraggable('입고검사');
            modalContainer.open({ width: 800, height: 650, $content });

            let config = {
                target: $content.find('[data-ax5grid="mat_input_test_grid"]'),
                frozenColumnIndex: 0, // 열 고정
                frozenRowIndex: 0,    // 행 고정
                showLineNumber: true, // 열의 번호 보이기 여부
                showRowSelector: false,  // checkbox(선택) 보이기 여부
                multipleSelect: false, // 여러행 선택 가능 여부 (false시 단독 선택)
                sortable: true, // 모든 컬럼에 정렬 아이콘 표시 (columns에서 컬럼별 소팅여부 재설정 가능)
                multiSort: true, // 다중 정렬 여부
                header: {
                    align: 'center',  // 헤더의 기본 정렬
                    columnHeight: 30  // 헤더 높이
                },
                body: {
                    columnHeight: 25, // body의 기본 높이
	                    onClick: function (e) {
	                        if (e.column.key == 'result1' && e.item.resultType == 'S') {                
								if (!e.item.result1) {
	                                e.item.result1 = 'O';
									_this.matTestGrid.repaint();                                
								}
								else if (e.item.result1 == 'O') {
	                                e.item.result1 = 'X';
									_this.matTestGrid.repaint();        
								}
								else if (e.item.result1 == 'X') {
	                                e.item.result1 = null;
									_this.matTestGrid.repaint();
								}
					
	                        }                       
	                    },
                },
                page: {
                    display: true,
                    statusDisplay: true,
                },
                columns: [
                    { key: 'name', label: '검사항목', width: 200, align: 'left' },
                    						{
					  key: 'result1', label: '<span class="editable_clr">결과값(입력)</span>', width: 400, align: 'center',editor: {type: 'text'}
					},

                ]
            };

            this.matTestGrid = new ax5.ui.grid(config);
            this.tabType = this.matTestGrid;
            
            let $EffectiveDate = $content.find('#EffectiveDate');
            let $MaterialTypeName = $content.find('#MaterialTypeName');
            let $MaterialName = $content.find('#MaterialName');
            let $MaterialCode = $content.find('#MaterialCode');
            let $InoutDate = $content.find('#InoutDate');
            let $InoutTime = $content.find('#InoutTime');
			let $btnTestSave = $content.find('#btnTestSave');
			let $btnAllItem = $content.find('#btnAllItem');
			let $TestDate = $content.find('#TestDate');
			let $TestName = $content.find('#TestName');
			let $judgGroup = $content.find('#judgGroup');
			let $testRemark = $content.find('#testRemark');
			let $inputQty = $content.find('#inputQty');
			let $cboTestMaster = $content.find('#cboTestMaster');
			let $testResultId = $content.find('#testResultId');
			
			$EffectiveDate.ax5DatePicker({ direction: 'top' });
            $TestDate.ax5DatePicker({ direction: 'top' });
            $MaterialTypeName.val(item.material_type);
            $MaterialName.val(item.material_name);
            $MaterialCode.val(item.material_code);
            $InoutDate.val(item.InoutDate);
            $InoutTime.val(item.InoutTime);
            $inputQty.val(item.InputQty)
            
            if (item.ValidDays) {
                let valDate = CommonUtil.getYYYYMMDD(item.ValidDays);
                $EffectiveDate.val(valDate);
            }
			$TestDate.val(CommonUtil.getYYYYMMDD());
			$TestName.val(userinfo.username);
			
			AjaxUtil.fillSelectOptions($cboTestMaster, 'test_master', 'choose', false, '','','import');
			
			$cboTestMaster.val(12)
			AjaxUtil.fillSelectOptions($judgGroup, 'system_code', 'choose', false, 'judg_code');
            
            let fnLoadTestList = function (mio_pk) {
                let fnsuccess = function (result) {
                    if (result.data !== null) {
                    _this.matTestGrid.setData(result.data.mioList);
                    
					if (result.data.testDate != null) {
						$TestDate.val(result.data.testDate);
					}
					if (result.data.CheckName != null) {
						$TestName.val(result.data.CheckName);
					}
					
					if (result.data.EffectiveDate != null) {
						$EffectiveDate.val(result.data.EffectiveDate)
					}
					
					if (result.data.testResultId != null) {
						$testResultId.val(result.data.testResultId)
					}
					
					if (result.data.testMasterId != null) {
						$cboTestMaster.val(result.data.testMasterId)
					}
					$judgGroup.val(result.data.JudgeCode);
					$testRemark.val(result.data.CharResult);
					}
                };
                let testParam = {
                    mio_id: mio_pk,
                    test_result_id : $testResultId.val(),
                    action: 'mio_test_list'
                };
                AjaxUtil.getAsyncData(_this.url + '/mio_test_list', testParam, fnsuccess);

            };

            fnLoadTestList(item.mio_pk);
            
			$btnAllItem.click(function(e) {
                _this.tabType.list.forEach(function (item, idx) {
					if (item.resultType == 'S')	{
					 item.result1 = 'O';
					}				
				});
				_this.tabType.repaint();
			})
            // 입고검사 저장
            $btnTestSave.click(function (e) {
                let testItems = _this.matTestGrid.getList()
                
                if (testItems.length == 0) {
                    Alert.alert('검사저장', '저장할 입고내역이 없습니다.', function () { });
                    return;
                }

				if ($cboTestMaster.val() == '') {
					Alert.alert('검사저장', '검사유형을 선택하세요.', function () { });
                    return;
				}
                let url = _this.url + '/test_save';
                let sendData = {
                    mio_id: item.mio_pk,
                    test_mast_id : $cboTestMaster.val(),
                    test_result_id : $testResultId.val(),
                    test_date: $TestDate.val(),
                    judg_grp: $judgGroup.val(),
                    material_id: item.Material_id,
                    testRemark: $testRemark.val(),
                    effective_date: $EffectiveDate.val(),
                    Q: JSON.stringify(testItems)
                };
				
                let testSaveCallback = function (result) {
                    if (result.success) {
                        Notify.success('저장했습니다.');
                        $content.find('#modal-close-button').click();
                        page.searchDataBind()
                    } else {
                        Notify.error('에러가 발생했습니다.');
                    }
                };
                AjaxUtil.postAsyncData(url, sendData, testSaveCallback);
            });
        }
        
        showBarcodePrint(barcodeItems) {

            let _this = this;
            let content = tmpl('barcode_tmpl', {});
            let $content = $(content);
            let modalContainer = new PopupDraggable('바코드 출력');
            modalContainer.open({ width: 500, height: 680, $content });
            let $barcodeDiv = $content.find('#barcodeDiv');

            $.each(barcodeItems, function (idx, item) {
                let svg_id = "barcode_" + item.LotNumber;
                let svg = "<div class='col-12'><svg id='" + svg_id + "'></svg></div>";

                let tmp_table = tmpl('barcode_table_tmpl', item);
                let $tmp_table = $(tmp_table);
                $tmp_table.find('.barcode_td').append(svg);

                $barcodeDiv.append($tmp_table);
            });

            $.each(barcodeItems, function (idx, item) {
                let svg_id = "#barcode_" + item.LotNumber;

                // use options
                JsBarcode(svg_id, item.LotNumber, {
                    format: 'code128', // 바코드 포맷 / default: code128 / options: EAN, UPC, CODE39, ITF-14, MSI, Pharmacode, Codabar (각 옵션들에 대한 설명은 사이트 참조)
                    width: 2, // 너비 / default: 2
                    height: 100, // 높이 / default: 100
                    displayValue: true, // 텍스트 표시 여부 / default: true
                    text: item.LotNumber, // 데이터 대신 특정 텍스트 표시 / default: undefined
                    fontOptions: '', // 폰트 설정 / default: '' / options: bold, italic, bold italic
                    font: 'monospace', // 폰트 / default: monospace / options: fantasy, etc... 사이트 참조
                    textAlign: 'center', // 텍스트 위치 / default: center / options: left, center, right
                    textPosition: 'bottom', // 텍스트 위치 / default: bottom / options: top, bottom
                    textMargin: 2, // 바코드와 텍스트 사이 여백 / default: 2
                    fontSize: 20, // 폰트 크기 / default: 20
                    background: '#ffffff', // 바코드 배경 색 / default: #ffffff
                    lineColor: '#000000', // 바코드 라인 색 / default: #000000
                    margin: 10, // 바코드 영역 주변 여백 / default: 10
                });
            });

            let $btnPopPrintBarcode = $content.find('#btnPopPrintBarcode');

            // 바코드 인쇄 버튼 클릭
            $btnPopPrintBarcode.click(function (e) {
                var popupWindow = window.open("barcode_print", "_blank", "width=400px");
                let css = $('#print_css')[0].outerHTML;
                
                let html = $barcodeDiv.html();
                popupWindow.document.write(css);
                popupWindow.document.write(html);
                popupWindow.print();
            });
        }
    }

    class materialInoutPopup {
        constructor() {
            this.grid = null;
            this.init();
        }

        init() {
            let _this = this;
        }

        saveData(type, form) {

            let url = '/api/inventory/material_inout/save';
            let data = FormUtil.extractForm($('#materialInoutForm'));
            data['type'] = type;
            let fnSuccess = function (res) {
                if (!res.success) {
                    Alert.alert('', res.message);
                } else {
                    Notify.success('저장되었습니다');
                    page.searchDataBind();
                }
            };

            AjaxUtil.postAsyncData(url, data, fnSuccess);
        }
    }


    class matMultiInPopup {
        constructor($content) {
            this.grid = null;

            this.$content = $content;
            this.init();
        }

        init() {
            let _this = this;
            let $content = this.$content;

            // 다중입고 그리드 팝업
            let multi_pop_config = {
                target: $('[data-ax5grid="multi_input_grid"]'),
                frozenColumnIndex: 0, // 열 고정
                frozenRowIndex: 0,    // 행 고정
                showLineNumber: true, // 열의 번호 보이기 여부
                showRowSelector: false,  // checkbox(선택) 보이기 여부
                multipleSelect: false, // 여러행 선택 가능 여부 (false시 단독 선택)
                sortable: true, // 모든 컬럼에 정렬 아이콘 표시 (columns에서 컬럼별 소팅여부 재설정 가능)
                multiSort: true, // 다중 정렬 여부
                header: {
                    align: 'center',  // 헤더의 기본 정렬
                    columnHeight: 38  // 헤더 높이
                },
                body: {
                    columnHeight: 25, // body의 기본 높이
                    onClick: function (e) {
                        //_this.multi_input_grid.select(this.dindex);
                    }
                },
                page: {
                    display: true,  // 페이징 보이기 여부
                    statusDisplay: true,
                },
                columns: [                  //컬럼 key 변경 필요
                    { key: 'mat_code', label: '품목코드', width: 100, align: 'center' },
                    {
                        key: 'mat_name', label: '품목명', width: 200, align: 'left',
                        styleClass: function (e) {
                            return (this.item.mat_name) ? 'grid-cell-white' : 'grid-cell-red';
                        },
                    },
                    {
                        key: 'input_qty', label: '수량', width: 100, align: 'right',
                        formatter: 'money',
                    },

                ]
            };
            _this.grid = new ax5.ui.grid(multi_pop_config);

            AjaxUtil.fillSelectOptions($content.find('#StoreHouse_id'), 'store_house', 'choose', 3);    // 3:자재창고
            $content.find('#dialog_title').innerHTML = '품목입고 등록';
            AjaxUtil.fillSelectOptions($content.find('#InoutType'), 'system_code', '', 'order_in', 'input_type');
            AjaxUtil.fillSelectOptions($content.find('#Company_id'), 'company', 'choose', '', 'purchase');
            $content.find('#cboMaterialGroup').on('change', function (e) {
                let mat_group = $content.find('#cboMaterialGroup').val();
                AjaxUtil.fillSelectOptions($content.find('#Material_id'), 'material', 'choose', '', mat_group);
            });

            $content.find('#btnTextToGrid').on('click', function () {
                _this.checkMultiData();
                return;
            });
            $content.find('#btnSaveMultiData').on('click', function () {
                popup.saveMultiData();
                //modalContainer.modal.close();
            });

            $content.find('a[name=tab_copy_text]').trigger('click');
            // $content.find('#tab_copy_text').attr("data-tablink")).addClass("hidden");
        }

        getListFromText() {
            let _this = this;
            let $content = this.$content;
            let copyText = $content.find("#txtCopyText").val();
            let line = copyText.split('\n');
            let items = [];
            for (let i = 0; i < line.length; i++) {
                let data = line[i].split('\t');
                let mat_code = data[0];
                let input_qty = data[1];
                items.push({ 'mat_code': mat_code, 'input_qty': input_qty });
            }
            return items;
        }

        copyToGrid() {
            let _this = this;
            let $content = this.$content;
            this.grid.setData([]);  // grid 초기화
            let copyText = $content.find("#txtCopyText").val();
            let line = copyText.split('\n');
            for (let i = 0; i < line.length; i++) {
                let data = line[i].split('\t');
                let mat_code = data[0];
                let input_qty = data[1];
                if (mat_code === '' || input_qty === '') {
                    line.splice(i, 1);
                    continue;
                }
                this.grid.addRow($.extend({}, { 'mat_code': mat_code, 'input_qty': input_qty }), "last");
            }
        }

        checkMultiData() {
            let _this = this;
            let url = '/api/inventory/material_inout';
            let grid_data = this.getListFromText();
            let data = {
                action: 'trans_multi_input_data',
                Q: JSON.stringify(grid_data)
            };
            let result = AjaxUtil.getSyncData(url + "/trans_multi_input_data", data);
            if (result != null) {
                let count = result.data.length;
                _this.grid.setData({
                    list: result.data,
                    page: {
                        display: true,
                        totalElements: count,
                    }
                });
            }
        }

        saveMultiData() {

            let url = '/api/inventory/material_inout/save_multi_data';
            let data = FormUtil.extractForm($('#mat_multi_input_form'));
            data['type'] = 'in';
            let grid_data = this.grid.getList();
            let bad_count = 0;
            grid_data.forEach(function (value, index) {
                if (!value.mat_name)
                    bad_count++;
            });
            if (bad_count > 0) {
                Alert.alert('품목코드 확인', '품목명 없는 품목코드가 있습니다.');
                return false;
            }

            data['Q'] = JSON.stringify(grid_data);
            //let fnSuccess = function (res) {
            //    if (!res.success) {
            //        Alert.alert('', res.message);
            //    } else {
            //        Notify.success('저장되었습니다');
            //        page.searchDataBind();
            //    }
            //};

            //AjaxUtil.postAsyncData(url, data, fnSuccess);
            let res = AjaxUtil.postSyncData(url, data);
            if (!res.success) {
                Alert.alert('', res.message);
                return false;
            }
            else {
                Notify.success('저장되었습니다');
                page.searchDataBind();
                modalContainer.modal.close();
            }
        }
    }


    class MaterialMove {
        constructor() {
            this.grid = null;
        }

        initGird($grid) {
            let _this = this;
            let config = {
                target: $($grid),
                sortable: true,
                frozenColumnIndex: 0, // 열 고정
                frozenRowIndex: 0,    // 행 고정
                showLineNumber: false, // 열의 번호 보이기 여부
                showRowSelector: true,  // checkbox(선택) 보이기 여부
                multipleSelect: false, // 여러행 선택 가능 여부 (false시 단독 선택)
                sortable: true, // 모든 컬럼에 정렬 아이콘 표시 (columns에서 컬럼별 소팅여부 재설정 가능)
                multiSort: true, // 다중 정렬 여부
                header: {
                    align: 'center',  // 헤더의 기본 정렬
                    columnHeight: 30  // 헤더 높이
                },
                body: {
                    columnHeight: 25, // body의 기본 높이
                    onDBLClick: function () {
                        //_this.grid.select(this.dindex);
                        _this.selectData(this.item);
                        _this.selectedItem = this.item;
                    },
                    onDataChanged: function () {
                        if (this.key === 'move_qty') {
                            _this.grid.select(this.dindex, { 'selected': true });

                            if (this.item.house_stock < this.item.move_qty) {
                                this.item.move_qty = this.item.house_stock;
                            }

                            if (this.item.move_qty > 0) {
                            }
                        }
                    }

                },
                page: {
                    display: true,  // 페이징 보이기 여부
                    statusDisplay: true,
                },
                columns: [
                    { key: 'mat_type_name', label: '품목구분', width: 100, align: 'center', sortable: false },
                    { key: 'mat_code', label: '품목코드', width: 100, align: 'left', sortable: false },
                    { key: 'mat_name', label: '품목', width: 250, align: 'left', sortable: false },
                    { key: 'unit_name', label: '단위', width: 100, align: 'center', sortable: false },
                    {
                        key: 'house_stock', label: '창고재고', width: 100, align: 'right', sortable: false,
                        formatter: 'money',
                        styleClass: function () {
                            let data = this.item.house_stock;
                            return (data <= 0) ? 'grid-cell-red' : 'grid-cell-white';
                        }

                    },
                    {
                        key: 'move_qty', label: '이동량(입력수정)', width: 150, align: 'right', sortable: false,
                        editor: { type: 'number' },
                        styleClass: function () {
                            let data = ax5.util.number(this.item.move_qty);
                            return (data > 0) ? 'grid-cell-blue' : 'grid-cell-white';
                        }
                    }
                ]
            };

            this.grid = new ax5.ui.grid(config);

            //새로고침
            let $btnTest = $('#btnTest');

            $btnTest.click(function (e) {
                _this.grid.init().repaint();
            });
        }

        searchMaterial() {
            let _this = this;

            let from = this.$cboFrom.val();
            let to = this.$cboTo.val();
            let material_id = this.$cboMaterial.val();
            let quantity = this.$moveQuantity.val()

            if (material_id != '' && (quantity == "" || quantity == '0')) {

                Alert.alert('', "제품을 선택한 경우에는 이동수량을 입력해야 합니다.");
                return false;
            } else {

            }

            let url = '/api/inventory/material_move';
            let data = {
                action: 'read',
                from: from,
                material_id: material_id,
                quantity: quantity
            };

            let fnsuccess = function (result) {
                let recordsTotal = result.data.length;
                _this.grid.setData({
                    list: result.data,
                    page: {
                        display: true,
                        totalElements: recordsTotal,
                    }
                });
            };

            AjaxUtil.getAsyncData(url+"/read", data, fnsuccess);

            return true;
        }

        checkMoveValidation() {

            let _this = this;
            let from = this.$cboFrom.val();
            let to = this.$cboTo.val();

            let items = [];
            let strItems = JSON.stringify(items);

            if (from == '' || to == "") {
                Alert.alert('', 'from, to를 확인하세요.');
                return;
            }
            if (from == to) {
                Alert.alert('', '동일한 창고를 선택하셨습니다.');
                return;

            }

            let seletectedItems = _this.grid.getList('selected');
            if (seletectedItems.length == 0) {
                Alert.alert('', '선택된 데이터가 없습니다.');
                return;
            }

            $.each(seletectedItems, function (idx, item) {
                let move_qty = item.move_qty;
                if (move_qty > 0) {
                    items.push({ material_id: item.id, move_qty: move_qty });
                }
            });

            if (items.length == 0) {
                Alert.alert('', '이동수량 변경이 없습니다.');
                return false;
            }

            return true;

        }

        moveMaterial() {

            let _this = this;
            if (this.checkMoveValidation() == false) {
                return false;
            }

            let from = this.$cboFrom.val();
            let to = this.$cboTo.val();
            let items = [];

            let seletectedItems = _this.grid.getList('selected');
            if (seletectedItems.length == 0) {
                Alert.alert('', '선택된 데이터가 없습니다.');
                return;
            }

            $.each(seletectedItems, function (idx, item) {
                let move_qty = item.move_qty;
                if (move_qty > 0) {
                    items.push({ material_id: item.id, move_qty: move_qty });
                }
            });

            let strItems = JSON.stringify(items);
            let url = '/api/inventory/material_move/move';
            let data = {
                from: from,
                to: to,
                items: strItems
            };
            let fnsuccess = function (result) {
                if (result.success) {
                    Notify.success('이동되었습니다.');
                    _this.modalContainer.close();
                }
                else {
                    Alert.alert('', '오류가 발생했습니다.');
                }
            };

            AjaxUtil.postAsyncData(url, data, fnsuccess);
        }

        showMovePopup() {

            let _this = this;
            let defaultData = {};
            let content = tmpl('matMovePopup', defaultData);
            let $content = $(content);
            this.modalContainer = new PopupDraggable('품목 창고이동');
            this.modalContainer.open({ width: 860, height: 690, $content });

            this.$cboFrom = $content.find('#cboFrom');
            this.$cboTo = $content.find('#cboTo');
            this.$cboMaterialType = $content.find('#cboMaterialType');
            this.$cboMaterial = $content.find('#cboMaterial');
            this.$moveQuantity = $content.find('#moveQuantity');

            // 그리드 설정
            let $grid = $content.find('[data-ax5grid="material-grid"]');
            this.initGird($grid);

            AjaxUtil.fillSelectOptions(this.$cboFrom, 'store_house', '', false);
            AjaxUtil.fillSelectOptions(this.$cboTo, 'store_house', '', false);

            let matType = this.$cboMaterialType.val();
            //AjaxUtil.fillSelectOptions(this.$cboMaterial, 'product_semi', 'choose', false, matType);
            AjaxUtil.fillSelectOptions(this.$cboMaterial, 'material', 'choose', false, '', '', matType);

            let $btnMatSearch = $content.find('#btnMatSearch');
            let $btnMoveAction = $content.find('#btnMoveAction');


            $btnMatSearch.click(function (e) {
                _this.searchMaterial();
            });

            $btnMoveAction.click(function (e) {
                if (_this.checkMoveValidation()) {
                    Alert.confirm('', '이동하시겠습니까?', function () {
                        _this.moveMaterial();
                    });
                }
            });

            this.$cboFrom.on('change', function (e) {
                let result = _this.searchMaterial();
                return result;
            });

            this.$cboMaterial.on('change', function (e) {
                let mat = $(this).val();
                if (mat == '') {
                    _this.$moveQuantity.val('');
                }
            });

            this.$cboMaterialType.on('change', function (e) {
                let matType = _this.$cboMaterialType.val();
                AjaxUtil.fillSelectOptions(_this.$cboMaterial, 'material', 'choose', false, '', '', matType);
            });

        }
    }


    let page = null;
    let popup = null;
    let modalContainer = null;

    $(document).ready(function (e) {
        page = new materialStorehouse();

        picker.bind({
            target: $('[data-ax5picker="multi"]'),
            direction: "top",
            locale: {
                format: 'YYYY-MM-DD'
            },
            content: {
                width: 214,
                margin: 10,
                type: 'date',

                config: {
                    control: {
                        left: '<i class="fa fa-arrow-left"></i>',
                        yearTmpl: '%s',
                        monthTmpl: '%s',
                        right: '<i class="fa fa-arrow-right"></i>'
                    },
                    lang: {
                        yearTmpl: "%s년",
                        months: ['01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12'],
                        dayTmpl: "%s"
                    }
                }
            },
            btns: {
                /*ok: {
                    label: "조회", theme: "default", onClick: function () {
                        this.self.close();
                        page.searchDataBind();


                    }
                }*/
            },

        });


        $('#searchForm').find('#srchDt').ax5DatePicker({ direction: 'top' });
        $('#searchForm').find('#srchStartDt').val(CommonUtil.getYYYYMMDD(-7));
        $('#searchForm').find('#srchEndDt').val(CommonUtil.getYYYYMMDD());

        AjaxUtil.fillSelectOptions($('#searchForm').find('#cboHouse'), 'store_house', 'all');
        AjaxUtil.fillSelectOptions($('#cboMatType'), 'system_code', 'all', false, 'mat_type');
        AjaxUtil.fillSelectOptions($('#cboMatGroup'), 'material_group', 'all', false);

        $('#cboMatType').on('change', function (e) {
            let mat_type = $('#cboMatType').val();
            AjaxUtil.fillSelectOptions($('#cboMatGroup'), 'material_group', 'all', false, mat_type);
        });

        // 검색
        $('#btnSearch').click(function (e) {
            page.searchDataBind();
        });
        $('#searchForm').find('#cboHouse').change(function (e) {
            page.searchDataBind();
        });
        // 기타입고
        $('#btnInput').on('click', function () {
            page.addDataPopup('in');
        });
        // 기타출고
        $('#btnOutput').on('click', function () {
            page.addDataPopup('out');
        });
        $('#btnMultiInput').on('click', function () {
            page.addMultiDataPopup('in');
        });

        // 품목 창고이동 팝업 생성
        $('#btnShowMovePopup').click(function (e) {
            let movePopupPage = new MaterialMove();
            movePopupPage.showMovePopup();
        });

        // 엑셀 다운로드
        $('#btnExcel').on('click', function () {
            page.exportExcel();
        });
		



        page.popColSetting = new popColSetting();
        let columns = page.popColSetting.loadColumnData(gui.gui_code, gui.template_key, 'grid', page.grid);

        if (userinfo.group_code == 'admin') {
            $('#btnGridSetting').css('visibility', 'visible');
        }

        $('#btnGridSetting').click(function (e) {
            let _this = this;
            let fix_cols = page.grid_config.frozenColumnIndex;
            page.popColSetting.show(gui.gui_code, gui.template_key, 'grid', page.grid_config.columns, page.grid, { 'order_fix': false, 'fix_cols': fix_cols });
        });

        page.searchDataBind();

    })
</script>
</th:block>
</html>
