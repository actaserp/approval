<html layout:decorate="~{layout_page}" xmlns:layout="http://www.w3.org/1999/xhtml">
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
<link rel="stylesheet" href="/css/import.css"/>
<link rel="stylesheet" href="/resource/ax5ui/ax5ui.all.css" />

<style>
  .modal {
    display: none;
    position: fixed;
    z-index: 9999; /* z-indexë¥¼ ë” ë†’ì„ */
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.5);
  }

  /* ê³µí†µ Modal ì»¨í…ì¸  ìŠ¤íƒ€ì¼ */
  .modal-content {
    background: white;
    border-radius: 8px;
    margin: 10% auto;
    padding: 20px;
    width: 600px;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
    position: relative;
    top: 15%;
  }
  .btn-popup-close img {
    float: right;
  }

  #modalGrid {
    height: auto;        /* ë†’ì´ë¥¼ ìë™ìœ¼ë¡œ ì¡°ì • */
    max-height: 500px;   /* í•„ìš”ì— ë”°ë¼ ìµœëŒ€ ë†’ì´ë¥¼ ì§€ì • */
    overflow-y: auto;    /* ìŠ¤í¬ë¡¤ í™œì„±í™” */
  }

  /* ì²´í¬ë°•ìŠ¤ë¥¼ ìˆ˜ì§ ë° ìˆ˜í‰ ì¤‘ì•™ ì •ë ¬ */
  .wj-cell.wj-header .wj-cell-element,
  .wj-cell.wj-header input[type="checkbox"],
  .wj-cell input[type="checkbox"] {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* ì²´í¬ë°•ìŠ¤ ì¹¸ í¬ê¸° ì¡°ì • */
  .wj-header .wj-cell {
    text-align: center !important;
  }


</style>
<th:block layout:fragment="content">

  <!--- (ë ˆì´ì•„ì›ƒ) Contents ì˜ì—­ -->
  <div class="layout-contents">
    <!-- Page Title -->
    <div class="page-title-wrap">
      <div class="left">
        <h2>ê²°ì¬ í˜„í™©</h2><a id="toggleButton" onclick="toggleSearchWrap()"><img src="/images/icon/ico-down.png" alt="ì•ŒëŒ ì•„ì´ì½˜"></a>
        <!--                <a href="#" title="ë¶ë§ˆí¬" class="bookmark toggle">-->
        <!--                    ë‚´ë©”ë‰´-->
        <!--                </a>-->
      </div>
      <ul class="page-navi">
        <li><img src="/images/icon/ico-nav-home.svg" alt="í™ˆì•„ì´ì½˜"></li>
        <li>ê²°ì¬ í˜„í™©</li>
      </ul>
    </div>
    <!-- Select -->
    <div class="search-wrap" id="searchWrap" style="display: none; padding-top:10px">
      <ul>
        <li>
          <select title="ì‚¬ì—…ì¥ì½”ë“œ" id="search_spjangcd" name="search_sjangcd"
                  onchange="init()">
            <option value="" hidden selected disabled>ì„ íƒ</option>
            <option value="ZZ">ì„±ìš°ì—ìŠ¤í”¼(ì£¼)</option>
            <option value="PP">ì„±ìš°í”¼ì•¤ë¹„(ì£¼)</option>
            <!-- ì§€ì—­ ì˜µì…˜ì„ JavaScriptì—ì„œ ë™ì ìœ¼ë¡œ ì±„ì›€ -->
          </select>
        </li>
      </ul>
    </div>
    <div class="tab-wrap">
<!--      <ul class="tab-links">-->
<!--        <li>-->
<!--          <a href="#tab1" title="ì£¼ë¬¸ ìº˜ë¦°ë”" class="tab-button">ì£¼ë¬¸ í˜„í™©</a>-->
<!--        </li>-->
<!--        <li>-->
<!--          <a href="#tab2" title="ì£¼ë¬¸ í™•ì¸" class="tab-button">ì£¼ë¬¸ í™•ì¸</a>-->
<!--        </li>-->
<!--      </ul>-->
      <div class="tab-contents">
        <!-- Section -->
        <section class="tab-item" id="tab1" style="height: 880px; margin-bottom: 10px">
          <div class="row" style="display: flex;">
            <!-- ì™¼ìª½ ì„¹ì…˜: 50% ì°¨ì§€ -->
            <section
                    style="width: 60%; box-sizing: border-box; height: 800px; margin-right: 20px; border-radius: 10px; ">
              <div class="title-wrap">
                <h3>ê²°ì¬ í˜„í™©</h3>
                <div class="btn-wrap">
                </div>
              </div>
              <div class="calendar-wrap">
                <div id="calendar"></div>
              </div>
            </section>
            <!-- ì˜¤ë¥¸ìª½ ì„¹ì…˜ì„ ê°ì‹¸ëŠ” div -->
            <div style="display: flex; flex-direction: column; width: 40%;">
              <!-- ìœ„ìª½ ì„¹ì…˜ -->
              <section style=" box-sizing: border-box;">
                <div style="margin-bottom: 15px">
                  <h3 id="year-status">2024ë…„ ê²°ì¬ í˜„í™©</h3>
                </div>
                <div class="tab-contents">
                  <div class="row">
                    <div class="section-card-wrap" style="gap: 5px">
                      <section style="background-color: #031B4B; color: #fff; flex: 0.5; margin-right: 5px; cursor: pointer; padding: 10px 10px;" class="fetchCard" data-search-type="001">
                        <div class="title">
                          <h3>ê²°ì¬ëŒ€ê¸°</h3>
                        </div>
                        <div class="requestCnt" style="font-size: 32px; font-weight: 700; text-align: right; margin: 9px 0;">
                          -<span class="small-unit" style=" font-size: 0.5em; opacity: 0.5;"> ê±´</span>
                        </div>
                      </section>
                      <section style="background-color: #03428E; color: #fff; flex: 0.5; margin-right: 5px; cursor: pointer; padding: 10px 10px;" class="fetchCard" data-search-type="101">
                        <div class="title">
                          <h3>ê²°ì¬</h3>
                        </div>
                        <div class="checkCnt" style="font-size: 32px; font-weight: 700; text-align: right; margin: 9px 0;">
                          -<span class="small-unit" style=" font-size: 0.5em; opacity: 0.5;"> ê±´</span>
                        </div>
                      </section>
                      <section style="background-color: #3069B3; color: #fff; flex: 0.5; margin-right: 5px; cursor: pointer; padding: 10px 10px;" class="fetchCard" data-search-type="131">
                        <div class="title">
                          <h3>ë°˜ë ¤</h3>
                        </div>
                        <div class="estimateCnt" style="font-size: 32px; font-weight: 700; text-align: right; margin: 9px 0;">
                          -<span class="small-unit" style=" font-size: 0.5em; opacity: 0.5;"> ê±´</span>
                        </div>
                      </section>
                      <section style="background-color: #C7DFF4; color: #031B4B; flex: 0.5; margin-right: 5px; cursor: pointer; padding: 10px 10px;" class="fetchCard" data-search-type="201">
                        <div class="title">
                          <h3>ë³´ë¥˜</h3>
                        </div>
                        <div class="produceCnt" style="font-size: 32px; font-weight: 700; text-align: right; margin: 9px 0;">
                          -<span class="small-unit" style=" font-size: 0.5em; opacity: 0.5;"> ê±´</span>
                        </div>
                      </section>
                      <section style="flex: 0.5; margin-right: 5px; cursor: pointer; padding: 10px 10px;" class="fetchCard" data-search-type="0">
                        <div class="title">
                          <h3>ì™„ë£Œ</h3>
                        </div>
                        <div class="deliveryCnt" style="font-size: 32px; font-weight: 700; text-align: right; margin: 9px 0;">
                          -<span class="small-unit" style=" font-size: 0.5em; opacity: 0.5;"> ê±´</span>
                        </div>
                      </section>
                    </div> <!--//main-card-wrap end -->
                  </div>
                </div>
              </section>

              <!-- ì•„ë˜ìª½ ì„¹ì…˜ (ë„“ê²Œ ì„¤ì •) -->
              <section style="flex: 1; box-sizing: border-box; margin-top: 20px;">
                <div class="tab-item-sub" id="tab1_2">
                  <div class="section-top" style="margin-top: 10px;">
                    <div class="search-wrap">
                      <dl>
                        <dt>
                          ì‘ì„±ì¼ì<span class="eq">*</span>
                        </dt>
                        <dd>
                          <ul class="date-box">
                            <li>
                              <input type="date" id="startDate2" name="startDate">
                              <label for="startDate2" class="hide">ì‹œì‘ì¼</label>
                            </li>
                            <li>
                              <input type="date" id="endDate2" name="endDate">
                              <label for="endDate2" class="hide">ì¢…ë£Œì¼</label>
                            </li>
                            <li>
                              <a class="btn btn-delete" title="ê²€ìƒ‰" id="btn-srch" onclick="fetchListData();initDatas();">
                                <img src="/images/icon/btn-srch.svg" alt="ê²€ìƒ‰ ì•„ì´ì½˜">
                                ê²€ìƒ‰
                              </a>
                            </li>
                          </ul>
                        </dd>
                      </dl>
                    </div>
                  </div> <!--//section-top end -->
                  <div class="container-fluid" style="padding-left: 0; padding-right: 0;">
                    <!-- ê·¸ë¦¬ë“œ ì˜ì—­ -->
                    <div class="col-12" style="margin-bottom: 10px;">
                      <div id="theGrid" style="width: 100%; height: 400px;"></div>
                    </div>
                  </div>

                </div>
              </section>
            </div>
          </div>
        </section>
      </div>
    </div>
    </section>
  </div> <!--//tab-contens end-->
  </div> <!--//tab-wrap end-->
  </div> <!--//layout-contents end -->
  <footer style="margin-top:5px;">
    <p>Copyrightâ“’ 0000 corp. All rights reserved.</p>
  </footer>
  <div style="height: 10px"></div>

  <!--ì—…ì²´ ëª¨ë‹¬-->
  <div class="modal">
    <div id="CltnmModal" style="display: none;">
      <div class="modal-content">
        <h2 style="text-align: center;">ê±°ë˜ì²˜ ì •ë³´ ìƒì„¸</h2>
        <a title="íŒì—…ë‹«ê¸°" onclick="closePopup('CltnmModal')" class="btn-popup-close">
          <img src="/images/icon/btn-popup-close.svg" style=" float: right; right: 30px;" alt="ë‹«ê¸°">
        </a>
        <form id="CltnmFindForm">
          <div id="modalGrid" style="height: 350px;width: 100%; margin-right:0px;  margin-top: 20px;"></div>
        </form>
      </div>
    </div>
  </div>

  <!--í˜ì´ì§€ ì„¤ëª… ëª¨ë‹¬ -->
  <div class="modal">
    <div id="PageModal" style="display: none;">
      <div class="modal-content">
        <h2 style="text-align: center;">ì£¼ë¬¸ í˜„í™© í˜ì´ì§€ ì„¤ëª…</h2>
        <a title="íŒì—…ë‹«ê¸°" onclick="closePopup('PageModal')" class="btn-popup-close">
          <img src="/images/icon/btn-popup-close.svg" style="float: right; right: 30px;" alt="ë‹«ê¸°">
        </a>
        <form id="PageFindForm">
          <p style="text-align: center;">
            <a href="https://foms.atlassian.net/l/cp/X9iSn8Tt"
               target="_blank"
               style="color: blue; text-decoration: underline;">
              Atlassian Wikiì—ì„œ í˜ì´ì§€ ë³´ê¸°
            </a>
          </p>
        </form>
      </div>
    </div>
  </div>
  <!-- ì˜µì…˜ ë° ìš”ì²­ì‚¬í•­ ëª¨ë‹¬ -->
  <div class="modal">
    <div class="popup-wrapper w700" id="OrdtextModal" style="display: none; min-width: 1050px;">
      <div class="popup-title">
        <h3>ì˜µì…˜ ë° ìš”ì²­ì‚¬í•­</h3>
        <a title="íŒì—…ë‹«ê¸°" onclick="closePopup('OrdtextModal')" class="btn-popup-close">
          <img src="/images/icon/btn-popup-close.svg" alt="ë‹«ê¸°" style="float: right; right: 30px;">
        </a>
      </div>
      <div class="popup-contents">
        <div class="table-wrap">
          <table class="write-table" style="border-top: 0px;">
            <caption>ì£¼ë¬¸ì˜ë¢° ìš”ì²­ì‚¬í•­</caption>
            <colgroup>
              <col class="wp20">
              <col class="wp80">
            </colgroup>
            <tbody>
            <tr>
              <td>
                <div class="table-wrap">
                  <table class="write-table">
                    <caption>ìš”ì²­ì‚¬í•­</caption>
                    <tbody>
                    <tr style="align-items: center">
                      <th>
                        <label for="ordtext">ë‚´ìš©</label>
                      </th>
                      <td colspan="3">
                        <div class="textarea-box">
                          <textarea id="ordtext"></textarea>
                        </div>
                      </td>
                    </tr>
                    </tbody>
                  </table>
                </div>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>


</th:block>
<th:block layout:fragment="scripts">
  <script type="text/javascript" src="/resource/windowContainer/js/html5sortable.js"></script>
  <script type="text/javascript" src="/js/nth-tabs.js"></script>
  <th:block th:replace="/common/columns_setting :: columns_setting"></th:block>
  <!-- <script>
       tinymce.init({
           language: "ko_KR",
           selector: "#ordtext",
           plugins: "paste image imagetools",
           height: 500,
           width: 900,
           toolbar: false,       // íˆ´ë°” ë¹„í™œì„±í™”
           menubar: false,       // ìƒë‹¨ ë©”ë‰´ ë¹„í™œì„±í™”
           readonly: 1,          // ì½ê¸° ì „ìš© ëª¨ë“œ í™œì„±í™”
           paste_data_images: true,
           file_picker_types: 'image',
           automatic_uploads: false // ìë™ ì—…ë¡œë“œ ë¹„í™œì„±í™”
       });

   </script>-->
  <script type="text/javascript">

    let theGrid;
    let calendar;
    let modalGrid;
    let viewdata;

    // ì£¼ë¬¸í˜„í™© ë…„ë„ ìë™í™”
    const currentYear = new Date().getFullYear();
    document.getElementById('year-status').innerText = `${currentYear}ë…„ ê²°ì¬ í˜„í™©`;

    document.readyState === 'complete' ? init() : window.onload = init;
    let isBindSpjangcdCalled = false;


    // ì´ˆë°˜ í˜ì´ì§€ ì§„ì…ì‹œ ê·¸ë¦¬ë“œ ë°”ì¸ë”© ì‹œì‘
    function init() {
      if (!isBindSpjangcdCalled) {
        bindSpjangcd();
        isBindSpjangcdCalled = true; // í”Œë˜ê·¸ ì—…ë°ì´íŠ¸
      }
      fetchListData();
      initCalendar();
      // applySavedSettings(); // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„¤ì • ì ìš©
      initDatas();
    }

    $(document).ready(function() {
      // í˜„ì¬ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸°
      const today = new Date();
      const year = today.getFullYear();
      const month = today.getMonth(); // 0ë¶€í„° ì‹œì‘í•˜ëŠ” ì›”(0 = 1ì›”)

      // ì‹œì‘ì¼: ë‹¹ì›” 1ì¼
      const startOfMonth = new Date(year, month, 1);
      const startMonthFormatted = startOfMonth.getFullYear() + '-' + String(startOfMonth.getMonth() + 1).padStart(2, '0') + '-' + String(startOfMonth.getDate()).padStart(2, '0');
      $('#startDate').val(startMonthFormatted);
      $('#startDate2').val(startMonthFormatted);

      // ì¢…ë£Œì¼: í˜„ì¬ ì›”ì˜ ë§ˆì§€ë§‰ ë‚ 
      const endOfMonth = new Date(year, month + 1, 0); // ë‹¤ìŒ ë‹¬ 0ì¼ì€ í˜„ì¬ ë‹¬ì˜ ë§ˆì§€ë§‰ ë‚ 
      const endMonthFormatted = endOfMonth.getFullYear() + '-' + String(endOfMonth.getMonth() + 1).padStart(2, '0') + '-' + String(endOfMonth.getDate()).padStart(2, '0');
      $('#endDate').val(endMonthFormatted);
      $('#endDate2').val(endMonthFormatted);

      nthTabs = $('#main-tabs').nthTabs();
      console.log("âœ… nthTabs ê°ì²´ ìƒíƒœ í™•ì¸:", nthTabs);


      $(".tab-links a").click(function (event) {
        event.preventDefault(); // ê¸°ë³¸ ë™ì‘ ë°©ì§€

        var targetTab = $(this).attr("href"); // í´ë¦­í•œ íƒ­ì˜ href ê°’ ê°€ì ¸ì˜¤ê¸°

        // ëª¨ë“  íƒ­ ìˆ¨ê¸°ê¸°
        $(".tab-item").hide();
        $(".tab-links li").removeClass("active");

        // ì„ íƒí•œ íƒ­ í‘œì‹œ
        $(targetTab).show();
        $(this).parent("li").addClass("active");

        // âœ… tab1ìœ¼ë¡œ ëŒì•„ì˜¬ ê²½ìš° ìº˜ë¦°ë” ë¦¬ì‚¬ì´ì§•
        if (targetTab === "#tab1") {
          setTimeout(() => {
            console.log("ğŸ“† ìº˜ë¦°ë” ë¦¬ì‚¬ì´ì§• ì‹¤í–‰");
            if (calendar) {
              calendar.updateSize(); // ìº˜ë¦°ë” í¬ê¸° ì¬ì¡°ì •
              calendar.render(); // ë‹¤ì‹œ ê·¸ë¦¬ê¸°
            }
          }, 200); // ì•½ê°„ì˜ ë”œë ˆì´ë¥¼ ì¤˜ì„œ ë Œë”ë§ ì™„ë£Œ í›„ ì‹¤í–‰
        }
      });
    });

    // '.fetchCard' í´ë˜ìŠ¤ë¥¼ ê°€ì§„ ëª¨ë“  ìš”ì†Œì— ëŒ€í•´ í´ë¦­ ì´ë²¤íŠ¸ ì„¤ì •
    $('.fetchCard').click(function() {
      // í´ë¦­ëœ ì¹´ë“œì˜ data-search-type ì†ì„± ê°’ ê°€ì ¸ì˜¤ê¸°
      const searchTypeValue = $(this).data('search-type');
      fetchListData(searchTypeValue);  // í•´ë‹¹ ê°’ì„ fetchListData í•¨ìˆ˜ë¡œ ì „ë‹¬
    });
    function fetchListData(searchTypeValue) {
      let data2 = []; // ë°ì´í„°ë¥¼ ë‹´ì„ ë°°ì—´
      let emptyRowsCount = 8;
      $.ajax({
        url: '/api/order_status/readCalenderGrid',
        type: 'GET',
        data: {
          'search_spjangcd': $('#search_spjangcd').val(),
          'search_startDate': $('#startDate2').val(),
          'search_endDate': $('#endDate2').val(),
          'search_type': searchTypeValue
        },
        async: false,
        success: function (response) {
          // ì‘ë‹µì´ ì˜¬ë°”ë¥´ê²Œ ë„ì°©í–ˆê³ , data ì†ì„±ì´ ë°°ì—´ì¸ì§€ í™•ì¸
          if (response && Array.isArray(response.data)) {
            data2 = response.data;
            // ë‚ ì§œ í˜•ì‹ ë³€í™˜ ë° ordflag ë³€í™˜
            data2.forEach(item => {

            });
          }
        },
        error: function () {
          console.error("ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      });

      // ë¹ˆ ê°ì²´ë¥¼ emptyRowsCountë§Œí¼ ì¶”ê°€
      if(data2.length < emptyRowsCount) {
        for (let i = 0; emptyRowsCount - data2.length ; i++) {
          data2.push({
            appgubun: '',
            repodate: '',
            title: '',
            appdate: ''
          });
        }
      }
      viewdata = new wijmo.collections.CollectionView(data2);
      if (!theGrid) {
        theGrid = new wijmo.grid.FlexGrid('#theGrid', {
          autoGenerateColumns: false,
          showMarquee: true,
          isReadOnly: true,
          columns: [
            { binding: 'papernm', header: 'ë¬¸  ì„œ', align: 'center', width: '*', minWidth: 100 },
            { binding: 'repodate', header: 'ì‘ì„±ì¼ì', align: 'center', width: '*', minWidth: 115 },
            { binding: 'appnum', header: 'ë¬¸ì„œë²ˆí˜¸', align: 'left', width: '*', minWidth: 170 },
            { binding: 'repopernm', header: 'ì‘ì„±ìëª…', align: 'center', width: '*', minWidth: 81 },
            { binding: 'divinm', header: 'ë¶€ì„œëª…', align: 'center', width: '*', minWidth: 72 },
            { binding: 'title', header: 'ì œ  ëª©', align: 'center', width: '*', minWidth: 85 },
            { binding: 'appgubun', header: 'ê²°ì¬ìƒíƒœ', align: 'center', width: '*', minWidth: 82 }
          ],
          itemsSource: viewdata // ë¹ˆ ê°ì²´ê°€ ì¶”ê°€ëœ ë°°ì—´ ì‚¬ìš©
        });
        // í—¤ë”ë¥¼ ì¤‘ì•™ ì •ë ¬í•˜ëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        theGrid.formatItem.addHandler(function (s, e) {
          if (e.panel === s.columnHeaders) {
            e.cell.style.textAlign = 'center';
          }
        });
        // attachDoubleClickEvent(theGrid);   //ë”ë¸”í´ë¦­ ì´ë²¤íŠ¸
        // ì„ íƒì´ ë³€ê²½ë  ë•Œ, í˜„ì¬ í•­ëª© ì—…ë°ì´íŠ¸
        theGrid.rowHeaders.columns.splice(0, 1);
        new FlexGridContextMenu(theGrid);
        window.downloadFileName = 'ê²°ì¬ í˜„í™©(ìº˜ë¦°ë”)';
      } else {
        // ì´ë¯¸ FlexGridì´ ì¡´ì¬í•˜ëŠ” ê²½ìš°, ë°ì´í„°ë§Œ ì—…ë°ì´íŠ¸
        theGrid.itemsSource = viewdata; // ë¹ˆ ê°ì²´ê°€ ì¶”ê°€ëœ ë°°ì—´ ì‚¬ìš©
      }
    }
    /* ìº˜ë¦°ë” ==========================================================================================================================*/

    function initCalendar() {
      var calendarEl = document.getElementById('calendar');
      if (calendarEl) {
        // FullCalendar ì„¤ì •
        calendar = new FullCalendar.Calendar(calendarEl, {
          locale: 'ko',
          headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth' ,
          },
          initialView: 'dayGridMonth',
          height: 714,
          dayHeaderFormat: { weekday: 'short' },
          views: {
            dayGridMonth: {
              dayCellContent: function (arg) {
                return arg.dayNumberText.replace('ì¼', '');
              }
            }
          },
          dateClick: function (info) {
            console.log('Clicked on: ' + info.dateStr);
            document.getElementById("startDate2").value = info.dateStr;
            document.getElementById("endDate2").value = info.dateStr;
            fetchListData();
            initDatas()
          },
          events: [] // ê¸°ë³¸ ì´ë²¤íŠ¸ëŠ” ë¹ˆ ë°°ì—´ë¡œ ì„¤ì •
        });

        // ê³µíœ´ì¼ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        fetchHolidays().then(holidays => {
          holidays.forEach(holiday => {
            calendar.addEvent({
              title: holiday.name, // ê³µíœ´ì¼ ì´ë¦„
              start: holiday.date,  // ê³µíœ´ì¼ ë‚ ì§œ
              backgroundColor: '#EC193A',
              borderColor: '#EC193A',
              textColor: 'white'
            });
          });
          setTimeout(() => {
            calendar.render(); // ìº˜ë¦°ë” ë Œë”ë§
            // console.log('ìº˜ë¦°ë”ê°€ ë Œë”ë§ë˜ì—ˆìŠµë‹ˆë‹¤.');
          }, 500); // 500ms ë”œë ˆì´
        }).catch(error => {
          console.error('ê³µíœ´ì¼ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:', error);
        });
        // ê²°ì¬í˜„í™© ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        // ê²°ì¬í˜„í™© ë°ì´í„° ê°€ì ¸ì™€ì„œ ë‚ ì§œë³„ ê·¸ë£¹í™” í›„ ìº˜ë¦°ë”ì— ì¶”ê°€
        fetchOrderDates().then(orderDates => {
          //console.log("ğŸ“¢ ì›ë³¸ orderDates ë°ì´í„°:", orderDates);

          // 1ï¸âƒ£ ë‚ ì§œë³„ ê·¸ë£¹í™” ( { "YYYY-MM-DD": { "ì£¼ë¬¸í™•ì¸": 3, "ì¶œê³ ": 2 } } í˜•íƒœë¡œ ì €ì¥ )
          let groupedEvents = {};

          orderDates.forEach(order => {
            let date = order.date;  // ì£¼ë¬¸ ë‚ ì§œ
            let name = order.name;  // ì£¼ë¬¸ ìƒíƒœ (ì£¼ë¬¸ë“±ë¡, ì£¼ë¬¸í™•ì¸ ë“±)

            // í•´ë‹¹ ë‚ ì§œê°€ ì´ë¯¸ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
            if (!groupedEvents[date]) {
              groupedEvents[date] = {};
            }

            // í•´ë‹¹ ìƒíƒœê°€ ì´ë¯¸ ì¡´ì¬í•˜ë©´ count ì¦ê°€
            if (groupedEvents[date][name]) {
              groupedEvents[date][name]++;
            } else {
              groupedEvents[date][name] = 1;
            }
          });

          // console.log("ğŸ“¢ ë‚ ì§œë³„ ê·¸ë£¹í™”ëœ ë°ì´í„°:", groupedEvents);

          // 2ï¸âƒ£ FullCalendar ì´ë²¤íŠ¸ ì¶”ê°€ (ì¤‘ë³µ ì œê±° í›„ ê°œìˆ˜ í‘œì‹œ)
          Object.keys(groupedEvents).forEach(date => {
            Object.keys(groupedEvents[date]).forEach(name => {
              let count = groupedEvents[date][name]; // ì£¼ë¬¸ ê°œìˆ˜
              let displayTitle = count > 1 ? `${name} (${count})` : name; // ê°œìˆ˜ í‘œì‹œ

              let eventColor = getEventColor(name); // ìƒ‰ìƒ ê°€ì ¸ì˜¤ê¸°

              calendar.addEvent({
                title: displayTitle,
                start: date,
                backgroundColor: eventColor.bg,
                borderColor: eventColor.border,
                textColor: eventColor.text
              });
            });
          });

          setTimeout(() => {
            calendar.render(); // ìº˜ë¦°ë” ë Œë”ë§
            // console.log("ğŸ“¢ ìº˜ë¦°ë”ê°€ ë Œë”ë§ë˜ì—ˆìŠµë‹ˆë‹¤.");
          }, 500);
        }).catch(error => {
          console.error("âŒ ì£¼ë¬¸í˜„í™© ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:", error);
        });
      }
    }
    // ê³µíœ´ì¼ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
    async function fetchHolidays() {
      const currentYear = new Date().getFullYear();
      const yearsToFetch = [currentYear - 1, currentYear, currentYear + 1]; // ì „ë…„ë„, í˜„ì¬ ì—°ë„, ë‹¤ìŒ ì—°ë„ ë°°ì—´ ìƒì„±

      const holidays = [];

      for (const year of yearsToFetch) {
        const yearHolidays = await fetchHolidaysForYear(year);
        holidays.push(...yearHolidays);
      }

      return holidays;
    }
    // ìº˜ë¦°ë” ì˜¬í•´ ì „ì²´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
    async function fetchOrderDates() {
      let data2 = []; // ë°ì´í„°ë¥¼ ë‹´ì„ ë°°ì—´
      let emptyRowsCount = 8;
      var orderDates = [];
      $.ajax({
        url: '/api/order_status/readCalenderGrid2',
        type: 'GET',
        data: {
          'search_spjangcd': $('#search_spjangcd').val()
        },
        async: false,
        success: function (response) {
          // ì‘ë‹µì´ ì˜¬ë°”ë¥´ê²Œ ë„ì°©í–ˆê³ , data ì†ì„±ì´ ë°°ì—´ì¸ì§€ í™•ì¸
          if (response && Array.isArray(response.data)) {
            data2 = response.data;
            // ë‚ ì§œ í˜•ì‹ ë³€í™˜ ë° ordflag ë³€í™˜
            //console.log("ìº˜ë¦°ë” ë°ì´í„° : ", data2);
          }
        },
        error: function () {
          console.error("ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      });

      // viewdata.itemsë¥¼ ë°˜ë³µí•˜ì—¬ ê° í•­ëª©ì˜ ordflagì™€ reqdate ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
      for (var i = 0; i < data2.length; i++) {
        var item = data2[i];
        orderDates.push({
          name: item.appgubun,
          date: item.repodate
        });
      }
      //console.log("orderDates : ", orderDates)
      return orderDates;
    }

    // ì£¼ë¬¸ ìƒíƒœì— ë”°ë¥¸ ìƒ‰ìƒ ì„¤ì •
    function getEventColor(name) {
      switch (name) {
        case "ê²°ì¬ëŒ€ê¸°":
          return { bg: "#031B4B", border: "#031B4B", text: "white" };
        case "ê²°ì œ":
          return { bg: "#03428E", border: "#03428E", text: "white" };
        case "ë³´ë¥˜":
          return { bg: "#3069B3", border: "#3069B3", text: "white" };
        case "ë°˜ë ¤":
          return { bg: "#C7DFF4", border: "rgba(2,165,255,0.07)", text: "black" };
        default:
          return { bg: "grey", border: "grey", text: "white" };
      }
    }


    //api ìš”ì²­
    async function fetchHolidaysForYear(year) {
      return new Promise((resolve, reject) => {
        var xhr = new XMLHttpRequest();
        var url = 'http://apis.data.go.kr/B090041/openapi/service/SpcdeInfoService/getRestDeInfo';
        var queryParams = '?' + encodeURIComponent('serviceKey') + '=' + 'R3P3syhq6qRP0cz8mbV2J5t%2B32WwaSN9sH8ZW4k59oKAU3Ze0WvcljMrN36OJqxs38%2F780hMD4QfhCiDZQNUyA%3D%3D';
        queryParams += '&' + encodeURIComponent('solYear') + '=' + encodeURIComponent(year);
        queryParams += '&' + encodeURIComponent('numOfRows') + '=' + encodeURIComponent('30');

        xhr.open('GET', url + queryParams);
        xhr.onreadystatechange = function () {
          if (this.readyState == 4) {
            if (this.status == 200) {
              var parser = new DOMParser();
              var xmlDoc = parser.parseFromString(this.responseText, "text/xml");

              // XMLì—ì„œ ì›í•˜ëŠ” ë°ì´í„° ì¶”ì¶œ
              var items = xmlDoc.getElementsByTagName("item");
              let holidays = [];
              for (var i = 0; i < items.length; i++) {
                var locdate = items[i].getElementsByTagName("locdate")[0].textContent;
                var dateName = items[i].getElementsByTagName("dateName")[0].textContent;

                holidays.push({ date: locdate, name: dateName });
              }
              resolve(holidays);
            } else {
              console.error('ì˜¤ë¥˜ ë°œìƒ. HTTP ìƒíƒœ ì½”ë“œ:', this.status);
              reject(this.status);
            }
          }
        };

        xhr.send();
      });
    }

    /*==============ìº˜ë¦°ë” ë=============================================================================================================*/
    var nthTabs = this;

    // âœ… ë”ë¸” í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ìˆ˜ì •
    function attachDoubleClickEvent(grid) {
      let lastClickTime = 0;

      grid.hostElement.addEventListener('click', function (e) {
        const now = new Date().getTime();

        if (now - lastClickTime < 300) { // 300ms ì´ë‚´ ë‘ ë²ˆ í´ë¦­ â†’ ë”ë¸” í´ë¦­ ì²˜ë¦¬
          const ht = grid.hitTest(e);

          if (ht.cellType === wijmo.grid.CellType.Cell) { // ì…€ì„ í´ë¦­í•œ ê²½ìš°ë§Œ ì²˜ë¦¬
            const rowData = grid.rows[ht.row].dataItem; // í´ë¦­í•œ í–‰ ë°ì´í„°

            if (!rowData || !rowData.reqnum) {
              console.warn("âŒ ìœ íš¨í•œ rowData ë˜ëŠ” reqnumì´ ì—†ìŠµë‹ˆë‹¤.");
              return;
            }
            //sessionStorage ì— ì €ì¥
            sessionStorage.setItem("selectedRowData", JSON.stringify(rowData));
            sessionStorage.setItem("tabAction", "toggle");
            window.parent.postMessage({
              action: "addTab",
              id: "order_request",
              title: "ì£¼ë¬¸ë“±ë¡",
              url: '/gui/' + "order_request" + '/default',
              active: true,
              allowClose: true,
            });
          }
        }
        lastClickTime = now;
      });
    }
    /*ëª¨ë‹¬ì°½=====================================================*/



    // ëª¨ë‹¬ IDì™€ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜ë¥¼ ë§¤í•‘í•˜ëŠ” ê°ì²´
    const modalDataLoaders = {
      'CltnmModal': modalDeta,
      // 'OrdtextModal':showOrdtextModal,
    };

    function showPopupById(popupId, rowIndex = null) {
      const popup = document.getElementById(popupId);
      if (popup) {
        const modal = popup.closest('.modal');
        if (modal) {
          modal.style.display = 'block';
          requestAnimationFrame(() => modal.classList.add('show'));
        }
        popup.style.display = 'block';
        requestAnimationFrame(() => popup.classList.add('show'));

        // ëª¨ë‹¬ì´ ì—´ë¦¬ë©´ì„œ í•´ë‹¹ ëª¨ë‹¬ì˜ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜ í˜¸ì¶œ
        const loadDataFunction = modalDataLoaders[popupId];
        if (typeof loadDataFunction === 'function') {
          try {
            // rowIndexê°€ í•„ìš”í•  ê²½ìš°ì—ë§Œ ì „ë‹¬
            if (popupId === 'OrdtextModal' && rowIndex !== null) {
              loadDataFunction(rowIndex);
            } else {
              loadDataFunction();
            }
          } catch (error) {
            console.error(`Error loading data for modal '${popupId}':`, error);
          }
        } else {
          console.log(`No data load function defined for modal with ID: ${popupId}`);
        }

        console.log(`Showing modal with ID: ${popupId}`);
      } else {
        console.warn(`Popup with ID '${popupId}' not found.`);
      }
    }

    /*function showOrdtextModal(rowIndex) {
        console.log("showOrdtextModal called with rowIndex:", rowIndex);

        // rowIndexê°€ ìœ íš¨í•œì§€ ê²€ì¦
        if (rowIndex === undefined || rowIndex === null || !theGrid2 || !theGrid2.rows[rowIndex]) {
            console.error("Invalid rowIndex or theGrid2 is not defined:", rowIndex);
            return;
        }

        const selectedData = theGrid2.rows[rowIndex].dataItem;
        console.log("Selected data from grid:", selectedData);

        if (selectedData && selectedData.originalOrdtext) {
            tinymce.get("ordtext").setContent(selectedData.originalOrdtext);
            console.log("Ordtext loaded into TinyMCE editor");
        } else {
            console.error("ì„ íƒí•œ í–‰ì— ëŒ€í•´ ì›ë³¸ ì£¼ë¬¸ í…ìŠ¤íŠ¸ ë°ì´í„°ê°€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤");
        }
    }*/

    // ëª¨ë‹¬ì„ ë‹«ëŠ” í•¨ìˆ˜
    function closePopup(popupId) {
      const popup = document.getElementById(popupId);
      if (popup) {
        const modal = popup.closest('.modal');
        if (modal) {
          modal.style.display = 'none';
          modal.classList.remove('show');
        }
        popup.style.display = 'none';
        popup.classList.remove('show');
        console.log(`Closing modal with ID: ${popupId}`);
      }
    }

    /*ëª¨ë‹¬ ë ============================================================*/

    function modalDeta() {
      console.log('Initializing modal grid...');
      const Modaldata = [];
      const minimumRows = 13;

      // searchTermì„ ì…ë ¥ í•„ë“œì—ì„œ ê°€ì ¸ì˜µë‹ˆë‹¤ (ì˜ˆ: #searchCltnm)
      const searchTerm = $('#searchCltnm').val();

      $.ajax({
        url: '/api/order_status/ModalRead',
        type: 'GET',
        data: { searchTerm: searchTerm }, // searchTermì„ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ ì¶”ê°€
        async: true,
        success: function(response) {
          if (response && Array.isArray(response.data)) {
            response.data.forEach((item, index) => {
              Modaldata.push({
                rownum: index + 1,  // ìˆœë²ˆì„ ì¶”ê°€
                ...item
              });
            });
          }

          // ìµœì†Œ í–‰ ìˆ˜ ì±„ìš°ê¸°
          if (Modaldata.length < minimumRows) {
            for (let i = Modaldata.length; i < minimumRows; i++) {
              Modaldata.push({
                rownum: i + 1,
                cltcd: '',
                cltnm: '',
                telnum: '',
                cltadres: ''
              });
            }
          }

          // ë””ë²„ê¹…: ë°ì´í„° í™•ì¸
          console.log("Data length after adding empty rows:", Modaldata.length);

          // ë°ì´í„°ë¥¼ CollectionViewì— ë°”ì¸ë”©
          const viewdata = new wijmo.collections.CollectionView(Modaldata);

          // ê¸°ì¡´ ê·¸ë¦¬ë“œ ì œê±° í›„ ìƒˆë¡œ ìƒì„±
          if (modalGrid) {
            modalGrid.dispose();
          }

          modalGrid = new wijmo.grid.FlexGrid('#modalGrid', {
            autoGenerateColumns: false,
            isReadOnly: true,
            columns: [
              {binding: 'rownum', header: 'ìˆœë²ˆ', width: 50, align: 'center'},
              {binding: 'cltcd', header: 'ì½”ë“œ', width: 140, minWidth: 80, align: 'center'},
              {binding: 'cltnm', header: 'ê±°ë˜ì²˜ëª…', width: 250 },
              {binding: 'telnum', header: 'ì „í™”', width: 250},
              {binding: 'cltadres', header: 'ì£¼ì†Œ', width: '*'}
            ],
            itemsSource: viewdata
          });
          modalGrid.rowHeaders.columns.splice(0, 1);
          console.log('Modal grid initialized and data loaded.');

          // ê·¸ë¦¬ë“œì˜ ë”ë¸” í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
          let lastClickTime = 0;
          modalGrid.hostElement.addEventListener('click', function (e) {
            const now = new Date().getTime();

            if (now - lastClickTime < 300) { // 300ms ì´ë‚´ì˜ ë‘ ë²ˆ í´ë¦­ì€ ë”ë¸” í´ë¦­ìœ¼ë¡œ ì¸ì‹
              // í´ë¦­ëœ ìœ„ì¹˜ì˜ í–‰ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸°
              const ht = modalGrid.hitTest(e);

              if (ht.cellType === wijmo.grid.CellType.Cell) {
                const clickedItem = modalGrid.rows[ht.row].dataItem;

                if (clickedItem && clickedItem.cltnm) { // í´ë¦­ëœ í–‰ì— 'cltnm' ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸
                  $('#searchCltnm').val(clickedItem.cltnm); // ê²€ìƒ‰ í•„ë“œì— ì—…ì²´ ì´ë¦„ ì„¤ì •
                }

                // ì›í•˜ëŠ” ê¸°ëŠ¥ ì‹¤í–‰
                fetchListData2(); // ë”ë¸” í´ë¦­ ì‹œ ì›í•˜ëŠ” í•¨ìˆ˜ ì‹¤í–‰
                closePopup('CltnmModal'); // ëª¨ë‹¬ ì°½ ë‹«ê¸°
              }
            }

            lastClickTime = now;
          });
        },
        error: function() {
          console.error("Error fetching modal data.");
        }
      });
    }

    function resetForm() {
      // ê²€ìƒ‰ ê´€ë ¨ í•„ë“œ ì´ˆê¸°í™” (ì¼ë°˜ í…ìŠ¤íŠ¸ ì…ë ¥ í•„ë“œ)
      const searchInputIds = [
        'searchCltnm', 'searchtketnm'
      ];

      searchInputIds.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          element.value = ''; // í…ìŠ¤íŠ¸ í•„ë“œë¥¼ ë¹ˆ ë¬¸ìì—´ë¡œ ì´ˆê¸°í™”
        }
      });

      // ë“œë¡­ë‹¤ìš´ í•„ë“œ ì´ˆê¸°í™”
      const dropdown = document.getElementById('searchstate');
      if (dropdown) {
        dropdown.value = 'ì „ì²´'; // ë“œë¡­ë‹¤ìš´ì„ ê¸°ë³¸ê°’('ì „ì²´')ìœ¼ë¡œ ì„¤ì •
      }
    }
    function initDatas(){
      $('.requestCnt').html(0 + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
      $('.checkCnt').html(0 + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
      $('.estimateCnt').html(0 + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
      $('.produceCnt').html(0 + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
      $('.deliveryCnt').html(0 + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
      $('.cancelCnt').html(0 + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
      $.ajax({
        url: '/api/order_status/initDatas',
        type: 'GET',
        data: {
          'search_spjangcd': $('#search_spjangcd').val(),
          'search_startDate': $('#startDate2').val(),
          'search_endDate': $('#endDate2').val(),
        },
        async: false,
        success: function (data) {
          data2 = data.data;
          data2.forEach(item =>{
            let totalCnt = 0;
            switch (item.appgubun) {
              case "001":
                $('.requestCnt').html(item.appgubun_count + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
                totalCnt += item.appgubun_count;
                break;
              case "101":
                $('.checkCnt').html(item.appgubun_count + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
                totalCnt += item.appgubun_count;
                break;
              case "131":
                $('.estimateCnt').html(item.appgubun_count + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
                totalCnt += item.appgubun_count;
                break;
              case "201":
                $('.produceCnt').html(item.appgubun_count + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
                totalCnt += item.appgubun_count;
                break;
              default:
                console.log("ê²°ì¬í˜„í™© ë°”ì¸ë“œ ì˜¤ë¥˜ : ", item.appgubun);
            }
            $('.deliveryCnt').html(totalCnt + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
          })
        }
      })
    }
    function bindSpjangcd() {
      $.ajax({
        url: '/api/dashboard2/bindSpjangcd',
        type: 'GET',
        async: false,
        success: function (data) {
          data2 = data.data;
          const selectElement = document.getElementById('search_spjangcd');
          if (selectElement) {
            selectElement.value = data2; // value ì†ì„±ìœ¼ë¡œ ì„ íƒ
          }
        }
      })
    }

    function openPopup(url) {
      // ìƒˆ ì°½ ì—´ê¸°
      window.open(url, '_blank',
              'width=1040,height=1000,toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes');
    }

    //ì£¼ë¬¸ í™•ì¸[ì£¼ë¬¸ ë“±ë¡->ì£¼ë¬¸ í™•ì¸ìœ¼ë¡œ ìƒíƒœ ë³€ê²½]
    function CheckOK() {
      let selectedRows = [];

      if (theGrid2) {
        let selector = new wijmo.grid.selector.Selector(theGrid2);

        if (typeof selector.getCheckedItems === "function") {
          selectedRows = selector.getCheckedItems();
        } else {
          console.warn("âš ï¸ `getCheckedItems()`ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. `isSelected` ë°©ì‹ìœ¼ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.");
          selectedRows = theGrid2.rows.filter(row => row.isSelected).map(row => row.dataItem);
        }
      }

      if (selectedRows.length === 0) {
        alert("ì„ íƒëœ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }

      // âœ… ì„ íƒëœ í–‰ ë°ì´í„° ì½˜ì†”ì— ì¶œë ¥
      console.log("âœ… ì„ íƒëœ ì£¼ë¬¸ ë°ì´í„°:", selectedRows);

      processSelectedOrders(selectedRows);
    }

    function processSelectedOrders(selectedRows) {
      let requestData = { orders: selectedRows };

      console.log(" ì„œë²„ë¡œ ì „ì†¡í•  ë°ì´í„°:", JSON.stringify(requestData));

      $.ajax({
        url: '/api/order_status/confirm',
        type: 'POST',
        contentType: 'application/json', // âœ… JSON í—¤ë” ì¶”ê°€
        data: JSON.stringify(requestData), // âœ… JSON í˜•ì‹ ë³€í™˜
        headers: {
          'X-CSRF-Token': $('[name=_csrf]').val()
        },
        success: function(response) {
          console.log("âœ… ì„œë²„ ì‘ë‹µ:", response);
          Alert.alert('' ,"ì£¼ë¬¸ í™•ì¸ ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
          fetchListData2();
        },
        error: function(xhr, status, error) {
          console.error("âŒ ì£¼ë¬¸ í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", xhr.responseText);

          try {
            let response = JSON.parse(xhr.responseText);
            Alert.alert('', response.message || "ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
          } catch (e) {
            Alert.alert('', "ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
          }
        }

      });
    }

    //ì£¼ë¬¸ì·¨ì†Œ
    function CancelOrder(){
      let selectedRows = [];

      if (theGrid2) {
        let selector = new wijmo.grid.selector.Selector(theGrid2);

        if (typeof selector.getCheckedItems === "function") {
          selectedRows = selector.getCheckedItems();
        } else {
          console.warn("âš ï¸ `getCheckedItems()`ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. `isSelected` ë°©ì‹ìœ¼ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.");
          selectedRows = theGrid2.rows.filter(row => row.isSelected).map(row => row.dataItem);
        }
      }

      if (selectedRows.length === 0) {
        alert("ì„ íƒëœ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }

      // âœ… ì„ íƒëœ í–‰ ë°ì´í„° ì½˜ì†”ì— ì¶œë ¥
      console.log("âœ… ì„ íƒëœ ì£¼ë¬¸ ë°ì´í„°:", selectedRows);

      processCancelOrder(selectedRows);
    }

    function processCancelOrder(selectedRows){
      let requestData = { orders: selectedRows };

      console.log(" ì„œë²„ë¡œ ì „ì†¡í•  ë°ì´í„°:", JSON.stringify(requestData));

      $.ajax({
        url: '/api/order_status/CancelOrder',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(requestData),
        headers: {
          'X-CSRF-Token': $('[name=_csrf]').val()
        },
        success: function(response) {
          console.log("âœ… ì„œë²„ ì‘ë‹µ:", response);
          Alert.alert('' ,"ì£¼ë¬¸ í™•ì¸ ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
          fetchListData2();
        },
        error: function(xhr, status, error) {
          console.error("âŒ ì£¼ë¬¸ í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", xhr.responseText);

          try {
            let response = JSON.parse(xhr.responseText);
            Alert.alert('', response.message || "ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
          } catch (e) {
            Alert.alert('', "ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
          }
        }

      });
    }

    //ê³µí†µ ì½”ë“œ
    const selectConfigs = [
      {parentCode: 'ordflag', elementId: 'searchstate'},
    ];

    selectConfigs.forEach(config => {
      initializeSelect3({
        url: '/api/order_status/ordFlagType',
        params: {parentCode: config.parentCode},
        elementId: config.elementId,
        valueField: "code",
        textField: "value",
        includeAllOption: true, // "ì „ì²´" ì˜µì…˜ ì‚¬ìš©
        defaultValue: "0" // ê¸°ë³¸ ì„ íƒê°’ ì¶”ê°€ ("ì£¼ë¬¸ë“±ë¡")
      });
    });
    // ê´€ë¦¬ì Dashboard ì¹´ë“œ í´ë¦­ì´ë™
    function applySavedSettings() {
      var activeSection = sessionStorage.getItem("activeSection");
      var searchState = sessionStorage.getItem("searchState");

      if (searchState) {
        // tab2 í™œì„±í™”
        activateSection();
        // ì§„í–‰êµ¬ë¶„ ì„ íƒ íƒ­ ìƒíƒœê°’ì— ë”°ë¼ ì¸ë±ìŠ¤ ë°”ì¸ë“œ
        setSelectedIndex(document.getElementById("searchstate"), searchState); // ì§„í–‰êµ¬ë¶„ select ë°”ì¸ë”©
        // ì£¼ë¬¸ì¼ì ì˜¬í•´ê±´ìˆ˜ ë°”ì¸ë“œ
        setOrderDateRange();
      }
      // sessionStorage ê°’ ì‚­ì œ (í•œ ë²ˆë§Œ ì ìš©ë˜ë„ë¡)
      sessionStorage.removeItem("activeSection");
      sessionStorage.removeItem("searchState");
    }
    function activateSection() {
      $(".tab-item").hide(); // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
      $("#tab2").show(); // í•´ë‹¹ ì„¹ì…˜ í‘œì‹œ
      $(".tab-links li").removeClass("active"); // ëª¨ë“  íƒ­ì—ì„œ active ì œê±°

      // íŠ¹ì • titleì„ ê°€ì§„ <a> íƒœê·¸ë¥¼ ì°¾ì•„ í•´ë‹¹ <li>ì— active ì¶”ê°€
      $(".tab-links a[title='ì£¼ë¬¸ í™•ì¸']").parent("li").addClass("active");
    }
    // optionê°’ value bind
    function setSelectedIndex(selectElement, selectedValue) {
      let found = false;
      let normalizedValue = String(selectedValue).trim(); // ğŸ”¥ `selectedValue`ë¥¼ `String` ë³€í™˜í•˜ì—¬ ë¹„êµ

      for (let i = 0; i < selectElement.options.length; i++) {

        if (selectElement.options[i].value.trim() === normalizedValue) {
          selectElement.selectedIndex = i;
          found = true;
          break;
        }
      }

      if (!found) {
        selectElement.selectedIndex = 0;
        console.warn("âŒ ì¼ì¹˜í•˜ëŠ” ê°’ì´ ì—†ì–´ ê¸°ë³¸ê°’ 0 ì„¤ì •");
      }
    }

    function setOrderDateRange() {
      const today = new Date();
      const year = today.getFullYear();

      // ì˜¬í•´ 1ì›” 1ì¼ (ë¡œì»¬ ì‹œê°„ ê¸°ì¤€)
      const startDate = new Date(year, 0, 1); // ì›”: 0 = 1ì›”
      const startDateStr = formatDate(startDate);

      // ì˜¬í•´ 12ì›” 31ì¼ (ë¡œì»¬ ì‹œê°„ ê¸°ì¤€)
      const endDate = new Date(year, 11, 31);
      const endDateStr = formatDate(endDate);

      const startDateInput = document.getElementById("startDate");
      const endDateInput = document.getElementById("endDate");
      startDateInput.value = startDateStr;
      endDateInput.value = endDateStr;

    }

    //ë¡œì»¬ ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ ë‚ ì§œë¥¼ YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
    function formatDate(date) {
      let yyyy = date.getFullYear();
      let mm = String(date.getMonth() + 1).padStart(2, "0"); // ì›”ì€ 0ë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ +1 í•„ìš”
      let dd = String(date.getDate()).padStart(2, "0");
      return `${yyyy}-${mm}-${dd}`;
    }


  </script>
</th:block>
</html>

