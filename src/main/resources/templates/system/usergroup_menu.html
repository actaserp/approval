<html layout:decorate="~{layout_page}" xmlns:layout="http://www.w3.org/1999/xhtml">
<style>

</style>

<th:block layout:fragment="content">


    <div class="layout-contents">
        <!-- Page Title -->
        <div class="page-title-wrap">
            <div class="left">
                <h2>메뉴권한</h2>
                <a title="북마크" class="bookmark toggle">
                    내메뉴
                </a>
            </div>
            <ul class="page-navi">
                <li><img src="/images/icon/ico-nav-home.svg" alt="홈아이콘"></li>
                <li>시스템설정</li>
                <li>메뉴권한</li>
            </ul>
        </div>
        <!-- Select -->
        <div class="search-wrap">
            <ul>
                <li>
                    <select title="지역">
                        <option>대구</option>
                    </select>
                </li>
                <li>
                    <select title="구">
                        <option>성서산단</option>
                    </select>
                </li>
                <li>
                    <select title="동">
                        <option>성서</option>
                    </select>
                </li>
            </ul>
        </div>
        <div class="tab-wrap">
            <ul class="tab-links">
                <li>
                    <a href="#tab1" title="목록">목록</a>
                </li>
                <!--                <li>-->
                <!--                    <a href="#tab2" title="등록">등록</a>-->
                <!--                </li>-->
            </ul>
            <div class="tab-contents">
                <!-- Section -->
                <section class="tab-item" id="tab1">
                    <div class="section-top">
                        <div class="search-wrap">

                            <dl>
                                <dt>
                                    <label for="input-group-text fit_box_md">
                                        사용자그룹<span class="eq"></span>
                                    </label>
                                </dt>
                                <dd>
                                    <select class="form-control2" id="cboUserGroup" name="cboUserGroup"></select>
                                </dd>
                            </dl>

                            <dl>
                                <dt>
                                    <label for="text1">
                                        메뉴폴더<span class="eq"></span>
                                    </label>
                                </dt>
                                <dd>
                                    <select class="form-control2" id="cboMenuFolder" name="cboMenuFolder"></select>
                                </dd>
                            </dl>

                            </br>

                            <dl>
                                <dt>
                                    <label for="text1">
                                        <span class="eq"></span>
                                    </label>
                                </dt>
                                <dd>
                                    <div class="srch-box">
<!--                                        <input type="text" id="searchusr" name="searchusr" class="input-srch">-->
                                        <a class="btn-srch" id="input-srch" title="조회" ></a>
                                    </div>
                                </dd>
                            </dl>

                            <dl>
                                <!--                                <dt>-->
                                <!--                                    <label for="text1">-->
                                <!--                                        사용자 그룹<span class="eq">*</span>-->
                                <!--                                    </label>-->
                                <!--                                </dt>-->
                                <!--                                <dd>-->
                                <!--                                    <div class="srch-box">-->
                                <!--                                        <input type="text" id="searchusr" name="searchusr" class="input-srch" placeholder="점검자명 검색">-->
                                <!--                                        <a href="#a" class="btn-srch" id="searchgrid" title="검색" onclick="searchData()" onkeyup="searchData()"></a>-->
                                <!--                                    </div>-->
                                <!--                                </dd>-->
                            </dl>

                        </div>
                        <div class="button-wrap">
                            <ul>
                                <!--                                <li>-->
                                <!--                                    <a class="btn btn-excell" title="일괄다운로드">-->
                                <!--                                        <img src="/images/icon/ico-down-blue.svg" alt="엑셀 아이콘">-->
                                <!--                                        일괄다운로드-->
                                <!--                                    </a>-->
                                <!--                                </li>-->
                                <!--                                <li>-->
                                <!--                                    <a  class="btn btn-excell" title="엑셀다운로드">-->
                                <!--                                        <img src="/images/icon/ico-excell.svg" alt="엑셀 아이콘">-->
                                <!--                                        엑셀다운로드-->
                                <!--                                    </a>-->
                                <!--                                </li>-->
                                <!--                                <li>-->
                                <!--                                    <a  class="btn btn-delete" title="삭제">-->
                                <!--                                        <img src="/images/icon/ico-delete.svg" alt="엑셀 아이콘">-->
                                <!--                                        삭제-->
                                <!--                                    </a>-->
                                <!--                                </li>-->
                                <li>
                                    <a class="btn btn-edit" title="수정">
                                        <img src="/images/icon/ico-edit.svg" alt="엑셀 아이콘">
                                        저장
                                    </a>
                                </li>
                                <!--                                <li>-->
                                <!--                                    <a class="btn btn-print" title="순회점검일지 출력">-->
                                <!--                                        <img src="/images/icon/ico-print.svg" alt="엑셀 아이콘">-->
                                <!--                                        순회점검일지 출력-->
                                <!--                                    </a>-->
                                <!--                                </li>-->
                            </ul>
                        </div>
                    </div> <!--//section-top end -->

                    <!--                    grid 영역-->
                    <div class="container-fluid">
<!--                        <p id="selectedItem"></p>-->
                        <div id="theGrid"></div>
                    </div>
                    <div class="btn-wrap">

                    </div>
                </section>


                <!-- Section -->

            </div> <!--//tab-contens end-->
        </div> <!--//tab-wrap end-->
    </div> <!--//layout-contents end -->


</th:block>
<th:block layout:fragment="scripts">
    <th:block th:replace="/common/approve_box :: approve_box"></th:block>
    <th:block th:replace="/common/ax5_uploader :: ax5_uploader"></th:block>
    <th:block th:replace="/common/upload_one_image_box :: upload_one_image_box"></th:block>
    <th:block th:replace="/common/popup_select_user_code :: popup_select_user_code"></th:block>

    <script type="text/javascript">

        var theGrid;
        var viewdata;

        document.readyState === 'complete' ? init() : window.onload = init;
        function init() {
            let data2 = [];
            let group_id = $('#cboUserGroup').val();
            let folder_id = $('#cboMenuFolder').val();
            let folderNames = {};  // 폴더 ID와 이름을 저장할 객체
            let menuFolderName = '폴더명';  // 기본 폴더명, AJAX 응답 후 업데이트


            $.ajax({
                url: '/api/system/usergroupmenu/read',
                type: 'GET',
                data: {
                    'group_id': group_id,
                    'folder_id': folder_id
                },
                async: false,
                success: function (data) {
                    console.log('wijmo', data.data);
                    data2 = data.data;

                    folderNames = data.FolderName || [];
                    // folder_id에 해당하는 폴더명을 찾아서 menuFolderName에 할당
                    const folder = folderNames.find(f => f.key == folder_id);
                    if (folder) {
                        menuFolderName = folder.value;
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.error('Error fetching log_list data:', textStatus, errorThrown);
                }
            });


            viewdata = new wijmo.collections.CollectionView(data2);
            // 데이터 그리드에 바인딩
            theGrid = new wijmo.grid.FlexGrid('#theGrid', {
                autoGenerateColumns: false,
                showMarquee: true,
                columns: [
                    {
                        binding: 'name',
                        header: '코드명',
                        width: 250,
                        align: 'center',
                    },
                    {
                        binding: 'r',
                        header: '읽기',
                        width: 200,
                        align: 'center',
                        dataType: wijmo.DataType.Boolean,
                        isReadOnly: false,
                        isContentHtml: true, // HTML 내용 사용 설정

                    },
                    {
                        binding: 'w',
                        header: '쓰기',
                        width: 200,
                        align: 'center',
                        dataType: wijmo.DataType.Boolean,
                        isReadOnly: false,
                    },
                    {binding: '', header: '', width: 900, align: 'center'},
                    {
                        header: menuFolderName,
                        align: 'center',
                        width: 250,
                        binding: 'pid',  // pid 값을 폴더명으로 바인딩
                        dataMap: new wijmo.grid.DataMap(folderNames, 'key', 'value')  // 폴더 ID와 폴더명을 매핑하여 표시
                    },
                ],
                itemsSource: viewdata
            });


            let selector = new wijmo.grid.selector.Selector(theGrid, {
                itemChecked: () => {

                }
            })
            // 선택이 변경될 때, 현재 항목 업데이트


            theGrid.rowHeaders.columns.splice(0, 1);  //맨 앞에 헤더부분 없애기

            theGrid.collectionView.groupDescriptions.push(new wijmo.collections.PropertyGroupDescription('pid'));




        }


        let page = null;

        // 초기 콤보박스 채우기
        AjaxUtil.fillSelectOptions($('#cboUserGroup'), 'user_group', '', '');
        AjaxUtil.fillSelectOptions($('#cboMenuFolder'), 'menu_folder', 'all', '');

    </script>
</th:block>

</html>