<html layout:decorate="~{layout_page}" xmlns:layout="http://www.w3.org/1999/xhtml">
<head>
    <style>
        .wj-header {
            text-align: center !important;
        }

        /*#theGrid1.wj-flexgrid .wj-cell,
        #theGrid2.wj-flexgrid .wj-cell,
        #theGrid3.wj-flexgrid .wj-cell,
        #theGrid4.wj-flexgrid .wj-cell {
            padding: 12px;

        }

        #theGrid1.wj-flexgrid .downloads,
        #theGrid2.wj-flexgrid .downloads,
        #theGrid3.wj-flexgrid .downloads,
        #theGrid4.wj-flexgrid .downloads {
            padding-top: 0px;
        }*/

        /*.container-fluid {
            overflow-x: auto;
            max-width: 100%;
        }*/

        /* 토글 클릭시 애니메이션 효과*/
        .wj-flexgrid .wj-colheaders, .wj-flexgrid .wj-cell {
            transition: all 0.2s ease;
        }

        #date-list-modal .popup-wrapper {
            min-width: unset !important; /* layout.css 무시 */
            width: 300px !important;
            height: auto;
            max-height: 300px;
            overflow-y: auto;
        }

        .popup-wrapper::-webkit-scrollbar-track {
            background-color: transparent !important;
        }
    </style>
</head>

<th:block layout:fragment="content">

    <!--- (레이아웃) Contents 영역 -->
    <div class="layout-contents">
        <!-- Page Title -->
        <div class="page-title-wrap">
            <div class="left">
                <h2>발전량 관리</h2><a id="toggleButton" onclick="toggleSearchWrap()"><img src="/images/icon/ico-down.png"
                                                                                      alt="알람 아이콘"></a>
                <!--<a title="북마크" class="bookmark toggle">
                    내메뉴
                </a>-->
            </div>
            <ul class="page-navi">
                <li><img src="/images/icon/ico-nav-home.svg" alt="홈아이콘"></li>
                <li>서비스분석</li>
                <li>매출 관리</li>
                <li>발전량 관리</li>
            </ul>
        </div>

        <!-- Select -->
        <div class="search-wrap" id="searchWrap" style="display: none">
            <ul>
                <li>
                    <select title="지역" id="spworkcd" name="spworkcd"
                            onchange="updateCompcdOptions(); saveSelectedSandanData(); ">
                        <!-- 지역 옵션을 JavaScript에서 동적으로 채움 -->
                    </select>
                    <input type="hidden" id="spworknm" name="spworknm">
                </li>
                <li>
                    <select title="산단" id="spcompcd" name="spcompcd"
                            onchange="updatePlancdOptions(); saveSelectedSandanData();">
                        <!-- 산단 옵션을 JavaScript에서 동적으로 채움 -->
                    </select>
                    <input type="hidden" id="spcompnm" name="spcompnm">
                </li>
                <li>
                    <select title="시설" id="spplancd" name="spplancd"
                            onchange="updatePlannm(); saveSelectedSandanData()">
                        <!-- 시설 옵션을 JavaScript에서 동적으로 채움 -->
                    </select>
                    <input type="hidden" id="spplannm" name="spplannm">
                </li>
            </ul>
        </div>

        <div class="tab-wrap">
            <ul class="tab-links">
                <li>
                    <a href="#tab1" title="목록">목록</a>
                </li>
                <li>
                    <a href="#tab2" title="수정">수정</a>
                </li>
                <li>
                    <a href="#tab3" title="시간별조회">시간별 조회</a>
                </li>
                <li>
                    <a href="#tab4" title="기간별조회">기간별 조회</a>
                </li>
                <li>
                    <a href="#tab5" title="기간별대비">기간별 대비</a>
                </li>
            </ul>
            <div class="tab-contents">

                <!-- tab1 -->
                <section class="tab-item" id="tab1">
                    <div class="section-top">
                        <div class="search-wrap">
                            <dl>
                                <dt>
                                    조회일자<span class="eq">*</span>
                                </dt>
                                <dd>
                                    <ul class="date-box">
                                        <li>
                                            <input type="date" id="date1_tab1" name="">
                                            <label for="date1_tab1" class="hide">시작일</label>
                                        </li>
                                        <li>
                                            <input type="date" id="date2_tab1" name="">
                                            <label for="date2_tab1" class="hide">종료일</label>
                                        </li>
                                    </ul>
                                </dd>
                            </dl>
                            <dl>
                                <dt>
                                    <label for="select1_tab1">
                                        발전기코드<span class="eq">*</span>
                                    </label>
                                </dt>

                                <dd>
                                    <select id="select1_tab1" class="w120"></select>
                                </dd>
                            </dl>
                            <dl>
                                <dt>&nbsp;</dt>
                                <dd>
                                    <li>
                                        <a class="btn btn-delete" title="검색" id="searchButton1" onclick="search()">
                                            <!--                                        class 쓰이는 곳 찾고 없으면 클래스명 수정하기-->
                                            <img src="/images/icon/btn-srch.svg" alt="검색 아이콘">
                                            검색
                                        </a>
                                    </li>
                                </dd>
                            </dl>
                        </div>
                        <div class="button-wrap">
                            <ul>
                                <li>
                                    <a class="btn btn-popup-open" title="" onclick="showPopupWithDateList('tab1')"
                                       data-popup="popup2"
                                       id="btnShowDateList">
                                        일자목록
                                    </a>
                                </li>
                                <li>
                                    <a class="btn btn-popup-open" title="" onclick="showPopup(event)"
                                       data-popup="popup1"
                                       id="btnShowUpload">
                                        <img src="/images/icon/ico-excell.svg" alt="엑셀 아이콘">
                                        엑셀등록
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div> <!--//section-top end -->

                    <div class="container-fluid" style="padding-left: 0; padding-right: 0;">
                        <p id="selectedItem1"></p>
                        <div id="theGrid1" style="max-height: 722px;"></div>
                    </div>
                </section>

                <!-- tab2 -->
                <section class="tab-item" id="tab2">
                    <div class="section-top">
                        <div class="search-wrap">
                            <dl>
                                <dt>
                                    조회일자<span class="eq">*</span>
                                </dt>
                                <dd>
                                    <ul class="date-box">
                                        <li>
                                            <input type="date" id="date1_tab2" name="" value="2023-09-01">
                                            <label for="date1_tab2" class="hide">시작일</label>
                                        </li>
                                        <li>
                                            <input type="date" id="date2_tab2" name="" value="2023-09-30">
                                            <label for="date2_tab2" class="hide">종료일</label>
                                        </li>
                                    </ul>
                                </dd>
                            </dl>
                            <dl>
                                <dt>
                                    <label for="select1_tab2">
                                        발전기코드<span class="eq">*</span>
                                    </label>
                                </dt>

                                <dd>
                                    <select id="select1_tab2" class="w120"></select>
                                </dd>
                            </dl>
                            <dl>
                                <dt>&nbsp;</dt>
                                <dd>
                                    <li>
                                        <a class="btn btn-delete" title="검색" id="searchButton2">
                                            <!--                                        class 쓰이는 곳 찾고 없으면 클래스명 수정하기-->
                                            <img src="/images/icon/btn-srch.svg" alt="검색 아이콘">
                                            검색
                                        </a>
                                    </li>
                                </dd>
                            </dl>
                        </div>
                        <div class="button-wrap">
                            <ul>
                                <li>
                                    <a class="btn btn-popup-open" title="" onclick="showPopupWithDateList('tab2')"
                                       data-popup="popup2"
                                       id="btnShowDateList2">
                                        일자목록
                                    </a>
                                </li>
                                <li>
                                    <a class="btn btn-delete" id="btnDelete" title="삭제">
                                        <img src="/images/icon/ico-delete.svg" alt="엑셀 아이콘">
                                        삭제
                                    </a>
                                </li>
                                <li>
                                    <a class="btn btn-edit" id="btnSave" title="저장">
                                        <img src="/images/icon/ico-save.svg" alt="저장 아이콘">
                                        저장
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div> <!--//section-top end -->
                    <div class="container-fluid" style="padding-left: 0; padding-right: 0;">
                        <p id="selectedItem2"></p>
                        <div id="theGrid2" style="max-height: 722px;"></div>
                    </div>
                </section>

                <!-- tab3 -->
                <section class="tab-item" id="tab3">
                    <div class="section-top">
                        <div class="search-wrap">
                            <dl>
                                <dt>
                                    조회일자<span class="eq">*</span>
                                </dt>
                                <dd>
                                    <ul class="date-box" id="dateBoxContainer">
                                        <li id="startDateContainer">
                                            <input type="date" id="startDate" name="startDate" value="2024-09-20">
                                        </li>
                                    </ul>
                                </dd>
                            </dl>
                            <dl>
                                <dt>
                                    <label for="select1_tab1">
                                        발전기코드<span class="eq">*</span>
                                    </label>
                                </dt>

                                <dd>
                                    <select id="select1_tab3" class="w120">
                                        <option>전체</option>
                                        <option>AJ38</option>
                                        <option>A373</option>
                                    </select>
                                </dd>
                            </dl>
                            <dl>
                                <dt>&nbsp;</dt>
                                <dd>
                                    <li>
                                        <a class="btn btn-delete" title="검색" id="searchButton3" onclick="search()">
                                            <!--                                        class 쓰이는 곳 찾고 없으면 클래스명 수정하기-->
                                            <img src="/images/icon/btn-srch.svg" alt="검색 아이콘">
                                            검색
                                        </a>
                                    </li>
                                </dd>
                            </dl>
                        </div>
                    </div> <!--//section-top end -->

                    <div class="row" style="margin-bottom: 35px;">
                        <div class="chart-wrap">
                            <div id="chartHolder3" style="height:545px; width:1560px;"></div>
                        </div>
                    </div>
                    <div class="container-fluid">
                        <div id="theGrid3" style="height:137px; width:100%;"></div>
                    </div>
                </section>

                <!-- tab4 -->
                <section class="tab-item" id="tab4">
                    <div class="section-top">
                        <div class="search-wrap">
                            <dl>
                                <dt>
                                    조회기간<span class="eq">*</span>
                                </dt>
                                <dd>
                                    <ul class="date-box" id="dateBoxContainer">
                                        <li id="startDateContainer">
                                            <input type="month" id="startDate" name="startDate" value="2024-01">
                                        </li>
                                        <li id="endDateContainer">
                                            <input type="month" id="endDate" name="endDate" value="2024-12">
                                        </li>
                                    </ul>
                                </dd>
                            </dl>
                            <dl>
                                <dt>
                                    <label for="select1_tab1">
                                        발전기코드<span class="eq">*</span>
                                    </label>
                                </dt>

                                <dd>
                                    <select id="select1_tab4" class="w120">
                                        <option>전체</option>
                                        <option>AJ38</option>
                                        <option>A373</option>
                                    </select>
                                </dd>
                            </dl>
                            <dl>
                                <dt>&nbsp;</dt>
                                <dd>
                                    <li>
                                        <a class="btn btn-delete" title="검색" id="searchButton4" onclick="search()">
                                            <!--                                        class 쓰이는 곳 찾고 없으면 클래스명 수정하기-->
                                            <img src="/images/icon/btn-srch.svg" alt="검색 아이콘">
                                            검색
                                        </a>
                                    </li>
                                </dd>
                            </dl>
                        </div>
                    </div> <!--//section-top end -->

                    <!-- 4분할 레이아웃 -->
                    <div class="row row-2" style="margin-bottom: 12px">
                        <div class="col wp50" style="margin-right: 15px">
                            <section class="tab-section section_top" style="border-radius: 10px; height: 348px; ">
                                <div class="title-wrap">
                                    <h3>월별</h3>
                                    <ul class="tab-links-sub">
                                        <li>
                                            <a href="#tab4_1" title="통계">통계</a>
                                        </li>
                                        <li>
                                            <a href="#tab4_2" title="현황">현황</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="tab-contents">
                                    <!-- tab4_1 -->
                                    <div class="tab-item-sub" id="tab4_1">
                                        <div class="chart-wrap">
                                            <div id="chartHolder4_1" style="height:266px; width:100%;"></div>
                                        </div>
                                    </div>
                                    <!-- tab4_2 -->
                                    <div class="tab-item-sub" id="tab4_2">
                                        <div class="container-fluid">
                                            <div id="theGrid4_1" style="height:266px; width:100%;"></div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>

                        <div class="col wp50">
                            <section class="tab-section section_top" style="height: 348px;">
                                <div class="title-wrap">
                                    <h3>분기별</h3>
                                    <ul class="tab-links-sub">
                                        <li>
                                            <a href="#tab4_3" title="통계">통계</a>
                                        </li>
                                        <li>
                                            <a href="#tab4_4" title="현황">현황</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="tab-contents">
                                    <!-- tab4_3 -->
                                    <div class="tab-item-sub" id="tab4_3">
                                        <div class="chart-wrap">
                                            <div id="chartHolder4_2" style="height:266px; width:100%;"></div>
                                        </div>
                                    </div>
                                    <!-- tab4_4 -->
                                    <div class="tab-item-sub" id="tab4_4">
                                        <div class="container-fluid">
                                            <div id="theGrid4_2" style="height:266px; width:100%;"></div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>

                    <div class="row row-2" style="margin-bottom: 12px">
                        <div class="col wp50" style="margin-right: 15px">
                            <section class="tab-section section_top" style="border-radius: 10px; height: 348px; ">
                                <div class="title-wrap">
                                    <h3>반기별</h3>
                                    <ul class="tab-links-sub">
                                        <li>
                                            <a href="#tab4_5" title="통계">통계</a>
                                        </li>
                                        <li>
                                            <a href="#tab4_6" title="현황">현황</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="tab-contents">
                                    <!-- tab4_5 -->
                                    <div class="tab-item-sub" id="tab4_5">
                                        <div class="chart-wrap">
                                            <div id="chartHolder4_3" style="height:266px; width:100%;"></div>

                                        </div>
                                    </div>
                                    <!-- tab4_6 -->
                                    <div class="tab-item-sub" id="tab4_6">
                                        <div class="container-fluid">
                                            <div id="theGrid4_3" style="height:266px; width:100%;"></div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>

                        <div class="col wp50">
                            <section class="tab-section section_top" style="height: 348px;">
                                <div class="title-wrap">
                                    <h3>연도별</h3>
                                    <ul class="tab-links-sub">
                                        <li>
                                            <a href="#tab4_7" title="통계">통계</a>
                                        </li>
                                        <li>
                                            <a href="#tab4_8" title="현황">현황</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="tab-contents">
                                    <!-- tab4_7 -->
                                    <div class="tab-item-sub" id="tab4_7">
                                        <div class="chart-wrap">
                                            <div id="chartHolder4_4" style="height:266px; width:100%;"></div>
                                        </div>
                                    </div>
                                    <!-- tab4_8 -->
                                    <div class="tab-item-sub" id="tab4_8">
                                        <div class="container-fluid">
                                            <div id="theGrid4_4" style="height:266px; width:100%;"></div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </section>

                <!-- tab5 -->
                <section class="tab-item" id="tab5">
                    <div class="section-top">
                        <div class="search-wrap">
                            <dl>
                                <dt>
                                    조회기간<span class="eq">*</span>
                                </dt>
                                <dd>
                                    <ul class="date-box" id="dateBoxContainer">
                                        <li id="startDateContainer">
                                            <input type="month" id="startDate" name="startDate" value="2023-01">
                                        </li>
                                        <li id="endDateContainer">
                                            <input type="month" id="endDate" name="endDate" value="2024-12">
                                        </li>
                                    </ul>
                                </dd>
                            </dl>
                            <dl>
                                <dt>
                                    <label for="select1_tab1">
                                        발전기코드<span class="eq">*</span>
                                    </label>
                                </dt>

                                <dd>
                                    <select id="select1_tab5" class="w120">
                                        <option>전체</option>
                                        <option>AJ38</option>
                                        <option>A373</option>
                                    </select>
                                </dd>
                            </dl>
                            <dl>
                                <dt>&nbsp;</dt>
                                <dd>
                                    <li>
                                        <a class="btn btn-delete" title="검색" id="searchButton5" onclick="search()">
                                            <!--                                        class 쓰이는 곳 찾고 없으면 클래스명 수정하기-->
                                            <img src="/images/icon/btn-srch.svg" alt="검색 아이콘">
                                            검색
                                        </a>
                                    </li>
                                </dd>
                            </dl>
                        </div>
                    </div> <!--//section-top end -->

                    <!-- 4분할 레이아웃 -->
                    <div class="row row-2" style="margin-bottom: 12px">
                        <div class="col wp50" style="margin-right: 15px">
                            <section class="tab-section section_top" style="border-radius: 10px; height: 348px; ">
                                <div class="title-wrap">
                                    <h3>YoY</h3>
                                    <ul class="tab-links-sub">
                                        <li>
                                            <a href="#tab5_1" title="통계">통계</a>
                                        </li>
                                        <li>
                                            <a href="#tab5_2" title="현황">현황</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="tab-contents">
                                    <!-- tab2_1 -->
                                    <div class="tab-item-sub" id="tab5_1">
                                        <div class="chart-wrap">
                                            <div id="chartHolder5_1" style="height:266px; width:100%;"></div>
                                        </div>
                                    </div>
                                    <!-- tab2_2 -->
                                    <div class="tab-item-sub" id="tab5_2">
                                        <div class="container-fluid">
                                            <div id="theGrid5_1" style="height:266px; width:100%;"></div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>

                        <div class="col wp50">
                            <section class="tab-section section_top" style="height: 348px;">
                                <div class="title-wrap">
                                    <h3>QoQ</h3>
                                    <ul class="tab-links-sub">
                                        <li>
                                            <a href="#tab5_3" title="통계">통계</a>
                                        </li>
                                        <li>
                                            <a href="#tab5_4" title="현황">현황</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="tab-contents">
                                    <!-- tab2_3 -->
                                    <div class="tab-item-sub" id="tab5_3">
                                        <div class="chart-wrap">
                                            <div id="chartHolder5_2" style="height:266px; width:100%;"></div>
                                        </div>
                                    </div>
                                    <!-- tab2_4 -->
                                    <div class="tab-item-sub" id="tab5_4">
                                        <div class="container-fluid">
                                            <div id="theGrid5_2" style="height:266px; width:100%;"></div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>

                    <div class="row row-2" style="margin-bottom: 12px">
                        <div class="col wp50" style="margin-right: 15px">
                            <section class="tab-section section_top" style="border-radius: 10px; height: 348px; ">
                                <div class="title-wrap">
                                    <h3>MoM</h3>
                                    <ul class="tab-links-sub">
                                        <li>
                                            <a href="#tab5_5" title="통계">통계</a>
                                        </li>
                                        <li>
                                            <a href="#tab5_6" title="현황">현황</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="tab-contents">
                                    <!-- tab2_5 -->
                                    <div class="tab-item-sub" id="tab5_5">
                                        <div class="chart-wrap">
                                            <div id="chartHolder5_3" style="height:266px; width:100%;"></div>

                                        </div>
                                    </div>
                                    <!-- tab2_6 -->
                                    <div class="tab-item-sub" id="tab5_6">
                                        <div class="container-fluid">
                                            <div id="theGrid5_3" style="height:266px; width:100%;"></div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>

                        <div class="col wp50">
                            <section class="tab-section section_top" style="height: 348px;">
                                <div class="title-wrap">
                                    <h3>YTD</h3>
                                    <ul class="tab-links-sub">
                                        <li>
                                            <a href="#tab5_7" title="통계">통계</a>
                                        </li>
                                        <li>
                                            <a href="#tab5_8" title="현황">현황</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="tab-contents">
                                    <!-- tab2_7 -->
                                    <div class="tab-item-sub" id="tab5_7">
                                        <div class="chart-wrap">
                                            <div id="chartHolder5_4" style="height:266px; width:100%;"></div>
                                        </div>
                                    </div>
                                    <!-- tab2_8 -->
                                    <div class="tab-item-sub" id="tab5_8">
                                        <div class="container-fluid">
                                            <div id="theGrid5_4" style="height:266px; width:100%;"></div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </section>
            </div> <!--//tab-contens end-->
        </div> <!--//tab-wrap end-->

        <!-- 엑셀업로드 팝업 -->
        <div class="modal" id="single-file-upload-page">
            <div class="popup-wrapper w700" id="popup1">
                <div class="popup-title">
                    <h3>엑셀 업로드</h3>
                    <a title="팝업닫기" onclick="closePopup()" class="btn-popup-close">
                        <img src="/images/icon/btn-popup-close.svg" alt="닫기">
                    </a>
                </div>
                <div class="popup-contents">
                    <form id="file-upload-form" enctype="multipart/form-data">
                        <div class="table-wrap">
                            <table class="write-table">
                                <caption>발전량등록 테이블</caption>
                                <colgroup>
                                    <col class="wp20">
                                    <col class="wp80">
                                </colgroup>
                                <tbody>
                                <tr>
                                    <th>
                                        <label for="date6">
                                            일자
                                        </label>
                                    </th>
                                    <td>
                                        <div class="input-clear">
                                            <input type="date" id="date6" name="">
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <th>
                                        첨부파일
                                    </th>
                                    <td>
                                        <div id="uploadComponent2" class="upload-component">
                                            <div class="upload-filebox">
                                                <img src="/images/icon/ico-fileupload.svg" alt="업로드아이콘">
                                                <a class="btn" title="파일업로드">파일업로드</a>
                                                <input type="file" id="fileInput" class="fileInput" name="upload_file">
                                                <p>Maximun upload file size <span>1GiB</span></p>
                                                <p>*업로드 시 상태는 Excel이며, 파일은 한 개만 첨부할 수 있습니다.</p>
                                            </div>

                                            <div class="upload-filelist">
                                                <div class="title">
                                                    <h5>Files (0)</h5>
                                                    <a title="Delete all" class="btn-file-deleteall">Delete all</a>
                                                </div>
                                                <ul class="filelist" id="filelist">
                                                </ul>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="popup-button">
                            <button onclick="closePopup()"
                                    style="border: 1px solid #03428E !important; font-size: 15px !important;">취소
                            </button>
                            <button type="button" onclick="uploadExcelAndLoadData()"
                                    style="border: 1px solid #03428E !important;color: white;background: #03428E !important;font-size: 15px !important;">
                                저장
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- 일자목록 팝업 -->
        <div class="modal" id="date-list-modal">
            <div class="popup-wrapper" id="popup2">
                <div class="popup-title">
                    <h3>일자 목록</h3>
                    <a title="팝업닫기" onclick="closePopup()" class="btn-popup-close">
                        <img src="/images/icon/btn-popup-close.svg" alt="닫기">
                    </a>
                </div>
                <div class="popup-contents" id="date-list-content">
                    <div class="table-wrap">
                        <table class="list-table">
                            <tbody id="date-list-table-body">
                            <!-- JavaScript로 데이터 행이 추가됩니다 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div> <!--//layout-contents end -->
    <footer>
        <p>Copyrightⓒ 0000 corp. All rights reserved.</p>
    </footer>

</th:block>

<th:block layout:fragment="scripts">
    <th:block th:replace="/common/columns_setting :: columns_setting"></th:block>
    <th:block th:replace="/common/approve_box :: approve_box"></th:block>
    <th:block th:replace="/common/ax5_uploader :: ax5_uploader"></th:block>
    <th:block th:replace="/common/upload_one_image_box :: upload_one_image_box"></th:block>
    <th:block th:replace="/common/popup_select_user_code :: popup_select_user_code"></th:block>

    <script type="text/javascript">

        let theGrid1, theGrid2;
        let viewdata1, viewdata2;

        // DOM 로드 완료 시 실행
        $(document).ready(function (e) {

            // 임시로 막아둠
            document.getElementById("btnShowDateList").onclick = function(e) {
                e.preventDefault();  // 첫 번째 버튼 클릭 이벤트 막기
            };
            document.getElementById("btnShowDateList2").onclick = function(e) {
                e.preventDefault();  // 두 번째 버튼 클릭 이벤트 막기
            };

            init();

            // 초기 활성화된 탭에 대해서만 차트를 초기화
            // rMateChartH5.create("chart1", "chartHolder1", "rMateOnLoadCallFunction=chartReadyHandler", "120%", "100%");

            // $('#chartHolder1').data('initialized', true);


            $('ul.tab-links li a').on('click', function () {
                var currentAttrValue = $(this).attr('href');

                // 모든 탭 숨기기
                $('.tab-contents .tab-item').hide();

                // 현재 탭 보이기
                $(currentAttrValue).show();

                // 현재 탭 활성화
                $(this).parent('li').addClass('active').siblings().removeClass('active');

                // if (currentAttrValue === '#tab3') {
                //     if (!$('#chartHolder1').data('initialized')) {
                //         rMateChartH5.create("chart1", "chartHolder1", "rMateOnLoadCallFunction=chartReadyHandler", "120%", "100%");
                //         $('#chartHolder1').data('initialized', true);
                //         loadMonthlyData(); // 월별 데이터 로드 및 차트 업데이트
                //     } else {
                //         updateChart('chart1', 'chartHolder1');
                //     }
                // }

                // if (currentAttrValue === '#tab4') {
                //     if (!$('#chartHolder2').data('initialized')) {
                //         rMateChartH5.create("chart2", "chartHolder2", "rMateOnLoadCallFunction=chartReadyHandler2", "120%", "100%");
                //         $('#chartHolder2').data('initialized', true);
                //         loadInitialDataTab2(); // Tab2 초기 데이터 로드 및 차트 생성
                //     } else {
                //         updateChart('chart2', 'chartHolder2');
                //     }
                // }

                // 0919
                if (currentAttrValue === '#tab3') {
                    initTab3Chart();
                    initTab3Grid();
                } else if (currentAttrValue === '#tab4') {
                    initTab4Charts();
                    initTab4Grids();
                } else if (currentAttrValue === '#tab5') {
                    initTab5Charts();
                    initTab5Grids();
                }
            });

            // 초기 탭 설정 (페이지 로드 시 첫 번째 탭 활성화)
            $('ul.tab-links li:first-child a').click();

            // document.getElementById("comparisonType").addEventListener("change", updateComparisonType);

            // loadInitialDataTab2();
        });

        // 페이지 초기화 함수
        function init() {
            initializeSelections();  //위에 산단, 발전소명 관련 함수

            loadData(); // 데이터 로드 및 그리드 초기화 함수 호출
            setCurrentDate(); // 현재 날짜 설정
            loadPowerIds(); // 발전기코드 옵션
            setStartAndEndDate('tab1'); // 시작일, 종료일 설정 (tab1)
            setStartAndEndDate('tab2'); // 시작일, 종료일 설정 (tab2)

            initializeGrid();
            initializeGrid2();

            // ==========

            // document.getElementById("periodType").value = "monthly"; // 기본으로 월별이 선택되도록 설정

            // loadYearlyData(); // tab1 연도 데이터를 로드
            // loadYearlyDataTab2(); // tab2 연도 데이터를 로드

            // updateYearInPeriod(); // 조회연도 변경 시 조회기간의 연도도 동기화
            // updatePeriodInputs(); // 페이지 로드 시 startDate와 endDate 초기화
            loadGeneratorNames(); // 발전기명을 서버에서 로드
            // loadMonthlyData(); // 페이지 로드 시 월별 데이터 자동 로드

            // 슬라이드 차트 초기화
            // chartReadyHandler("chart1", "chartHolder1", []); // 초기에는 빈 데이터로 초기화
            // chartReadyHandler2("chart2", "chartHolder2", []);

            // tab3 그리드 초기화
            // theGrid3 = new wijmo.grid.FlexGrid('#theGrid3', {
            //     autoGenerateColumns: false, // 그리드 초기화 시 자동 생성된 열을 비활성화
            //     columns: [] // 초기 열 설정
            // });

            // tab4 그리드 초기화
            // theGrid4 = new wijmo.grid.FlexGrid('#theGrid4', {
            //     autoGenerateColumns: false, // 그리드 초기화 시 자동 생성된 열을 비활성화
            //     columns: [] // 초기 열 설정
            // });

            // 0919 하드코딩

            // tab3와 tab4의 초기화는 해당 탭이 선택될 때만 수행하도록 변경
            // $('ul.tab-links li a').on('click', function () {
            //     var currentAttrValue = $(this).attr('href');
            //     if (currentAttrValue === '#tab3') {
            //         initTab3();
            //     } else if (currentAttrValue === '#tab4') {
            //         initTab4Charts();
            //         initTab4Grids();
            //     }
            // });

        }


        // 그리드 초기화
        function initializeGrid(data) {
            // 이미 그리드가 초기화되어 있는지 확인
            if (theGrid1 && theGrid1.hostElement) {
                theGrid1.itemsSource = data; // 그리드가 이미 초기화된 경우 데이터만 갱신
            } else {
                try {
                    theGrid1 = new wijmo.grid.FlexGrid('#theGrid1', {
                        autoGenerateColumns: false,
                        showMarquee: true,
                        isReadOnly: true,
                        columns: [
                            //  format: 'n0' : 숫자를 천단위로 구분, 소수점 이하 표시하지 않는 포맷
                            {binding: 'rownum', header: 'NO', width: 65, align: 'center'},
                            {binding: 'standdt', header: '일자', width: 115, align: 'center'},
                            {binding: 'powerid', header: '발전기코드', width: 100, align: 'center'},
                            {binding: 'powernm', header: '발전기명', width: 200, align: 'center'},
                            {binding: 'chargedv', header: '충전/방전', width: 100, align: 'center'},
                            {binding: 'mevalue01', header: '01시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue02', header: '02시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue03', header: '03시', width: 90, align: 'right', format: 'n0'},
                            {
                                binding: 'toggle',
                                header: '...',
                                width: 90,
                                align: 'right',
                                format: 'n0',
                                allowSorting: false
                            },
                            {binding: 'mevalue04', header: '04시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue05', header: '05시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue06', header: '06시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue07', header: '07시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue08', header: '08시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue09', header: '09시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue10', header: '10시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue11', header: '11시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue12', header: '12시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue13', header: '13시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue14', header: '14시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue15', header: '15시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue16', header: '16시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue17', header: '17시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue18', header: '18시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue19', header: '19시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue20', header: '20시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue21', header: '21시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue22', header: '22시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue23', header: '23시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue24', header: '24시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevaluet', header: '합계', width: 110, align: 'right', format: 'n0'},
                            {binding: 'indatem', header: '등록일자', width: 115, align: 'center'},
                            {binding: 'inusernm', header: '등록자', width: 100, align: 'center'},
                            {binding: 'updatem', header: '최종수정일', width: 115, align: 'center'}
                        ],
                        itemsSource: data
                    });

                    theGrid1.rowHeaders.columns.splice(0, 1);  // 맨 앞에 헤더부분 없애기

                    initializeColumnToggle(theGrid1); // 컬럼 숨기기 초기화 함수 호출
                } catch (error) {
                    console.error('Failed to initialize grid:', error);
                }
            }
        }

        // 두 번째 그리드 초기화
        function initializeGrid2(data) {
            // 이미 그리드가 초기화되어 있는지 확인
            if (theGrid2 && theGrid2.hostElement) {
                theGrid2.itemsSource = data; // 그리드가 이미 초기화된 경우 데이터만 갱신
            } else {
                try {
                    theGrid2 = new wijmo.grid.FlexGrid('#theGrid2', {
                        autoGenerateColumns: false,
                        showMarquee: true,
                        isReadOnly: false, // 수정 가능하게 설정
                        columns: [
                            {binding: 'rownum', header: 'NO', width: 65, align: 'center'},
                            {binding: 'standdt', header: '일자', width: 115, align: 'center'},
                            {binding: 'powerid', header: '발전기코드', width: 100, align: 'center'},
                            {binding: 'powernm', header: '발전기명', width: 200, align: 'center'},
                            {binding: 'chargedv', header: '충전/방전', width: 100, align: 'center'},
                            {binding: 'mevalue01', header: '01시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue02', header: '02시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue03', header: '03시', width: 90, align: 'right', format: 'n0'},
                            {
                                binding: 'toggle',
                                header: '...',
                                width: 90,
                                align: 'right',
                                format: 'n0',
                                allowSorting: false
                            },
                            {binding: 'mevalue04', header: '04시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue05', header: '05시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue06', header: '06시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue07', header: '07시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue08', header: '08시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue09', header: '09시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue10', header: '10시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue11', header: '11시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue12', header: '12시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue13', header: '13시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue14', header: '14시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue15', header: '15시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue16', header: '16시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue17', header: '17시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue18', header: '18시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue19', header: '19시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue20', header: '20시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue21', header: '21시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue22', header: '22시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue23', header: '23시', width: 90, align: 'right', format: 'n0'},
                            {binding: 'mevalue24', header: '24시', width: 90, align: 'right', format: 'n0'},
                            {
                                binding: 'mevaluet',
                                header: '합계',
                                width: '*',
                                minWidth: 110,
                                align: 'right',
                                format: 'n0'
                            },
                            {binding: 'indatem', header: '등록일자', width: 115, align: 'center'},
                            {binding: 'inusernm', header: '등록자', width: 100, align: 'center'},
                            {binding: 'updatem', header: '최종수정일', width: 115, align: 'center'}
                        ],
                        itemsSource: data,

                        cellEditEnded: function (s, e) {
                            const item = s.rows[e.row].dataItem; // 현재 편집된 행의 데이터
                            calculateSumForRow(item); // 합계 계산
                            s.invalidate(); // 그리드 새로 고침
                        }
                    });

                    theGrid2.rowHeaders.columns.splice(0, 1); // 맨 앞에 헤더부분 없애기

                    initializeColumnToggle(theGrid2); // 컬럼 숨기기 초기화 함수 호출
                } catch (error) {
                    console.error('Failed to initialize grid:', error);
                }
            }
        }

        // 차트 =============================================================

        // tab3 차트
        //         function chartReadyHandler(id, chartHolderId, gridData) {
        //             // id에 해당하는 차트가 생성되었는지 확인
        //             var chart = document.getElementById(id);
        //             if (!chart) {
        //                 // console.error("차트가 생성되지 않았습니다: " + id);
        //                 return;
        //             }
        //
        //             if (!gridData) {
        //                 // console.error("그리드 데이터가 정의되지 않았습니다.");
        //                 return;
        //             }
        //
        //             // 그리드 데이터를 슬라이드 차트의 형식에 맞게 변환
        //             var transformedData = transformDataForChart(gridData);
        //
        //             // 각 차트의 레이아웃 정의
        //             var layout1 = getCartesianLayout("Column2D", "2D Column Chart - MultiSeries", transformedData.fields);
        //             var layout2 = getCartesianLayout("Line2D", "Line Chart with ItemRenderer", transformedData.fields,
        //                 ["CircleItemRenderer", "TriangleItemRenderer", "RectangleItemRenderer"] // 각 필드에 대한 itemRenderer 설정
        //             );
        //             var radarLayout = getRadarLayout(transformedData.fields);
        //
        //             // 슬라이드 차트에 적용할 레이아웃과 데이터 배열 설정
        //             var layoutSet = [layout1, layout2, radarLayout];
        //             var dataSet = [transformedData.data, transformedData.data, transformedData.data];
        //
        //             // 슬라이드 차트 레이아웃 및 데이터 설정
        //             chart.setSlideLayoutSet(layoutSet);
        //             chart.setSlideDataSet(dataSet);
        //         }
        //
        //         // tab2 차트
        //         function chartReadyHandler2(id, chartHolderId, gridData, comparisonType) {
        //             const chart = document.getElementById(id);
        //             if (!chart || !gridData) return;
        //
        //             const {data, fields} = transformDataForChartTab2(gridData, comparisonType);
        //
        //             const layout1 = getCartesianLayout("Column2D", "2D Column Chart", fields);
        //             const layout2 = getCartesianLayout("Line2D", "Line Chart", fields, ["CircleItemRenderer"]);
        //
        //             const layoutSet = [layout1, layout2];
        //             const dataSet = [data, data];
        //
        //             chart.setSlideLayoutSet(layoutSet);
        //             chart.setSlideDataSet(dataSet);
        //         }
        //
        //
        //         function updateChart(id, holderId) {
        //             var chart = document.getElementById(id);
        //             if (!chart) return;
        //
        //             const gridData = (id === 'chart1') ? theGrid3.itemsSource.items : theGrid4.itemsSource.items;
        //             const transformedData = (id === 'chart1') ? transformDataForChart(gridData) : transformDataForChartTab2(gridData);
        //             chartReadyHandler(id, holderId, transformedData);
        //         }
        //
        //
        //         // 차트 디자인 가이드 색상 코드
        //         const chartColors = [
        //             "#62b2fd",
        //             "#01dbab",
        //             "#ffa336",
        //             "#f99bab",
        //             "#55667f",
        //             "#82e8e8",
        //             "#909bff",
        //             "#f36f40"
        //         ];
        //
        //         // 차트마다 형식이 다르기 때문에 다른 레이아웃 함수를 만들어야 합니다.
        //         // 다른 유형의 차트 이용시, layout 함수 추가해서 사용하세요.
        //
        //         // Cartesian 차트 레이아웃 정의
        //         function getCartesianLayout(type, title, dataFields, itemRenderers = []) {
        //             var layout = "<rMateChart borderStyle='none'>"
        //                 + "<Options><Caption text='" + "' />" // 차트 제목
        //                 + "<SubCaption text='' textAlign='center' paddingBottom='20'/>" // 차트 부제목
        //                 + "<Legend defaultMouseOverAction='true' useVisibleCheck='true'/>" // 범례
        //                 + "<NumberFormatter id='numfmt' useThousandsSeparator='true'/></Options>"
        //                 + "<" + type + "Chart showDataTips='true'>"
        //                 + "<series>";
        //
        //             for (var i = 0; i < dataFields.length; ++i) {
        //                 var itemRenderer = itemRenderers[i] ? " itemRenderer='" + itemRenderers[i] + "'" : "";
        //                 var color = chartColors[i % chartColors.length]; // 색상을 순서대로 할당
        //
        //                 if (type === "Line2D") {
        //                     layout += "<" + type + "Series yField='" + dataFields[i] + "' displayName='" + dataFields[i] + "' " + itemRenderer + ">"
        //                         + "<showDataEffect><SeriesInterpolate duration='700'/></showDataEffect>"
        //                         + "<lineStroke><Stroke color='" + color + "'/></lineStroke>" // 선 색상 적용
        //                         + "</" + type + "Series>";
        //                 } else {
        //                     layout += "<" + type + "Series yField='" + dataFields[i] + "' displayName='" + dataFields[i] + "' " + itemRenderer + ">"
        //                         + "<showDataEffect><SeriesSlide direction='up' duration='700'/></showDataEffect>"
        //                         + "<fill>"
        //                         + "<SolidColor color='" + color + "'/>" // 색상 적용
        //                         + "</fill>"
        //                         + "</" + type + "Series>";
        //                 }
        //             }
        //
        //             layout += "</series>"
        //                 + "<horizontalAxis>"
        //                 + "<CategoryAxis categoryField='period'/>"
        //                 + "</horizontalAxis>"
        //                 + "<verticalAxis>"
        //                 + "<LinearAxis formatter='{numfmt}'/>"
        //                 + "</verticalAxis>"
        //                 + "</" + type + "Chart>"
        //                 + "</rMateChart>";
        //
        //             return layout;
        //         }
        //
        //
        //         // Radar 차트 레이아웃 정의
        //         function getRadarLayout(dataFields) {
        //             var radarLayout =
        //                 "<rMateChart borderStyle='none'>"
        //                 + "<Options>"
        //                 + "<Caption text='' />"
        //                 + "<Legend defaultMouseOverAction='true' useVisibleCheck='true'/>" // 범례
        //                 + "</Options>"
        //                 + "<NumberFormatter id='numfmt' useThousandsSeparator='true'/>"
        //                 + "<RadarChart type='polygon' paddingTop='20' paddingBottom='20' showDataTips='true'>"
        //                 + "<radialAxis>"
        //                 + "<LinearAxis id='rAxis' formatter='{numfmt}'/>"
        //                 + "</radialAxis>"
        //                 + "<radialAxisRenderers>"
        //                 + "<Axis2DRenderer axis='{rAxis}' horizontal='true' tickPlacement='outside' tickLength='4'>"
        //                 + "<axisStroke>"
        //                 + "<Stroke color='#555555'/>"
        //                 + "</axisStroke>"
        //                 + "</Axis2DRenderer>"
        //                 + "</radialAxisRenderers>"
        //                 + "<angularAxis>"
        //                 + "<CategoryAxis categoryField='period' displayName='Year'/>"
        //                 + "</angularAxis>"
        //                 + "<series>";
        //
        //             for (var i = 0; i < dataFields.length; ++i) {
        //                 var color = chartColors[i % chartColors.length]; // 색상 순서대로 적용
        //
        //                 radarLayout += "<RadarSeries field='" + dataFields[i] + "' displayName='" + dataFields[i] + "' fillLineArea='false'>"
        //                     + "<showDataEffect>"
        //                     + "<SeriesInterpolate duration='700'/>"
        //                     + "</showDataEffect>"
        //                     + "<lineStroke><Stroke color='" + color + "'/></lineStroke>" // 선 색상 적용
        //                     + "</RadarSeries>";
        //             }
        //
        //             radarLayout += "</series>"
        //                 + "</RadarChart>"
        //                 + "</rMateChart>";
        //
        //             return radarLayout;
        //         }
        //
        //         // 콤비네이션 차트 레이아웃
        //         function getCombinationChartLayout() {
        //             return `<rMateChart backgroundColor="#FFFFFF" borderStyle="none">
        //     <Options>
        //         <Caption text=""/>
        //         <Legend defaultMouseOverAction="true"/>
        //     </Options>
        //     <NumberFormatter id="numFmt" useThousandsSeparator="true"/>
        //     <Combination2DChart showDataTips="true">
        //         <horizontalAxis>
        //             <CategoryAxis categoryField="period"/>
        //         </horizontalAxis>
        //         <verticalAxis>
        //             <LinearAxis id="vAxis1" interval="500" formatter="{numFmt}"/>
        //         </verticalAxis>
        //         <series>
        //             <Column2DSet type="clustered">
        //                 <series>
        //                     <Column2DSeries yField="value1" displayName="2023" fill="#62b2fd">
        //                         <showDataEffect><SeriesInterpolate/></showDataEffect>
        //                     </Column2DSeries>
        //                     <Column2DSeries yField="value2" displayName="2024" fill="#01dbab">
        //                         <showDataEffect><SeriesInterpolate/></showDataEffect>
        //                     </Column2DSeries>
        //                 </series>
        //             </Column2DSet>
        //             <Line2DSeries yField="growth" displayName="증감율 (%)" itemRenderer="DiamondItemRenderer">
        //                 <lineStroke><Stroke color="#ffa336" weight="2"/></lineStroke>
        //                 <showDataEffect><SeriesInterpolate/></showDataEffect>
        //                 <verticalAxis>
        //                     <LinearAxis id="vAxis2" interval="10" maximum="100"/>
        //                 </verticalAxis>
        //             </Line2DSeries>
        //         </series>
        //         <verticalAxisRenderers>
        //             <Axis2DRenderer axis="{vAxis1}" showLine="true"/>
        //             <Axis2DRenderer axis="{vAxis2}" showLine="true" side="right"/>
        //         </verticalAxisRenderers>
        //     </Combination2DChart>
        // </rMateChart>`;
        //         }
        //
        //         function getLineChartLayout() {
        //             return `<rMateChart backgroundColor="#FFFFFF" borderStyle="none">
        //     <Options>
        //         <Caption text=""/>
        //         <Legend defaultMouseOverAction="true"/>
        //     </Options>
        //     <NumberFormatter id="numFmt" useThousandsSeparator="true"/>
        //     <Line2DChart showDataTips="true">
        //         <horizontalAxis>
        //             <CategoryAxis categoryField="period"/>
        //         </horizontalAxis>
        //         <verticalAxis>
        //             <LinearAxis id="vAxis1" interval="500" formatter="{numFmt}"/>
        //         </verticalAxis>
        //         <series>
        //             <Line2DSeries yField="value1" displayName="2023" itemRenderer="CircleItemRenderer">
        //                 <lineStroke><Stroke color="#62b2fd" weight="2"/></lineStroke>
        //                 <showDataEffect><SeriesInterpolate/></showDataEffect>
        //             </Line2DSeries>
        //             <Line2DSeries yField="value2" displayName="2024" itemRenderer="DiamondItemRenderer">
        //                 <lineStroke><Stroke color="#01dbab" weight="2"/></lineStroke>
        //                 <showDataEffect><SeriesInterpolate/></showDataEffect>
        //             </Line2DSeries>
        //         </series>
        //     </Line2DChart>
        // </rMateChart>`;
        //         }
        //
        //
        //         // 그리드 데이터를 차트에 맞게 변환 (tab3)
        //         function transformDataForChart(gridData) {
        //             // if (!gridData) {
        //             //     // console.error("그리드 데이터가 null 또는 정의되지 않았습니다.");
        //             //     return { fields: [], data: [] };
        //             // }
        //
        //             const dataFields = [];
        //             const chartData = [];
        //
        //             // 데이터를 변환하여 차트에 사용할 수 있도록 변환
        //             gridData.forEach(row => {
        //                 const dataItem = {period: row.period};
        //                 for (const key in row) {
        //                     if (key !== 'period' && key !== 'powernm') {
        //                         if (!dataFields.includes(key)) {
        //                             dataFields.push(key);
        //                         }
        //                         dataItem[key] = row[key];
        //                     }
        //                 }
        //                 chartData.push(dataItem);
        //             });
        //
        //             return {
        //                 fields: dataFields,
        //                 data: chartData
        //             };
        //         }
        //
        //         // 그리드 데이터를 차트에 맞게 변환 (tab2)
        //         function transformDataForChartTab2(gridData, comparisonType) {
        //             let chartData = [];
        //             let dataFields = [];
        //             let firstYear, secondYear;
        //
        //             switch (comparisonType) {
        //                 case "YoY":
        //                     // 연도 기반 데이터 처리
        //                     firstYear = document.getElementById("startDateTab2").value.split("-")[0];
        //                     secondYear = document.getElementById("endDateTab2").value.split("-")[0];
        //                     dataFields = [firstYear, secondYear];
        //
        //                     gridData.forEach(row => {
        //                         const dataItem = {
        //                             period: row.period || `${row.month}월`,
        //                             [firstYear]: parseFloat(row.value1) || 0,
        //                             [secondYear]: parseFloat(row.value2) || 0
        //                         };
        //                         chartData.push(dataItem);
        //                     });
        //                     break;
        //
        //                 case "QoQ":
        //                     // 분기별 데이터 처리
        //                     firstYear = document.getElementById("startDateTab2").value.split("-")[0];
        //                     secondYear = document.getElementById("endDateTab2").value.split("-")[0];
        //                     dataFields = [firstYear, secondYear];
        //
        //                     gridData.forEach(row => {
        //                         const quarter = `Q${row.quarter}`;  // 분기를 'Q1', 'Q2', 등으로 표시
        //                         const dataItem = {
        //                             period: quarter,
        //                             [firstYear]: parseFloat(row.value1) || 0,
        //                             [secondYear]: parseFloat(row.value2) || 0
        //                         };
        //                         chartData.push(dataItem);
        //                     });
        //                     break;
        //
        //                 case "MoM":
        //                     // 월 기반 데이터 처리
        //                     const month = document.getElementById("startDateTab2").value.split("-")[1]; // MoM의 경우 시작 월과 종료 월이 같다고 가정
        //                     dataFields = [month];
        //
        //                     gridData.forEach(row => {
        //                         const dataItem = {
        //                             period: `${row.month}월`,
        //                             [month]: parseFloat(row.value1) || 0
        //                         };
        //                         chartData.push(dataItem);
        //                     });
        //                     break;
        //
        //                 case "YTD":
        //                     // YTD일 경우, startYear와 endYear에서 누적 발전량을 가져옴
        //                     firstYear = document.getElementById("startDateTab2").value.split("-")[0];
        //                     secondYear = document.getElementById("endDateTab2").value.split("-")[0];
        //                     dataFields = [firstYear, secondYear]; // 두 연도의 누적 발전량 필드를 설정
        //
        //                     // 중복된 월을 제거하기 위한 Set 객체
        //                     let seenMonths = new Set();
        //
        //                     // 데이터를 월별로 그룹화 및 중복 월 제거
        //                     chartData = gridData.filter(row => {
        //                         if (seenMonths.has(row.month)) {
        //                             return false;  // 중복된 월이면 필터링하여 제외
        //                         }
        //                         seenMonths.add(row.month);  // 중복 방지를 위해 Set에 추가
        //                         return true;  // 중복이 아닌 경우 유지
        //                     }).map(row => ({
        //                         period: `${row.month}월`,  // 월별 데이터
        //                         [firstYear]: parseFloat(row.cumulative_start_year) || 0, // 첫 번째 연도의 누적 발전량
        //                         [secondYear]: parseFloat(row.cumulative_end_year) || 0  // 두 번째 연도의 누적 발전량
        //                     }));
        //                     break;
        //             }
        //
        //             return {data: chartData, fields: dataFields};
        //         }

        // 차트 끝 =================================================================================

        function showPopup(event) {
            const targetPopupId = event.target.getAttribute('data-popup');
            const modal = document.getElementById(targetPopupId).closest('.modal');
            const modalContent = document.getElementById(targetPopupId);

            // 모달과 콘텐츠를 표시
            modal.style.display = 'block';
            modalContent.style.display = 'block';

            // 애니메이션을 위한 클래스 추가
            requestAnimationFrame(() => {
                modal.classList.add('show');
                modalContent.classList.add('show');
            });

            // 만약 일자 목록 팝업을 연다면 날짜 데이터를 로드
            if (targetPopupId === 'popup2') {
                loadDateList();
            }
        }

        function showPopupWithDateList(tabSuffix) {
            const modal = document.getElementById('date-list-modal');
            const tableBody = document.getElementById('date-list-table-body');

            // 기존 리스트 초기화
            tableBody.innerHTML = '';

            // API 요청 URL 구성
            let query = `/api/gene/upload/regYMList?tab=${tabSuffix}`;

            fetch(query)
                .then(response => response.json())
                .then(data => {
                    if (data && data.length > 0) {
                        data.forEach((date) => {
                            // 각 데이터를 행으로 추가
                            const row = document.createElement('tr');

                            // 일자 열
                            const cellDate = document.createElement('td');
                            cellDate.textContent = date;
                            cellDate.onclick = function () {
                                onDateSelected(date, tabSuffix);
                            };
                            cellDate.style.cursor = 'pointer'; // 클릭 가능한 커서 스타일 추가
                            row.appendChild(cellDate);

                            // 행을 테이블에 추가
                            tableBody.appendChild(row);
                        });
                    } else {
                        const emptyRow = document.createElement('tr');
                        const emptyCell = document.createElement('td');
                        emptyCell.textContent = '일자 목록이 없습니다.';
                        emptyRow.appendChild(emptyCell);
                        tableBody.appendChild(emptyRow);
                    }

                    // 모달 표시
                    modal.style.display = 'block';
                    requestAnimationFrame(() => {
                        modal.classList.add('show');
                    });
                })
                .catch(error => {
                    console.error('Error loading date list:', error);
                    const errorRow = document.createElement('tr');
                    const errorCell = document.createElement('td');
                    errorCell.textContent = '일자 목록을 불러오는 중 오류가 발생했습니다.';
                    errorRow.appendChild(errorCell);
                    tableBody.appendChild(errorRow);

                    // 모달 표시
                    modal.style.display = 'block';
                    requestAnimationFrame(() => {
                        modal.classList.add('show');
                    });
                });
        }

        function onDateSelected(date, tabSuffix) {
            // 선택된 값은 "YYYY-MM" 형식
            const [year, month] = date.split('-');

            // 월의 첫 번째 날 (1일)
            const startDate = new Date(year, month - 1, 1);

            // 월의 마지막 날
            const endDate = new Date(year, month, 0); // 다음 달의 0번째 날은 현재 달의 마지막 날

            // 날짜를 'YYYY-MM-DD' 형식으로 변환
            const formatDate = date => {
                const yyyy = date.getFullYear();
                const mm = String(date.getMonth() + 1).padStart(2, '0'); // 월을 2자리로
                const dd = String(date.getDate()).padStart(2, '0'); // 일을 2자리로
                return `${yyyy}-${mm}-${dd}`;
            };

            // HTML의 날짜 입력 필드에 값을 설정
            document.getElementById('date1_' + tabSuffix).value = formatDate(startDate);
            document.getElementById('date2_' + tabSuffix).value = formatDate(endDate);

            closePopup();
        }

        function closePopup() {
            const modal = document.querySelector('.modal.show');  // 현재 표시되고 있는 모달을 선택
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);  // 애니메이션 종료 후 display를 none으로 설정
            }
        }

        // 일자목록 함수
        function loadDateList() {
            const modalContent = document.getElementById('date-list-content');

            // API 요청 URL 구성
            fetch('/api/gene/upload/regYMList')
                .then(response => response.json())
                .then(data => {
                    // 기존 리스트 초기화
                    modalContent.innerHTML = '';

                    if (data.length > 0) {
                        const ul = document.createElement('ul');
                        ul.classList.add('date-list');

                        data.forEach(date => {
                            const li = document.createElement('li');
                            li.textContent = date;
                            li.onclick = function () {
                                onDateSelected(date);
                            };
                            ul.appendChild(li);
                        });

                        modalContent.appendChild(ul);
                    } else {
                        const p = document.createElement('p');
                        p.textContent = '일자 목록이 없습니다.';
                        modalContent.appendChild(p);
                    }
                })
                .catch(error => {
                    console.error('Error loading date list:', error);
                    modalContent.innerHTML = '<p>일자 목록을 불러오는 중 오류가 발생했습니다.</p>';
                });
        }

        // 날짜 설정 함수
        function setStartAndEndDate(dates) {
            if (!Array.isArray(dates) || dates.length === 0) {
                // console.error("No dates available to set or dates is not an array.");
                return;
            }

            // 모든 날짜 중 가장 빠른 날짜와 가장 늦은 날짜를 찾음
            const minDate = new Date(Math.min(...dates.map(date => new Date(date))));
            const maxDate = new Date(Math.max(...dates.map(date => new Date(date))));

            // 날짜를 'YYYY-MM-DD' 형식으로 변환
            const formatDate = date => date.toISOString().slice(0, 10);

            // HTML의 날짜 입력 필드에 값을 설정
            document.getElementById('date1_tab1').value = formatDate(minDate);
            document.getElementById('date2_tab1').value = formatDate(maxDate);
            document.getElementById('date1_tab2').value = formatDate(minDate);
            document.getElementById('date2_tab2').value = formatDate(maxDate);
        }

        // 데이터 로드 함수
        function loadData() {
            $.ajax({
                url: '/api/gene/upload/read',
                type: 'GET',
                success: function (response) {
                    if (response && response.length > 0) {  // success와 data 대신에 response 배열의 길이를 확인
                        bindGridData(response);  // 직접 response를 데이터로 사용
                        const dates = response.map(item => item.standdt);  // 날짜 데이터를 반환
                        setStartAndEndDate(dates);
                    } else {

                        // 서버에서 응답된 데이터 확인을 위해 로깅
                        console.log("Error or unexpected structure in response:", response);

                        var errorMessage = response.message || 'No data returned';
                        // alert('데이터 로드 실패: ' + errorMessage);
                        // $("#emptyMessage").show();  // 서버 통신 오류 시 빈 메시지 표시
                    }

                },
                error: function () {
                    // alert('서버 통신 오류');
                    var errorMsg = xhr.responseText || '서버 통신 오류';
                    alert(errorMsg);
                }
            });
        }

        // 현재 날짜를 설정하는 함수
        function setCurrentDate() {
            var today = new Date();
            var dd = String(today.getDate()).padStart(2, '0');
            var mm = String(today.getMonth() + 1).padStart(2, '0'); // 1월은 0!
            var yyyy = today.getFullYear();
            today = yyyy + '-' + mm + '-' + dd;
            document.getElementById('date6').value = today;
        }

        // 발전기코드 옵션 동적 생성
        function loadPowerIds() {
            fetch('/api/gene/upload/powerids')
                .then(response => response.json())
                .then(powerIds => {
                    // 각 탭별 select element의 ID 배열
                    const selectIds = ['select1_tab1', 'select1_tab2'];
                    selectIds.forEach(selectId => {
                        const selectElement = document.getElementById(selectId);
                        if (selectElement) {
                            selectElement.innerHTML = ''; // 기존 옵션들을 지웁니다.
                            selectElement.appendChild(new Option('전체', 'all')); // '전체' 옵션을 추가합니다.
                            powerIds.forEach(id => {
                                selectElement.appendChild(new Option(id, id)); // 각 ID에 대한 옵션을 추가합니다.
                            });
                        }
                    });
                })
                .catch(error => console.error('Error loading power IDs:', error));
        }

        // 토글 기능
        // 초기 컬럼 숨기기 설정
        function toggleColumns(grid, show) {
            for (let i = 4; i <= 22; i++) {
                let column = grid.columns.getColumn('mevalue' + (i < 10 ? '0' + i : i));
                if (column) column.visible = show;
            }
        }

        // 초기에 04시~22시 컬럼을 숨김
        function initializeColumnToggle(grid) {

            // 상태를 추적하기 위한 변수
            let columnsVisible = false;

            toggleColumns(grid, columnsVisible);

            grid.formatItem.addHandler(function (sender, e) {
                if (e.panel.cellType === wijmo.grid.CellType.ColumnHeader && e.col < sender.columns.length) {
                    if (e.cell.textContent.trim() === '...') {
                        e.cell.style.cursor = 'pointer'; // 마우스 오버 시 포인터 변경
                        e.cell.onclick = function (event) {
                            event.stopPropagation(); // 이벤트 전파 막기

                            // 토글 상태에 따라 컬럼을 펼치거나 접음
                            columnsVisible = !columnsVisible;
                            toggleColumns(grid, columnsVisible);

                            // '...' 컬럼의 가시성 토글
                            grid.columns.getColumn('toggle').visible = !columnsVisible;
                        };
                    }
                }
            });

            document.addEventListener('click', function (event) {
                // '...' 컬럼 외의 다른 헤더를 클릭했을 때
                if (!event.target.matches('.wj-colheaders .wj-cell')) return;
                var headerText = event.target.textContent;
                if (headerText !== '...' && grid.columns.getColumn('toggle').visible === false) {
                    toggleColumns(grid, false); // 컬럼을 다시 접음
                    grid.columns.getColumn('toggle').visible = true; // '...' 컬럼을 다시 표시
                }
            });
        }


        // 그리드에 데이터 바인딩
        function bindGridData(data) {
            // NO에 1부터 시작하는 번호 설정
            data.forEach((item, index) => {
                item.rownum = index + 1; // 1부터 시작하는 번호 설정
                calculateSumForRow(item); // 각 행의 합계를 계산하여 반영
            });

            // `tab1`의 그리드 데이터 바인딩
            viewdata1 = new wijmo.collections.CollectionView(data);
            initializeGrid(viewdata1);

            // 수정: trackChanges 옵션을 활성화하여 viewdata2를 초기화
            viewdata2 = new wijmo.collections.CollectionView(data, {trackChanges: true}); // 다른 데이터를 사용하는 경우 이 부분을 수정
            initializeGrid2(viewdata2);
        }


        $(document).ready(function (e) {

            document.getElementById('searchButton1').addEventListener('click', function (event) {
                synchronizeTabs('tab1', 'tab2');
                search(event);
            });

            document.getElementById('searchButton2').addEventListener('click', function (event) {
                synchronizeTabs('tab2', 'tab1');
                search(event);
            });

            // 검색 버튼 클릭 시 Tab 1과 Tab 2의 값을 동기화하는 함수
            function synchronizeTabs(sourceTab, targetTab) {
                document.getElementById('date1_' + targetTab).value = document.getElementById('date1_' + sourceTab).value;
                document.getElementById('date2_' + targetTab).value = document.getElementById('date2_' + sourceTab).value;
                document.getElementById('select1_' + targetTab).value = document.getElementById('select1_' + sourceTab).value;
            }

            // 검색
            function search(event) {
                const buttonId = event.target.id;
                const tabSuffix = buttonId === "searchButton1" ? "tab1" : "tab2";

                const startDate = document.getElementById('date1_' + tabSuffix).value;
                const endDate = document.getElementById('date2_' + tabSuffix).value;
                const powerId = document.getElementById('select1_' + tabSuffix).value;

                // 필수 조건 : startdt와 enddt가 모두 있어야 함
                if (!startDate || !endDate) {
                    Alert.alert('', '시작일과 종료일을 모두 선택해 주세요.');
                    return;
                }

                // API 요청 URL 구성
                let query = `/api/gene/upload/search?startdt=${startDate}&enddt=${endDate}`;
                if (powerId !== 'all') {
                    query += `&powerid=${powerId}`;
                }

                fetch(query)
                    .then(response => response.json())
                    .then(data => {
                        if (data.length > 0) {
                            bindGridData(data); // 데이터를 그리드에 바인딩하는 함수 호출
                        } else {
                            console.log("No data found for the selected filters.");
                            Alert.alert("", "선택한 조건에 해당하는 데이터가 없습니다.");
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching search results:', error);
                        Alert.alert('', 'Search failed. 다시 시도해 주세요.');
                    });
            }


            //  select 바뀌면 hidden input 변경
            function updateSelect(selectId, hiddenInputId) {
                var selectElement = document.getElementById(selectId);
                document.getElementById(hiddenInputId).value = selectElement.options[selectElement.selectedIndex].text;
            }

            // select 아이디에 따라 히든 input 설정
            const selects = [
                {selectId: 'spworkcd', hiddenInputId: 'spworknm'},
                {selectId: 'spcompcd', hiddenInputId: 'spcompnm'},
                {selectId: 'spplancd', hiddenInputId: 'spplannm'}
            ];
            selects.forEach(item => updateSelect(item.selectId, item.hiddenInputId));


            document.getElementById('btnSave').addEventListener('click', function () {
                // 변경 사항이 있는지 확인
                if (viewdata2.itemsEdited.length === 0 && viewdata2.itemsAdded.length === 0 && viewdata2.itemsRemoved.length === 0) {
                    Alert.alert('', '수정사항이 없습니다.');
                } else {
                    handleUpdate(); // 변경 사항이 있는 경우에만 업데이트 함수 호출
                }
            });

        });


        // 엑셀 파일 저장
        function uploadExcelAndLoadData(event) {
            const formData = new FormData(); // 새로운 FormData 생성
            const fileInput = document.getElementById('fileInput'); // 파일 입력 필드의 ID
            const files = fileInput.files;

            // 첨부 파일이 두 개 이상이면 경고창 표시
            if (files.length > 1) {
                Alert.alert('', '파일은 한 개만 첨부할 수 있습니다.');
                return;
            }

            // 드래그 앤 드롭으로 추가된 파일도 formData에 추가
            if (uploadedFiles.length > 0) {
                uploadedFiles.forEach(file => {
                    formData.append('upload_file', file);
                });
            }

            // 파일 선택 버튼으로 추가된 파일을 formData에 추가
            if (files.length > 0) {
                for (let i = 0; i < files.length; i++) {
                    formData.append('upload_file', files[i]);
                }
            }

            if (uploadedFiles.length === 0 && files.length === 0) {
                Alert.alert('', '파일을 첨부해 주세요.');
                return;
            }

            // 추가적인 데이터 필드 설정
            formData.append('spworkcd', document.getElementById('spworkcd').value);
            formData.append('spworknm', document.getElementById('spworknm').value);
            formData.append('spcompcd', document.getElementById('spcompcd').value);
            formData.append('spcompnm', document.getElementById('spcompnm').value);
            formData.append('spplancd', document.getElementById('spplancd').value);
            formData.append('spplannm', document.getElementById('spplannm').value);
            formData.append('date6', document.getElementById('date6').value);

            $.ajax({
                url: '/api/gene/upload/upload_save',
                type: 'POST',
                data: formData,
                processData: false, // 기본적으로 jQuery는 데이터를 문자열로 변환하려고 하므로 이를 비활성화
                contentType: false,  // 기본적으로 jQuery는 Content-Type을 설정하려고 하므로 이를 비활성화
                success: function (response) {
                    if (response.success) {
                        // console.log(response.data); // 서버에서 받은 날짜 데이터를 콘솔에 출력하여 확인
                        setStartAndEndDate(response.data); // 이 날짜를 바탕으로 시작일과 종료일 설정
                        Alert.alert('', '파일이 성공적으로 업로드되었습니다.', function () {
                            location.reload();  // 사용자가 확인 버튼을 누르면 페이지 새로 고침
                        });
                    } else {
                        Alert.alert('업로드 실패', response.message);
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    Alert.alert('', '에러가 발생하였습니다.');
                }
            });
        }

        // 수정
        function handleUpdate() {
            Alert.confirm(
                '확인',
                '수정하시겠습니까?',
                function () { // 확인 버튼 클릭 시 실행할 함수
                    var edits = viewdata2.itemsEdited.map(item => ({...item, type: 'edit'}));
                    var adds = viewdata2.itemsAdded.map(item => ({...item, type: 'add'}));
                    var deletes = viewdata2.itemsRemoved.map(item => ({...item, type: 'delete'}));

                    var changes = edits.concat(adds).concat(deletes);

                    if (changes.length > 0) {
                        $.ajax({
                            url: '/api/gene/upload/update',
                            type: 'PATCH',
                            contentType: 'application/json',
                            data: JSON.stringify(changes),
                            success: function (response) {
                                if (response.success) {
                                    Alert.alert('', '수정되었습니다.', function () {
                                        location.reload();
                                    }); // 수정 완료 후 알림창
                                    viewdata2.commitChanges();
                                    // location.reload();
                                    // loadData();
                                } else {
                                    Alert.alert('수정 실패', response.message);
                                }
                            },
                            error: function (xhr, status, error) {
                                Alert.alert('수정 실패', '서버 에러');
                            }
                        });
                    } else {
                        Alert.alert('', '변경된 내용이 없습니다.');
                    }
                },
                function () {
                    // 취소 시 실행할 로직이 있을 경우 여기에 추가
                }
            );
        }

        // function updateGrid(data) {
        //     viewdata.sourceCollection = data; // wijmo CollectionView를 사용하는 경우
        //     theGrid.refresh(); // wijmo 그리드 업데이트
        // }

        // document.querySelector('.popup-button button').addEventListener('click', function() {
        //     uploadExcelAndLoadData(); // 업로드 및 데이터 로딩 함수 호출
        // });


        /* Wijmo FlexGrid를 사용하고 있다면, getChanges 메서드는 기본적으로 제공되지 않는다.
        대신 변경 사항을 관리하고 있는 CollectionView의 trackChanges 기능을 사용해야 할 수도 있다.
        이 기능을 활성화하면 수정, 추가 또는 삭제된 아이템을 추적할 수 있다. */

        /*// CollectionView 생성 시 변경 사항 추적 활성화:

        // 데이터가 있는 배열로 CollectionView를 생성합니다.
        var view = new wijmo.collections.CollectionView(data, {
            trackChanges: true
        });

        // 그리드에 데이터 소스로 설정합니다.
        var theGrid2 = new wijmo.grid.FlexGrid('#theGrid2', {
            itemsSource: view
        });


        // 변경된 항목 접근:
        var changes = {
            added: view.itemsAdded,
            removed: view.itemsRemoved,
            edited: view.itemsEdited
        };*/


        // 삭제 버튼 클릭 이벤트 핸들러
        document.getElementById('btnDelete').addEventListener('click', function () {
            var selectedItem = theGrid2.collectionView.currentItem;
            if (selectedItem) {
                // 선택된 항목의 등록일자를 가져옴
                var indatem = selectedItem.indatem;

                // 삭제 확인 모달을 띄우고 사용자 확인 후 삭제 처리
                Alert.confirm('삭제 확인', `다음 데이터를 삭제하시겠습니까?<br><br>등록일자: ${indatem}`, function () {
                    confirmDelete(indatem);
                });
            } else {
                Alert.alert('알림', '선택된 행이 없습니다.');
            }
        });

        // 실제 삭제 처리를 수행하는 함수
        function confirmDelete(indatem) {
            $.ajax({
                url: `/api/gene/upload/delete?indatem=${indatem}`,
                type: 'DELETE',
                success: function (response) {
                    if (response.success) {
                        const formattedMessage = response.message.replace(' 데이터가 삭제되었습니다.', '<br>데이터가 삭제되었습니다.');
                        Alert.alert('알림', formattedMessage, function () {
                            location.reload();
                        });
                    } else {
                        Alert.alert('삭제 실패', response.message);
                    }
                },
                error: function (xhr, status, error) {
                    var errorMessage = xhr.status + ': ' + xhr.statusText;
                    Alert.alert('서버 에러', errorMessage);
                }
            });
        }

        // 합계 계산
        function calculateSumForRow(item) {
            let sum = 0;
            for (let i = 1; i <= 24; i++) {
                const field = `mevalue${i < 10 ? '0' + i : i}`;
                sum += parseFloat(item[field]) || 0; // 각 시간을 합산 (NaN을 피하기 위해 0으로 처리)
            }
            item.mevaluet = sum; // 합계를 합계 컬럼에 반영
        }

        //     ================================================================================================
        //     ================================================================================================

        //  그리드 컬럼 생성 (tab3)
        // function buildGridColumnsTab1(data) {
        //     const columns = [
        //         {binding: 'period', header: '기간', width: 180, align: 'center'},
        //     ];
        //
        //     // 모든 powernm(발전기명)을 확인하여 열을 동적으로 생성
        //     const powerNames = [...new Set(data.map(item => item.powernm))];
        //     powerNames.forEach(powerName => {
        //         columns.push({
        //             binding: powerName,
        //             header: powerName,
        //             width: "*",
        //             align: 'right',
        //             format: 'n0'
        //         });
        //     });
        //
        //     return columns;
        // }

        //  그리드 컬럼 생성 (tab4)
        // function buildGridColumnsTab2(data, comparisonType) {
        //     const columns = [
        //         {binding: 'period', header: '기간', width: 180, align: 'center'},
        //     ];
        //
        //     const firstYear = document.getElementById("startDateTab2").value;
        //     const secondYear = document.getElementById("endDateTab2").value;
        //
        //     if (comparisonType === "YTD") {
        //         columns.push(
        //             {
        //                 binding: 'cumulative_start_year',
        //                 header: `${firstYear}년`,
        //                 width: "*",
        //                 align: 'right',
        //                 format: 'n0'
        //             },
        //             {binding: 'cumulative_end_year', header: `${secondYear}년`, width: "*", align: 'right', format: 'n0'}
        //         );
        //     } else {
        //         columns.push(
        //             {binding: 'value1', header: `${firstYear}년`, width: "*", align: 'right', format: 'n0'},
        //             {binding: 'value2', header: `${secondYear}년`, width: "*", align: 'right', format: 'n0'}
        //         );
        //     }
        //
        //     return columns;
        // }

        // 데이터 변환 + 그리드 업데이트 (tab3)
        // function transformDataForGridTab1(data, periodType) {
        //     const gridData = {};
        //
        //     data.forEach(row => {
        //         const period = row.period ? row.period.toString() : ''; // 기간 데이터가 없는 경우 빈 문자열로 설정
        //         const powernm = row.powernm ? row.powernm.toString() : ''; // 발전기명이 없는 경우 빈 문자열로 설정
        //
        //         if (periodType === 'hourly') {
        //             // 시간별 데이터를 처리하는 로직
        //             for (let i = 1; i <= 24; i++) {
        //                 const hourKey = `hour${i.toString().padStart(2, '0')}`;
        //                 if (row[hourKey] !== undefined) {
        //                     const periodWithHour = `${period} ${i.toString().padStart(2, '0')}시`;
        //                     if (!gridData[periodWithHour]) {
        //                         gridData[periodWithHour] = {period: periodWithHour};
        //                     }
        //                     gridData[periodWithHour][powernm] = row[hourKey] ? parseFloat(row[hourKey].toString().replace(/,/g, '')) : 0;
        //                 }
        //             }
        //         } else {
        //             // 월별, 분기별, 반기별, 연도별 데이터를 처리하는 로직
        //             if (!gridData[period]) {
        //                 gridData[period] = {period: period};
        //             }
        //             Object.keys(row).forEach(key => {
        //                 if (key !== 'period' && key !== 'powernm') {
        //                     // 쉼표 제거 후 숫자로 변환
        //                     gridData[period][powernm] = row[key] ? parseFloat(row[key].toString().replace(/,/g, '')) : 0;
        //                 }
        //             });
        //         }
        //     });
        //
        //     return Object.values(gridData);
        // }

        // 데이터 변환 + 그리드 업데이트 (tab4)
        // function transformDataForGridTab2(data, comparisonType) {
        //     if (comparisonType === "YTD") {
        //         const months = [...new Set(data.map(item => parseInt(item.month)))].sort((a, b) => a - b);
        //
        //         const result = months.map(month => {
        //             const monthData = data.find(item => parseInt(item.month) === month);
        //             return {
        //                 period: `${month}월`,
        //                 cumulative_start_year: monthData ? parseFloat(monthData.cumulative_start_year) || 0 : 0,
        //                 cumulative_end_year: monthData ? parseFloat(monthData.cumulative_end_year) || 0 : 0
        //             };
        //         });
        //         return result;
        //     } else {
        //         return data.map(row => {
        //             const period = (comparisonType === "QoQ") ? `Q${row.quarter}` : `${row.month}월`;
        //             return {
        //                 period: period,
        //                 value1: parseFloat(row.value1) || 0,
        //                 value2: parseFloat(row.value2) || 0
        //             };
        //         });
        //     }
        // }

        // 그리드 생성
        // function updateGridTab1(grid, data, periodType) {
        //     // console.log("Updating grid with data:", data); // 디버깅을 위한 로그 추가
        //     // console.log("Period Type:", periodType); // periodType이 올바르게 전달되었는지 확인
        //
        //     const columns = buildGridColumnsTab1(data); // 그리드의 컬럼을 동적으로 생성
        //     const transformedData = transformDataForGridTab1(data, periodType); // 데이터를 그리드에 맞게 변환
        //
        //     // console.log("Transformed Data:", transformedData); // 변환된 데이터 확인!
        //
        //     // 그리드를 초기화하고 데이터를 설정
        //     grid.initialize({
        //         autoGenerateColumns: false,
        //         columns: columns,
        //         itemsSource: new wijmo.collections.CollectionView(transformedData), // 변환된 데이터를 소스로 설정
        //         showMarquee: true,
        //         isReadOnly: true,
        //         headersVisibility: wijmo.grid.HeadersVisibility.Column // 컬럼 헤더만 보이도록 설정 (행 헤더는 숨김)
        //     });
        //
        //     // 이전 데이터를 완전히 초기화 후 새 데이터 적용
        //     grid.itemsSource = new wijmo.collections.CollectionView(transformedData);
        //
        //
        //     // 헤더 중앙 정렬을 위해 formatItem 이벤트 핸들러 추가
        //     grid.formatItem.addHandler((s, e) => {
        //         if (e.panel === s.columnHeaders) {
        //             e.cell.style.textAlign = 'center';
        //         }
        //     });
        //
        //     // 그리드 데이터를 차트에 전달하여 슬라이드 차트를 업데이트
        //     chartReadyHandler("chart1", "chartHolder1", transformedData);
        // }

        // =======================================================================================
        // 검색 기능 미완

        // 검색
        // function searchDataTab1() {
        //     const periodType = document.getElementById("periodType").value;
        //     let startDate, endDate, startHour, endHour;
        //     const generator = document.getElementById("genename").value; // 발전기명 선택
        //
        //     // console.log("Selected powerid:", document.getElementById("genename").value);
        //
        //     if (periodType === "hourly") {
        //         startDate = document.getElementById("startDate").value;
        //         startHour = document.getElementById("startHour").value;
        //         endHour = document.getElementById("endHour").value;
        //         endDate = startDate; // 시간별 조회에서는 시작 날짜와 종료 날짜가 동일
        //
        //     } else if (periodType === "monthly") {
        //         startDate = document.getElementById("startDate").value + "-01";
        //         let endDateInput = document.getElementById("endDate").value;
        //         let [endYear, endMonth] = endDateInput.split('-');
        //         let lastDay = new Date(endYear, endMonth, 0).getDate();
        //         endDate = `${endDateInput}-${lastDay}`;
        //
        //     } else if (periodType === "quarterly") {
        //         const startQuarter = document.getElementById("startQuarter").value;
        //         const endQuarter = document.getElementById("endQuarter").value;
        //         const selectedYear = document.getElementById("yearSelectTab1").value;
        //
        //         // 분기 값을 연도와 함께 날짜 범위로 변환
        //         [startDate, endDate] = convertQuarterToDateRange(startQuarter, endQuarter, selectedYear);
        //
        //     } else if (periodType === "halfyearly") {
        //         const startHalf = document.getElementById("startHalf").value;
        //         const endHalf = document.getElementById("endHalf").value;
        //         const selectedYear = document.getElementById("yearSelectTab1").value;
        //
        //         // 반기 값을 연도와 함께 날짜 범위로 변환
        //         [startDate, endDate] = convertHalfYearToDateRange(startHalf, endHalf, selectedYear);
        //
        //     } else if (periodType === "yearly") {
        //         const selectedYear = document.getElementById("yearSelectTab1").value;
        //         startDate = `${selectedYear}-01-01`;
        //         endDate = `${selectedYear}-12-31`;
        //     }
        //
        //     let query = `/api/gene/upload/periodSearch?periodType=${periodType}&startdt=${startDate}&enddt=${endDate}&powerid=${generator}`;
        //
        //     if (periodType === "hourly") {
        //         query += `&startHour=${startHour}&endHour=${endHour}`;
        //     }
        //
        //     fetch(query)
        //         .then(response => response.json())
        //         .then(data => {
        //             if (data.length === 0) {
        //                 Alert.alert("", "데이터가 존재하지 않습니다.");
        //             } else {
        //                 updateGridTab1(theGrid3, data, periodType); // periodType 전달
        //             }
        //         })
        //         .catch(error => console.error('Error fetching search data:', error));
        // }

        // 분기별 기간을 날짜 범위로 변환
        function convertQuarterToDateRange(startQuarter, endQuarter, year) {
            const quarterToMonth = {
                Q1: ['01', '03'],
                Q2: ['04', '06'],
                Q3: ['07', '09'],
                Q4: ['10', '12']
            };

            const startMonth = quarterToMonth[startQuarter][0];
            const endMonth = quarterToMonth[endQuarter][1];

            const startDate = `${year}-${startMonth}-01`;
            const endDate = new Date(year, parseInt(endMonth), 0).toISOString().split('T')[0]; // 해당 월의 마지막 날짜 계산

            return [startDate, endDate];
        }

        // 반기별 기간을 날짜 범위로 변환
        function convertHalfYearToDateRange(startHalf, endHalf, year) {
            const halfToMonth = {
                H1: ['01', '06'],  // 상반기: 1월 ~ 6월
                H2: ['07', '12']   // 하반기: 7월 ~ 12월
            };

            const startMonth = halfToMonth[startHalf][0];
            const endMonth = halfToMonth[endHalf][1];

            const startDate = `${year}-${startMonth}-01`;
            const endDate = new Date(year, parseInt(endMonth), 0).toISOString().split('T')[0]; // 해당 월의 마지막 날짜 계산

            return [startDate, endDate];
        }


        // ===================================================================================================


        // 월별 데이터
        // function loadMonthlyData() {
        //     const generator = 'all';  // 기본적으로 전체 발전기명에 대해 로드
        //
        //     // 최소/최대 날짜를 서버에서 받아오는 API 호출
        //     fetch('/api/gene/upload/dateRange')
        //         .then(response => {
        //             if (!response.ok) {
        //                 throw new Error(`HTTP error! status: ${response.status}`);
        //             }
        //             return response.json();
        //         })
        //         .then(dateRange => {
        //             const startDate = dateRange.startdt;  // 서버에서 받은 최소 날짜
        //             const endDate = dateRange.enddt;      // 서버에서 받은 최대 날짜
        //
        //             let query = `/api/gene/upload/periodSearch?periodType=monthly&startdt=${startDate}&enddt=${endDate}&powerid=${generator}`;
        //
        //             return fetch(query);
        //         })
        //         .then(response => {
        //             if (!response.ok) {
        //                 throw new Error(`HTTP error! status: ${response.status}`);
        //             }
        //             return response.json();
        //         })
        //         .then(data => {
        //             // console.log('Received data:', data); // 데이터 확인
        //             // 서버로부터 데이터를 받아서 처리
        //             if (!data || data.length === 0) {
        //                 // console.warn('No data received.');
        //                 // Alert.alert("", "데이터가 존재하지 않습니다.\n발전량 업로드 페이지를 확인해 주세요.")
        //                 return;
        //             }
        //
        //             chartReadyHandler("chart1", "chartHolder1", data); // 차트 업데이트
        //             updateGridTab1(theGrid3, data); // 그리드 업데이트
        //         })
        //         .catch(error => console.error('Error fetching initial monthly data:', error));
        // }


        // 발전기명
        function loadGeneratorNames(callback) {
            fetch('/api/gene/upload/generatornames')
                .then(response => response.json())
                .then(generatorNames => {
                    // Tab1의 발전기명 선택 요소
                    const selectElementTab1 = document.getElementById('genename');
                    // Tab2의 발전기명 선택 요소
                    const selectElementTab2 = document.getElementById('genename2');

                    // 두 요소가 존재하는지 확인한 후에 발전기명 옵션 추가
                    if (selectElementTab1) {
                        selectElementTab1.innerHTML = '<option value="all">전체</option>';
                        generatorNames.forEach(name => {
                            selectElementTab1.innerHTML += `<option value="${name}">${name}</option>`;
                        });
                    }

                    // Tab2의 발전기명 선택 요소에는 `all` 옵션을 추가하지 않음
                    if (selectElementTab2) {
                        selectElementTab2.innerHTML = '';  // Tab2에서는 '전체' 옵션을 제외
                        generatorNames.forEach(name => {
                            selectElementTab2.innerHTML += `<option value="${name}">${name}</option>`;
                        });
                    }

                    // 콜백 함수 호출
                    if (callback) callback();
                })
                .catch(error => console.error('Error loading generator names:', error));
        }

        // 조회기간 변동 함수 -> 입력 필드를 동적으로 업데이트
        function updatePeriodInputs() {
            const periodType = document.getElementById("periodType").value;
            const selectedYear = document.getElementById("yearSelectTab1").value;
            const dateBoxContainer = document.getElementById("dateBoxContainer").closest('dl');
            const yearSelectContainer = Array.from(document.querySelectorAll('dl')).find(dl => {
                const dt = dl.querySelector('dt');
                return dt && dt.textContent.includes("조회연도");
            });

            // 모든 기간 유형에 대해 초기화
            if (yearSelectContainer) yearSelectContainer.style.display = "block";
            dateBoxContainer.style.display = "block";

            if (periodType === "yearly") {
                // 연도별 선택 시 조회기간 필드를 숨기고 조회연도 필드를 보이게 함
                dateBoxContainer.style.display = "none";
                if (yearSelectContainer) yearSelectContainer.style.display = "block";
            } else if (periodType === "hourly" || periodType === "monthly") {
                // 시간별, 월별 선택 시 조회연도 필드 숨김
                if (yearSelectContainer) yearSelectContainer.style.display = "none";

                const startDateContainer = document.getElementById("startDateContainer");
                const endDateContainer = document.getElementById("endDateContainer");

                if (periodType === "hourly") {
                    const currentDate = new Date();
                    const defaultMonth = (currentDate.getMonth() + 1).toString().padStart(2, '0');
                    const defaultDay = currentDate.getDate().toString().padStart(2, '0');

                    startDateContainer.innerHTML = `<input type="date" id="startDate" name="startDate" value="${currentDate.getFullYear()}-${defaultMonth}-${defaultDay}">`;
                    endDateContainer.innerHTML = `
        <select id="startHour" name="startHour" style="width: 60px;">${generateHourOptions()}</select>
        -
        <select id="endHour" name="endHour" style="width: 60px;">${generateHourOptions(true)}</select>
    `;
                } else if (periodType === "monthly") {
                    const currentYear = new Date().getFullYear();
                    startDateContainer.innerHTML = `<input type="month" id="startDate" name="startDate" value="${currentYear}-01">`;
                    endDateContainer.innerHTML = `<input type="month" id="endDate" name="endDate" value="${currentYear}-12">`;
                }
            } else {
                // 분기별, 반기별 선택 시
                const startDateContainer = document.getElementById("startDateContainer");
                const endDateContainer = document.getElementById("endDateContainer");

                if (periodType === "quarterly") {
                    const options = `
        <option value="Q1">1분기</option>
        <option value="Q2">2분기</option>
        <option value="Q3">3분기</option>
        <option value="Q4">4분기</option>
    `;
                    startDateContainer.innerHTML = `<select id="startQuarter">${options}</select>`;
                    endDateContainer.innerHTML = `<select id="endQuarter">${options}</select>`;
                } else if (periodType === "halfyearly") {
                    const options = `
        <option value="H1">상반기</option>
        <option value="H2">하반기</option>
    `;
                    startDateContainer.innerHTML = `<select id="startHalf">${options}</select>`;
                    endDateContainer.innerHTML = `<select id="endHalf">${options}</select>`;
                }
            }

            // 레이아웃 조정을 위해 부모 컨테이너 갱신
            dateBoxContainer.closest('.search-wrap').style.display = 'flex';
            dateBoxContainer.closest('.search-wrap').style.flexWrap = 'wrap';
        }


        // 조회연도 변경 시 조회기간의 연도도 동기화
        function updateYearInPeriod() {
            const selectedYear = document.getElementById("yearSelectTab1").value;

            const startDateInput = document.getElementById("startDate");
            const endDateInput = document.getElementById("endDate");

            if (startDateInput && endDateInput) {
                startDateInput.value = `${selectedYear}-01`;
                endDateInput.value = `${selectedYear}-12`;
            }
        }

        // 조회연도 선택 요소에 이벤트 리스너 추가
        // document.getElementById("yearSelectTab1").addEventListener("change", function () {
        //     updateYearInPeriod(); // 조회연도 변경 시 startDate와 endDate 갱신
        //     updatePeriodInputs(); // 연도 변경 시 기간 입력 필드 초기화
        // });

        // 연도를 로드하고 기존 UI를 업데이트
        function loadYearlyData() {
            fetch('/api/gene/upload/distinctYears')
                .then(response => response.json())
                .then(years => {
                    const yearSelectTab1 = document.getElementById("yearSelectTab1");

                    // 기존 옵션 삭제
                    yearSelectTab1.innerHTML = '';

                    // 서버에서 가져온 연도 목록을 <option>으로 추가
                    years.forEach(year => {
                        const option = document.createElement('option');
                        option.value = year;
                        option.textContent = year;
                        yearSelectTab1.appendChild(option);
                    });
                })
                .catch(error => console.error('Error loading years:', error));
        }


        // 시간 옵션 생성 함수
        function generateHourOptions(isEnd = false) {
            return Array.from({length: 24}, (_, i) => {
                const hour = (i + 1).toString().padStart(2, '0');
                return `<option value="${hour}"${isEnd && hour === '24' || !isEnd && hour === '01' ? ' selected' : ''}>${hour}</option>`;
            }).join('');
        }

        //     ============================================================================================================

        // tab4 관련 함수

        // Tab4 초기 데이터를 로드
        function loadInitialDataTab2() {
            // 발전기명 목록을 로드한 후 초기 값 설정
            loadGeneratorNames(function () {
                const generatorSelect = document.getElementById("genename2");
                if (generatorSelect.options.length > 0) {
                    // kt대구물류센터 연료전지를 기본값으로 설정 -> 수정해
                    const ktDaeguOption = Array.from(generatorSelect.options).find(option => option.text === "kt대구물류센터 연료전지");
                    if (ktDaeguOption) {
                        generatorSelect.value = ktDaeguOption.value;
                    } else {
                        generatorSelect.value = generatorSelect.options[0].value;
                    }
                }

                // 현재 연도 및 이전 연도 계산
                const currentYear = new Date().getFullYear();
                const lastYear = currentYear - 1;

                // 기본 연도 및 비교 유형 설정
                document.getElementById("comparisonType").value = "YoY";
                document.getElementById("startDateTab2").value = lastYear.toString();
                document.getElementById("endDateTab2").value = currentYear.toString();

                // 초기 데이터 로드 및 차트 생성
                searchDataTab2();
            });
        }

        // 연도 데이터
        function loadYearlyDataTab2() {
            fetch('/api/gene/upload/distinctYears')
                .then(response => response.json())
                .then(years => {
                    const startDateTab2 = document.getElementById("startDateTab2");
                    const endDateTab2 = document.getElementById("endDateTab2");

                    // 기존 옵션 삭제
                    startDateTab2.innerHTML = '';
                    endDateTab2.innerHTML = '';

                    // 서버에서 가져온 연도 목록을 <option>으로 추가
                    years.forEach(year => {
                        const optionStart = document.createElement('option');
                        optionStart.value = year;
                        optionStart.textContent = year;
                        startDateTab2.appendChild(optionStart);

                        const optionEnd = document.createElement('option');
                        optionEnd.value = year;
                        optionEnd.textContent = year;
                        endDateTab2.appendChild(optionEnd);
                    });
                })
                .catch(error => console.error('Error loading years for Tab2:', error));
        }

        // MoM 선택시, 월 선택 셀렉트 생성
        function createMonthSelect(id) {
            const monthSelect = document.createElement('select');
            monthSelect.id = id;
            monthSelect.name = id;
            monthSelect.style.width = '70px';

            const months = [
                "01", "02", "03", "04", "05", "06",
                "07", "08", "09", "10", "11", "12"
            ];

            months.forEach(month => {
                const option = document.createElement('option');
                option.value = month;
                option.textContent = `${month}월`;
                monthSelect.appendChild(option);
            });

            return monthSelect;
        }

        // 비교유형 변경 시 실행될 함수
        function updateComparisonType() {
            const comparisonType = document.getElementById("comparisonType").value;
            const startDateContainerTab2 = document.getElementById("startDateContainerTab2");
            const endDateContainerTab2 = document.getElementById("endDateContainerTab2");

            // 기존 월 선택 셀렉트를 제거
            const existingStartMonthSelect = document.getElementById("startMonthTab2");
            const existingEndMonthSelect = document.getElementById("endMonthTab2");

            if (existingStartMonthSelect) startDateContainerTab2.removeChild(existingStartMonthSelect);
            if (existingEndMonthSelect) endDateContainerTab2.removeChild(existingEndMonthSelect);

            // "MoM"이 선택된 경우에만 새로운 월 셀렉트 추가
            if (comparisonType === "MoM") {
                const startMonthSelect = createMonthSelect("startMonthTab2");
                const endMonthSelect = createMonthSelect("endMonthTab2");

                // 첫 번째 셀렉트가 변경될 때 두 번째 셀렉트도 동일한 값으로 설정
                startMonthSelect.addEventListener("change", function () {
                    endMonthSelect.value = startMonthSelect.value;
                });

                startDateContainerTab2.appendChild(startMonthSelect);
                endDateContainerTab2.appendChild(endMonthSelect);
            }
        }

        function searchDataTab2() {
            const comparisonType = document.getElementById("comparisonType").value;
            let startDate = document.getElementById("startDateTab2").value;
            let endDate = document.getElementById("endDateTab2").value;
            const generator = document.getElementById("genename2").value; // 발전기명 선택

            // comparisonType에 따라 다른 API 엔드포인트로 요청을 보냄
            let query;

            if (comparisonType === "YoY") {
                // YoY의 경우, startDate와 endDate는 연도 형식이어야 함
                startDate = startDate.split("-")[0]; // 연도만 추출
                endDate = endDate.split("-")[0]; // 연도만 추출
                query = `/api/genesearch/comparison/yoy?powerid=${generator}&startYear=${startDate}&endYear=${endDate}`;
            } else if (comparisonType === "QoQ") {
                // QoQ의 경우, startDate와 endDate는 연도 형식이어야 함
                startDate = startDate.split("-")[0]; // 연도만 추출
                endDate = endDate.split("-")[0]; // 연도만 추출
                query = `/api/genesearch/comparison/qoq?powerid=${generator}&startYear=${startDate}&endYear=${endDate}`;
            } else if (comparisonType === "MoM") {
                // MoM의 경우, startDate와 endDate는 월 형식이어야 함
                startDate = startDate.split("-")[1]; // 월만 추출
                endDate = endDate.split("-")[1]; // 월만 추출
                query = `/api/genesearch/comparison/mom?powerid=${generator}&startMonth=${startDate}&endMonth=${endDate}`;
            } else if (comparisonType === "YTD") {
                query = `/api/genesearch/comparison/ytd?powerid=${generator}&startYear=${startDate}&endYear=${endDate}`;
            }

            fetch(query)
                .then(response => response.json())
                .then(data => {
                    if (data.length === 0) {
                        Alert.alert("", "데이터가 존재하지 않습니다.");
                    } else {
                        updateGridTab2(theGrid4, data, comparisonType);
                        chartReadyHandler2("chart2", "chartHolder2", data, comparisonType); // 비교 유형 전달
                    }
                })
                .catch(error => console.error('Error fetching search data:', error));
        }

        // function updateChartTab2(data) {
        //     chartReadyHandler2("chart2", "chartHolder2", data);
        // }

        // Tab4 그리드 업데이트
        // function updateGridTab2(grid, data, comparisonType) {
        //     const columns = buildGridColumnsTab2(data, comparisonType);
        //     const transformedData = transformDataForGridTab2(data, comparisonType);
        //
        //     grid.initialize({
        //         autoGenerateColumns: false,
        //         columns: columns,
        //         itemsSource: new wijmo.collections.CollectionView(transformedData),
        //         // itemsSource: new wijmo.collections.CollectionView(data),
        //         showMarquee: true,
        //         isReadOnly: true,
        //         headersVisibility: wijmo.grid.HeadersVisibility.Column
        //     });
        //
        //     // 이전 데이터를 완전히 초기화 후 새 데이터 적용
        //     grid.itemsSource = new wijmo.collections.CollectionView(transformedData);
        //
        //     grid.formatItem.addHandler((s, e) => {
        //         if (e.panel === s.columnHeaders) {
        //             e.cell.style.textAlign = 'center';
        //         }
        //     });
        //
        //     // 그리드 데이터를 차트에 전달하여 슬라이드 차트를 업데이트
        //     chartReadyHandler2("chart2", "chartHolder2", transformedData);
        // }

        // ===================================================================================================
        // 0919 하드코딩

        // 해당 탭에서 현황 탭 누른 상태에서 다른 탭 이동 후 다시 해당 탭 돌아와서 통계 탭 클릭 시 차트 안나타날때
        $(".tab-links-sub a").click(function (event) {
            event.preventDefault();

            var tabId = $(this).attr("href");
            $(this).closest('.tab-section').find('.tab-item-sub').hide(); // 모든 탭 내용 숨기기
            $(tabId).show(); // 선택한 탭 내용 보여주기
            $(this).closest('.tab-links-sub').find('li').removeClass('active'); // 모든 탭 버튼 비활성화
            $(this).parent().addClass('active'); // 선택한 탭 버튼 활성화

            // 현재 선택된 메인 탭(tab4 또는 tab5)에 따라 차트 다시 로드
            var currentMainTab = $(".tab-links li.active a").attr("href");

            if (currentMainTab === "#tab4") {
                // 기간별 조회 (tab4)
                if (tabId.includes('tab4_1') || tabId.includes('tab4_3') || tabId.includes('tab4_5') || tabId.includes('tab4_7')) {
                    showTab4Charts(); // 기간별 조회 차트 리사이즈 및 렌더링
                }
            } else if (currentMainTab === "#tab5") {
                // 기간별 대비 (tab5)
                if (tabId.includes('tab5_1') || tabId.includes('tab5_3') || tabId.includes('tab5_5') || tabId.includes('tab5_7')) {
                    showTab5Charts(); // 기간별 대비 차트 리사이즈 및 렌더링
                }
            }
        });

        function showTab4Charts() {
            // tab4의 모든 차트 리사이즈 및 렌더링
            for (let i = 1; i <= 4; i++) {
                let chartId = "chart4_" + i;
                if (typeof window["chartReadyHandler4_" + i] === "function") {
                    window["chartReadyHandler4_" + i](chartId);
                }
                resizeChart(chartId);
            }
        }

        function showTab5Charts() {
            // tab5의 모든 차트 리사이즈 및 렌더링
            for (let i = 1; i <= 4; i++) {
                let chartId = "chart5_" + i;
                if (typeof window["chartReadyHandler5_" + i] === "function") {
                    window["chartReadyHandler5_" + i](chartId);
                }
                resizeChart(chartId);
            }
        }

        function resizeChart(chartId) {
            var chart = document.getElementById(chartId);
            if (chart && typeof chart.resize === 'function') {
                chart.resize();
            }
        }



        // tab3

        // tab3 차트 초기화 함수
        function initTab3Chart() {
            rMateChartH5.create("chart3", "chartHolder3", "rMateOnLoadCallFunction=chartReadyHandler3", "100%", "100%");
        }

        // tab3 그리드 초기화 함수
        function initTab3Grid(){
            initGrid3();
        }

        // tab3 차트 데이터 설정 함수
        function chartReadyHandler3(id) {
            var chartData = [
                {Hour: "01시", KT대구물류센터: 651000, KT대덕2연구센터: 835000},
                {Hour: "02시", KT대구물류센터: 660000, KT대덕2연구센터: 820000},
                {Hour: "03시", KT대구물류센터: 645000, KT대덕2연구센터: 840000},
                {Hour: "04시", KT대구물류센터: 655000, KT대덕2연구센터: 830000},
                {Hour: "05시", KT대구물류센터: 670000, KT대덕2연구센터: 815000},
                {Hour: "06시", KT대구물류센터: 680000, KT대덕2연구센터: 825000},
                {Hour: "07시", KT대구물류센터: 690000, KT대덕2연구센터: 845000},
                {Hour: "08시", KT대구물류센터: 675000, KT대덕2연구센터: 850000},
                {Hour: "09시", KT대구물류센터: 665000, KT대덕2연구센터: 835000},
                {Hour: "10시", KT대구물류센터: 655000, KT대덕2연구센터: 820000},
                {Hour: "11시", KT대구물류센터: 670000, KT대덕2연구센터: 830000},
                {Hour: "12시", KT대구물류센터: 685000, KT대덕2연구센터: 845000},
                {Hour: "13시", KT대구물류센터: 695000, KT대덕2연구센터: 855000},
                {Hour: "14시", KT대구물류센터: 680000, KT대덕2연구센터: 840000},
                {Hour: "15시", KT대구물류센터: 665000, KT대덕2연구센터: 825000},
                {Hour: "16시", KT대구물류센터: 650000, KT대덕2연구센터: 815000},
                {Hour: "17시", KT대구물류센터: 660000, KT대덕2연구센터: 830000},
                {Hour: "18시", KT대구물류센터: 675000, KT대덕2연구센터: 850000},
                {Hour: "19시", KT대구물류센터: 685000, KT대덕2연구센터: 860000},
                {Hour: "20시", KT대구물류센터: 670000, KT대덕2연구센터: 840000},
                {Hour: "21시", KT대구물류센터: 655000, KT대덕2연구센터: 825000},
                {Hour: "22시", KT대구물류센터: 645000, KT대덕2연구센터: 815000},
                {Hour: "23시", KT대구물류센터: 650000, KT대덕2연구센터: 830000},
                {Hour: "24시", KT대구물류센터: 660000, KT대덕2연구센터: 845000}
            ];

            var layoutStr = `
<rMateChart backgroundColor="#FFFFFF" borderStyle="none">
    <Options>
        <Legend />
    </Options>
    <Line2DChart showDataTips="true">
        <horizontalAxis>
            <CategoryAxis categoryField="Hour" />
        </horizontalAxis>
        <verticalAxis>
            <LinearAxis minimum="600000" maximum="900000" interval="50000"/>
        </verticalAxis>
        <series>
            <Line2DSeries yField="KT대구물류센터" displayName="KT대구물류센터 연료전지" itemRenderer="CircleItemRenderer">
                <lineStroke>
                    <Stroke color="#ffa336" weight="2"/>
                </lineStroke>
            </Line2DSeries>
            <Line2DSeries yField="KT대덕2연구센터" displayName="KT대덕2연구센터 연료전지" itemRenderer="CircleItemRenderer">
                <lineStroke>
                    <Stroke color="#909bff" weight="2"/>
                </lineStroke>
            </Line2DSeries>
        </series>
    </Line2DChart>
</rMateChart>
`;

            var chart = document.getElementById(id);
            chart.setLayout(layoutStr);
            chart.setData(chartData);
        }

        // tab3 그리드 초기화 및 데이터 설정 함수
        function initGrid3() {
            var gridData = [
                {
                    rownum: 1,
                    standdt: '2024-08-01',
                    powerid: 'AJ38',
                    powernm: 'KT대구물류센터 연료전지',
                    chargedv: '충전',
                    mevalue01: 651565,
                    mevalue02: 651565,
                    mevalue03: 649396,
                    mevalue04: 649396,
                    mevalue05: 649396,
                    mevalue06: 649396,
                    mevalue07: 648673,
                    mevalue08: 649396,
                    mevalue09: 650119,
                    mevalue10: 648673,
                    mevalue11: 651565,
                    mevalue12: 648673,
                    mevalue13: 649396,
                    mevalue14: 649396,
                    mevalue15: 650119,
                    mevalue16: 651565,
                    mevalue17: 649396,
                    mevalue18: 649396,
                    mevalue19: 650119,
                    mevalue20: 651565,
                    mevalue21: 649396,
                    mevalue22: 650119,
                    mevalue23: 651565,
                    mevalue24: 650119,
                    mevaluet: 15612900,
                    indatem: '2024-09-20',
                    inusernm: '홍길동',
                    updatem: '2024-09-10'
                },
                {
                    rownum: 2,
                    standdt: '2024-08-01',
                    powerid: 'A373',
                    powernm: 'KT대덕2연구센터 연료전지',
                    chargedv: '방전',
                    mevalue01: 835200,
                    mevalue02: 834480,
                    mevalue03: 835200,
                    mevalue04: 835200,
                    mevalue05: 835200,
                    mevalue06: 836640,
                    mevalue07: 835920,
                    mevalue08: 835920,
                    mevalue09: 835200,
                    mevalue10: 835200,
                    mevalue11: 834480,
                    mevalue12: 834480,
                    mevalue13: 834480,
                    mevalue14: 834480,
                    mevalue15: 834480,
                    mevalue16: 835200,
                    mevalue17: 834480,
                    mevalue18: 833760,
                    mevalue19: 834480,
                    mevalue20: 833760,
                    mevalue21: 833760,
                    mevalue22: 833760,
                    mevalue23: 834480,
                    mevalue24: 835200,
                    mevaluet: 20030000,
                    indatem: '2024-09-20',
                    inusernm: '김철수',
                    updatem: ''
                }
            ];

            theGrid3 = new wijmo.grid.FlexGrid('#theGrid3', {
                autoGenerateColumns: false,
                showMarquee: true,
                isReadOnly: true,
                columns: [
                    {binding: 'rownum', header: 'NO', width: 65, align: 'center'},
                    {binding: 'standdt', header: '일자', width: 115, align: 'center'},
                    {binding: 'powerid', header: '발전기코드', width: 100, align: 'center'},
                    {binding: 'powernm', header: '발전기명', width: 200, align: 'center'},
                    {binding: 'chargedv', header: '충전/방전', width: 100, align: 'center'},
                    {binding: 'mevalue01', header: '01시', width: 90, format: 'n0'},
                    {binding: 'mevalue02', header: '02시', width: 90, format: 'n0'},
                    {binding: 'mevalue03', header: '03시', width: 90, format: 'n0'},
                    {
                        binding: 'toggle',
                        header: '...',
                        width: 90,
                        format: 'n0',
                        allowSorting: false
                    },
                    {binding: 'mevalue04', header: '04시', width: 90, format: 'n0'},
                    {binding: 'mevalue05', header: '05시', width: 90, format: 'n0'},
                    {binding: 'mevalue06', header: '06시', width: 90, format: 'n0'},
                    {binding: 'mevalue07', header: '07시', width: 90, format: 'n0'},
                    {binding: 'mevalue08', header: '08시', width: 90, format: 'n0'},
                    {binding: 'mevalue09', header: '09시', width: 90, format: 'n0'},
                    {binding: 'mevalue10', header: '10시', width: 90, format: 'n0'},
                    {binding: 'mevalue11', header: '11시', width: 90, format: 'n0'},
                    {binding: 'mevalue12', header: '12시', width: 90, format: 'n0'},
                    {binding: 'mevalue13', header: '13시', width: 90, format: 'n0'},
                    {binding: 'mevalue14', header: '14시', width: 90, format: 'n0'},
                    {binding: 'mevalue15', header: '15시', width: 90, format: 'n0'},
                    {binding: 'mevalue16', header: '16시', width: 90, format: 'n0'},
                    {binding: 'mevalue17', header: '17시', width: 90, format: 'n0'},
                    {binding: 'mevalue18', header: '18시', width: 90, format: 'n0'},
                    {binding: 'mevalue19', header: '19시', width: 90, format: 'n0'},
                    {binding: 'mevalue20', header: '20시', width: 90, format: 'n0'},
                    {binding: 'mevalue21', header: '21시', width: 90, format: 'n0'},
                    {binding: 'mevalue22', header: '22시', width: 90, format: 'n0'},
                    {binding: 'mevalue23', header: '23시', width: 90, format: 'n0'},
                    {binding: 'mevalue24', header: '24시', width: 90, format: 'n0'},
                    {binding: 'mevaluet', header: '합계', width: 110, format: 'n0'},
                    {binding: 'indatem', header: '등록일자', width:115, align: 'center'},
                    {binding: 'inusernm', header: '등록자', width: 100, align: 'center'},
                    {binding: 'updatem', header: '최종수정일', width: 121, align: 'center'}
                ],
                itemsSource: gridData
            });
            theGrid3.rowHeaders.columns.splice(0, 1); // 맨 앞에 헤더부분 없애기
            initializeColumnToggle(theGrid3); // 컬럼 숨기기 초기화 함수 호출
        }

        // tab3 검색 함수 (실제 구현할때 수정하기)
        function searchDataTab3() {
            const periodType = document.getElementById("periodType").value;
            const startDate = document.getElementById("startDate").value;
            const endDate = document.getElementById("endDate").value;

            // 여기에 실제 검색 로직을 구현하기
            // API 호출이나 데이터 필터링 등을 수행

            // 더미 데이터로 차트와 그리드 업데이트 (임시)
            updateTab3ChartsAndGrids(periodType);
        }

        // tab3 차트와 그리드 업데이트 함수 (임시)
        function updateTab3ChartsAndGrids() {
            // 실제 데이터를 사용하여 차트와 그리드를 업데이트

            chartReadyHandler3("chart3");
            initGrid3();
        }


        // tab4

        // 차트 초기화 함수
        function initTab4Charts() {
            for (let i = 1; i <= 4; i++) {
                rMateChartH5.create("chart4_" + i, "chartHolder4_" + i, "rMateOnLoadCallFunction=chartReadyHandler4_" + i, "100%", "100%");
            }
        }

        // 그리드 초기화 함수
        function initTab4Grids() {
            for (let i = 1; i <= 4; i++) {
                initGrid4(i);
            }
        }

        // 차트 데이터 설정 함수
        function chartReadyHandler4_1(id) {
            var chartData = [
                { Month: "1월", "KT대구물류센터 연료전지": 1000, "KT대덕2연구센터연료전지": 800 },
                { Month: "2월", "KT대구물류센터 연료전지": 1500, "KT대덕2연구센터연료전지": 1200 },
                { Month: "3월", "KT대구물류센터 연료전지": 1200, "KT대덕2연구센터연료전지": 1000 },
                { Month: "4월", "KT대구물류센터 연료전지": 1800, "KT대덕2연구센터연료전지": 1500 },
                { Month: "5월", "KT대구물류센터 연료전지": 2000, "KT대덕2연구센터연료전지": 1700 },
                { Month: "6월", "KT대구물류센터 연료전지": 1700, "KT대덕2연구센터연료전지": 1400 },
                { Month: "7월", "KT대구물류센터 연료전지": 1900, "KT대덕2연구센터연료전지": 1600 },
                { Month: "8월", "KT대구물류센터 연료전지": 2200, "KT대덕2연구센터연료전지": 1800 },
                { Month: "9월", "KT대구물류센터 연료전지": 2100, "KT대덕2연구센터연료전지": 1700 },
                { Month: "10월", "KT대구물류센터 연료전지": 1800, "KT대덕2연구센터연료전지": 1500 },
                { Month: "11월", "KT대구물류센터 연료전지": 1600, "KT대덕2연구센터연료전지": 1300 },
                { Month: "12월", "KT대구물류센터 연료전지": 2300, "KT대덕2연구센터연료전지": 1900 }
            ];

            var layoutStr = `
    <rMateChart backgroundColor="#FFFFFF" borderStyle="none">
        <Options>
            <Legend />
        </Options>
        <Column2DChart showDataTips="true">
            <horizontalAxis>
                <CategoryAxis categoryField="Month" />
            </horizontalAxis>
            <series>
                <Column2DSeries yField="KT대구물류센터 연료전지" displayName="KT대구물류센터 연료전지" fill="#62b2fd">
                    <showDataEffect>
                        <SeriesInterpolate />
                    </showDataEffect>
                </Column2DSeries>
                <Column2DSeries yField="KT대덕2연구센터연료전지" displayName="KT대덕2연구센터연료전지" fill="#01dbab">
                    <showDataEffect>
                        <SeriesInterpolate />
                    </showDataEffect>
                </Column2DSeries>
            </series>
        </Column2DChart>
    </rMateChart>
    `;

            var chart = document.getElementById(id);
            chart.setLayout(layoutStr);
            chart.setData(chartData);
        }


        function chartReadyHandler4_2(id) {
            var chartData = [
                { Quarter: "1분기", "KT대구물류센터 연료전지": 3700, "KT대덕2연구센터연료전지": 3000 },
                { Quarter: "2분기", "KT대구물류센터 연료전지": 5500, "KT대덕2연구센터연료전지": 4600 },
                { Quarter: "3분기", "KT대구물류센터 연료전지": 6200, "KT대덕2연구센터연료전지": 5100 },
                { Quarter: "4분기", "KT대구물류센터 연료전지": 5700, "KT대덕2연구센터연료전지": 4700 }
            ];

            var layoutStr = `
    <rMateChart backgroundColor="#FFFFFF" borderStyle="none">
        <Options>
            <Legend />
        </Options>
        <Column2DChart showDataTips="true">
            <horizontalAxis>
                <CategoryAxis categoryField="Quarter" />
            </horizontalAxis>
            <series>
                <Column2DSeries yField="KT대구물류센터 연료전지" displayName="KT대구물류센터 연료전지" fill="#62b2fd">
                    <showDataEffect>
                        <SeriesInterpolate />
                    </showDataEffect>
                </Column2DSeries>
                <Column2DSeries yField="KT대덕2연구센터연료전지" displayName="KT대덕2연구센터연료전지" fill="#01dbab">
                    <showDataEffect>
                        <SeriesInterpolate />
                    </showDataEffect>
                </Column2DSeries>
            </series>
        </Column2DChart>
    </rMateChart>
    `;

            var chart = document.getElementById(id);
            chart.setLayout(layoutStr);
            chart.setData(chartData);
        }


        function chartReadyHandler4_3(id) {
            var chartData = [
                { Half: "상반기", "KT대구물류센터 연료전지": 9200, "KT대덕2연구센터연료전지": 7600 },
                { Half: "하반기", "KT대구물류센터 연료전지": 11900, "KT대덕2연구센터연료전지": 9800 }
            ];

            var layoutStr = `
    <rMateChart backgroundColor="#FFFFFF" borderStyle="none">
        <Options>
            <Legend />
        </Options>
        <Column2DChart showDataTips="true">
            <horizontalAxis>
                <CategoryAxis categoryField="Half" />
            </horizontalAxis>
            <series>
                <Column2DSeries yField="KT대구물류센터 연료전지" displayName="KT대구물류센터 연료전지" fill="#62b2fd">
                    <showDataEffect>
                        <SeriesInterpolate />
                    </showDataEffect>
                </Column2DSeries>
                <Column2DSeries yField="KT대덕2연구센터연료전지" displayName="KT대덕2연구센터연료전지" fill="#01dbab">
                    <showDataEffect>
                        <SeriesInterpolate />
                    </showDataEffect>
                </Column2DSeries>
            </series>
        </Column2DChart>
    </rMateChart>
    `;

            var chart = document.getElementById(id);
            chart.setLayout(layoutStr);
            chart.setData(chartData);
        }


        function chartReadyHandler4_4(id) {
            var chartData = [
                { Year: "2023년", "KT대구물류센터 연료전지": 21100, "KT대덕2연구센터연료전지": 17400 },
                { Year: "2024년", "KT대구물류센터 연료전지": 24000, "KT대덕2연구센터연료전지": 20000 }
            ];

            var layoutStr = `
    <rMateChart backgroundColor="#FFFFFF" borderStyle="none">
        <Options>
            <Legend />
        </Options>
        <Column2DChart showDataTips="true">
            <horizontalAxis>
                <CategoryAxis categoryField="Year" />
            </horizontalAxis>
            <series>
                <Column2DSeries yField="KT대구물류센터 연료전지" displayName="KT대구물류센터 연료전지" fill="#62b2fd">
                    <showDataEffect>
                        <SeriesInterpolate />
                    </showDataEffect>
                </Column2DSeries>
                <Column2DSeries yField="KT대덕2연구센터연료전지" displayName="KT대덕2연구센터연료전지" fill="#01dbab">
                    <showDataEffect>
                        <SeriesInterpolate />
                    </showDataEffect>
                </Column2DSeries>
            </series>
        </Column2DChart>
    </rMateChart>
    `;

            var chart = document.getElementById(id);
            chart.setLayout(layoutStr);
            chart.setData(chartData);
        }


        // 그리드 초기화 및 데이터 설정 함수
        function initGrid4(gridNumber) {
            // console.log("Grid data for grid", gridNumber, ":", data);
            let columns, gridData;
            const gridId = '#theGrid4_' + gridNumber;

            switch (gridNumber) {
                case 1: // 월별 데이터
                    columns = [
                        {binding: 'Month', header: '월', width: 100, align: 'center'},
                        {binding: 'KT대구물류센터 연료전지', header: 'KT대구물류센터 연료전지', width: '*', align: 'right'},
                        {binding: 'KT대덕2연구센터 연료전지', header: 'KT대덕2연구센터 연료전지', width: '*', align: 'right'}
                    ];
                    gridData = [
                        {Month: "1월", "KT대구물류센터 연료전지": 1000, "KT대덕2연구센터 연료전지": 800},
                        {Month: "2월", "KT대구물류센터 연료전지": 1500, "KT대덕2연구센터 연료전지": 1200},
                        {Month: "3월", "KT대구물류센터 연료전지": 1200, "KT대덕2연구센터 연료전지": 1000},
                        {Month: "4월", "KT대구물류센터 연료전지": 1800, "KT대덕2연구센터 연료전지": 1500},
                        {Month: "5월", "KT대구물류센터 연료전지": 2000, "KT대덕2연구센터 연료전지": 1700},
                        {Month: "6월", "KT대구물류센터 연료전지": 1700, "KT대덕2연구센터 연료전지": 1400},
                        {Month: "7월", "KT대구물류센터 연료전지": 1900, "KT대덕2연구센터 연료전지": 1600},
                        {Month: "8월", "KT대구물류센터 연료전지": 2200, "KT대덕2연구센터 연료전지": 1800},
                        {Month: "9월", "KT대구물류센터 연료전지": 2100, "KT대덕2연구센터 연료전지": 1700},
                        {Month: "10월", "KT대구물류센터 연료전지": 1800, "KT대덕2연구센터 연료전지": 1500},
                        {Month: "11월", "KT대구물류센터 연료전지": 1600, "KT대덕2연구센터 연료전지": 1300},
                        {Month: "12월", "KT대구물류센터 연료전지": 2300, "KT대덕2연구센터 연료전지": 1900}
                    ];
                    break;
                case 2: // 분기별 데이터
                    columns = [
                        {binding: 'Quarter', header: '분기', width: 100, align: 'center'},
                        {binding: 'KT대구물류센터 연료전지', header: 'KT대구물류센터 연료전지', width: '*', align: 'right'},
                        {binding: 'KT대덕2연구센터 연료전지', header: 'KT대덕2연구센터 연료전지', width: '*', align: 'right'}
                    ];
                    gridData = [
                        {Quarter: "1분기", "KT대구물류센터 연료전지": 3700, "KT대덕2연구센터 연료전지": 3000},
                        {Quarter: "2분기", "KT대구물류센터 연료전지": 5500, "KT대덕2연구센터 연료전지": 4600},
                        {Quarter: "3분기", "KT대구물류센터 연료전지": 6200, "KT대덕2연구센터 연료전지": 5100},
                        {Quarter: "4분기", "KT대구물류센터 연료전지": 5700, "KT대덕2연구센터 연료전지": 4700}
                    ];
                    break;
                case 3: // 반기별 데이터
                    columns = [
                        {binding: 'Half', header: '반기', width: 100, align: 'center'},
                        {binding: 'KT대구물류센터 연료전지', header: 'KT대구물류센터 연료전지', width: '*', align: 'right'},
                        {binding: 'KT대덕2연구센터 연료전지', header: 'KT대덕2연구센터 연료전지', width: '*', align: 'right'}
                    ];
                    gridData = [
                        {Half: "상반기", "KT대구물류센터 연료전지": 9200, "KT대덕2연구센터 연료전지": 7600},
                        {Half: "하반기", "KT대구물류센터 연료전지": 11900, "KT대덕2연구센터 연료전지": 9800}
                    ];
                    break;
                case 4: // 연도별 데이터
                    columns = [
                        {binding: 'Year', header: '연도', width: 100, align: 'center'},
                        {binding: 'KT대구물류센터 연료전지', header: 'KT대구물류센터 연료전지', width: '*', align: 'right'},
                        {binding: 'KT대덕2연구센터 연료전지', header: 'KT대덕2연구센터 연료전지', width: '*', align: 'right'}
                    ];
                    gridData = [
                        {Year: "2023년", "KT대구물류센터 연료전지": 21100, "KT대덕2연구센터 연료전지": 17400},
                        {Year: "2024년", "KT대구물류센터 연료전지": 24000, "KT대덕2연구센터 연료전지": 20000}
                    ];
                    break;
            }

            let viewdata = new wijmo.collections.CollectionView(gridData);
            let grid = new wijmo.grid.FlexGrid(gridId, {
                autoGenerateColumns: false,
                showMarquee: true,
                columns: columns,
                itemsSource: viewdata,
                isReadOnly: true
            });

            // 맨 앞에 헤더부분 없애기
            grid.rowHeaders.columns.splice(0, 1);
        }

        // 검색 기능 구현 (임시)
        function searchDataTab4() {
            const periodType = document.getElementById("periodType").value;
            const startDate = document.getElementById("startDate").value;
            const endDate = document.getElementById("endDate").value;

            // 여기에 실제 검색 로직을 구현하기
            // API 호출이나 데이터 필터링 등을 수행

            // 더미 데이터로 차트와 그리드 업데이트 (임시)
            updateTab4ChartsAndGrids(periodType);
        }

        // 차트와 그리드 업데이트 함수 (임시)
        function updateTab4ChartsAndGrids(periodType) {
            // 실제 데이터를 사용하여 차트와 그리드를 업데이트

            switch (periodType) {
                case "monthly":
                    chartReadyHandler4_1("chart4_1");
                    initGrid4(1);
                    break;
                case "quarterly":
                    chartReadyHandler4_2("chart4_2");
                    initGrid4(2);
                    break;
                case "halfyearly":
                    chartReadyHandler4_3("chart4_3");
                    initGrid4(3);
                    break;
                case "yearly":
                    chartReadyHandler4_4("chart4_4");
                    initGrid4(4);
                    break;
            }
        }

        // tab5
        // 차트 초기화 함수
        function initTab5Charts() {
            for (let i = 1; i <= 4; i++) {
                rMateChartH5.create("chart5_" + i, "chartHolder5_" + i, "rMateOnLoadCallFunction=chartReadyHandler5_" + i, "100%", "100%");
            }
        }

        // 그리드 초기화 함수
        function initTab5Grids() {
            for (let i = 1; i <= 4; i++) {
                initGrid5(i);
            }
        }

        // 차트 데이터 설정 함수

        // 1. YoY 차트
        function chartReadyHandler5_1(id) {
            var chartData = [
                { Month: "1월", "2023년": 1000, "2024년": 800 },
                { Month: "2월", "2023년": 1500, "2024년": 1200 },
                { Month: "3월", "2023년": 1200, "2024년": 1000 },
                { Month: "4월", "2023년": 1800, "2024년": 1500 },
                { Month: "5월", "2023년": 2000, "2024년": 1700 },
                { Month: "6월", "2023년": 1700, "2024년": 1400 },
                { Month: "7월", "2023년": 1900, "2024년": 1600 },
                { Month: "8월", "2023년": 2200, "2024년": 1800 },
                { Month: "9월", "2023년": 2100, "2024년": 1700 },
                { Month: "10월", "2023년": 1800, "2024년": 1500 },
                { Month: "11월", "2023년": 1600, "2024년": 1300 },
                { Month: "12월", "2023년": 2300, "2024년": 1900 }
            ];

            var layoutStr = `
    <rMateChart backgroundColor="#FFFFFF" borderStyle="none">
        <Options>
            <Legend />
        </Options>
        <Line2DChart showDataTips="true">
            <horizontalAxis>
                <CategoryAxis categoryField="Month" />
            </horizontalAxis>
            <series>
                <Line2DSeries yField="2023년" displayName="2023년" itemRenderer="CircleItemRenderer">
                    <lineStroke>
                        <Stroke color="#ffa336" weight="2"/>
                    </lineStroke>
                </Line2DSeries>
                <Line2DSeries yField="2024년" displayName="2024년" itemRenderer="CircleItemRenderer">
                    <lineStroke>
                        <Stroke color="#909bff" weight="2"/>
                    </lineStroke>
                </Line2DSeries>
            </series>
        </Line2DChart>
    </rMateChart>
    `;

            var chart = document.getElementById(id);
            chart.setLayout(layoutStr);
            chart.setData(chartData);
        }

        // 2. QoQ 차트
        function chartReadyHandler5_2(id) {
            var chartData = [
                { Quarter: "1분기", "2023년": 3700, "2024년": 3000 },
                { Quarter: "2분기", "2023년": 5500, "2024년": 4600 },
                { Quarter: "3분기", "2023년": 6200, "2024년": 5100 },
                { Quarter: "4분기", "2023년": 5700, "2024년": 4700 }
            ];

            var layoutStr = `
    <rMateChart backgroundColor="#FFFFFF" borderStyle="none">
        <Options>
            <Legend />
        </Options>
        <Line2DChart showDataTips="true">
            <horizontalAxis>
                <CategoryAxis categoryField="Quarter" />
            </horizontalAxis>
            <series>
                <Line2DSeries yField="2023년" displayName="2023년" itemRenderer="CircleItemRenderer">
                    <lineStroke>
                        <Stroke color="#ffa336" weight="2"/>
                    </lineStroke>
                </Line2DSeries>
                <Line2DSeries yField="2024년" displayName="2024년" itemRenderer="CircleItemRenderer">
                    <lineStroke>
                        <Stroke color="#909bff" weight="2"/>
                    </lineStroke>
                </Line2DSeries>
            </series>
        </Line2DChart>
    </rMateChart>
    `;

            var chart = document.getElementById(id);
            chart.setLayout(layoutStr);
            chart.setData(chartData);
        }

        // 3. MoM 차트
        function chartReadyHandler5_3(id) {
            var chartData = [
                // MoM 데이터는 필요에 따라 수정 가능합니다.
                { Month: "1월", "2023년": 1000, "2024년": 1100 },
                { Month: "2월", "2023년": 1500, "2024년": 1600 },
                { Month: "3월", "2023년": 1200, "2024년": 1300 },
                { Month: "4월", "2023년": 1800, "2024년": 1900 },
                { Month: "5월", "2023년": 2000, "2024년": 2100 },
                { Month: "6월", "2023년": 1700, "2024년": 1800 },
                { Month: "7월", "2023년": 1900, "2024년": 2000 },
                { Month: "8월", "2023년": 2200, "2024년": 2300 },
                { Month: "9월", "2023년": 2100, "2024년": 2200 },
                { Month: "10월", "2023년": 1800, "2024년": 1900 },
                { Month: "11월", "2023년": 1600, "2024년": 1700 },
                { Month: "12월", "2023년": 2300, "2024년": 2400 }
            ];

            var layoutStr = `
    <rMateChart backgroundColor="#FFFFFF" borderStyle="none">
        <Options>
            <Legend />
        </Options>
        <Line2DChart showDataTips="true">
            <horizontalAxis>
                <CategoryAxis categoryField="Month" />
            </horizontalAxis>
            <series>
                <Line2DSeries yField="2023년" displayName="2023년" itemRenderer="CircleItemRenderer">
                    <lineStroke>
                        <Stroke color="#ffa336" weight="2"/>
                    </lineStroke>
                </Line2DSeries>
                <Line2DSeries yField="2024년" displayName="2024년" itemRenderer="CircleItemRenderer">
                    <lineStroke>
                        <Stroke color="#909bff" weight="2"/>
                    </lineStroke>
                </Line2DSeries>
            </series>
        </Line2DChart>
    </rMateChart>
    `;

            var chart = document.getElementById(id);
            chart.setLayout(layoutStr);
            chart.setData(chartData);
        }

        // 4. YTD 차트
        function chartReadyHandler5_4(id) {
            var chartData = [
                { Month: "1월", "2023년": 1000, "2024년": 1100 },
                { Month: "2월", "2023년": 2500, "2024년": 2700 },
                { Month: "3월", "2023년": 3700, "2024년": 4000 },
                { Month: "4월", "2023년": 5500, "2024년": 5900 },
                { Month: "5월", "2023년": 7500, "2024년": 8000 },
                { Month: "6월", "2023년": 9200, "2024년": 9800 },
                { Month: "7월", "2023년": 11100, "2024년": 11800 },
                { Month: "8월", "2023년": 13300, "2024년": 14100 },
                { Month: "9월", "2023년": 15400, "2024년": 16300 },
                { Month: "10월", "2023년": 17200, "2024년": 18200 },
                { Month: "11월", "2023년": 18800, "2024년": 19900 },
                { Month: "12월", "2023년": 21100, "2024년": 22300 }
            ];

            var layoutStr = `
    <rMateChart backgroundColor="#FFFFFF" borderStyle="none">
        <Options>
            <Legend />
        </Options>
        <Line2DChart showDataTips="true">
            <horizontalAxis>
                <CategoryAxis categoryField="Month" />
            </horizontalAxis>
            <series>
                <Line2DSeries yField="2023년" displayName="2023년" itemRenderer="CircleItemRenderer">
                    <lineStroke>
                        <Stroke color="#ffa336" weight="2"/>
                    </lineStroke>
                </Line2DSeries>
                <Line2DSeries yField="2024년" displayName="2024년" itemRenderer="CircleItemRenderer">
                    <lineStroke>
                        <Stroke color="#909bff" weight="2"/>
                    </lineStroke>
                </Line2DSeries>
            </series>
        </Line2DChart>
    </rMateChart>
    `;

            var chart = document.getElementById(id);
            chart.setLayout(layoutStr);
            chart.setData(chartData);
        }

        // 그리드 초기화 및 데이터 설정 함수
        function initGrid5(gridNumber) {
            let columns, gridData;
            const gridId = '#theGrid5_' + gridNumber;

            switch (gridNumber) {
                case 1: // YoY
                    columns = [
                        {binding: 'Month', header: '월', width: 100, align: 'center'},
                        {binding: '2023년', header: '2023년', width: '*', align: 'right'},
                        {binding: '2024년', header: '2024년', width: '*', align: 'right'}
                    ];
                    gridData = [
                        { Month: "1월", "2023년": 1000, "2024년": 800 },
                        { Month: "2월", "2023년": 1500, "2024년": 1200 },
                        { Month: "3월", "2023년": 1200, "2024년": 1000 },
                        { Month: "4월", "2023년": 1800, "2024년": 1500 },
                        { Month: "5월", "2023년": 2000, "2024년": 1700 },
                        { Month: "6월", "2023년": 1700, "2024년": 1400 },
                        { Month: "7월", "2023년": 1900, "2024년": 1600 },
                        { Month: "8월", "2023년": 2200, "2024년": 1800 },
                        { Month: "9월", "2023년": 2100, "2024년": 1700 },
                        { Month: "10월", "2023년": 1800, "2024년": 1500 },
                        { Month: "11월", "2023년": 1600, "2024년": 1300 },
                        { Month: "12월", "2023년": 2300, "2024년": 1900 }
                    ];
                    break;
                case 2: // QoQ
                    columns = [
                        {binding: 'Quarter', header: '분기', width: 100, align: 'center'},
                        {binding: '2023년', header: '2023년', width: '*', align: 'right'},
                        {binding: '2024년', header: '2024년', width: '*', align: 'right'}
                    ];
                    gridData = [
                        { Quarter: "1분기", "2023년": 3700, "2024년": 3000 },
                        { Quarter: "2분기", "2023년": 5500, "2024년": 4600 },
                        { Quarter: "3분기", "2023년": 6200, "2024년": 5100 },
                        { Quarter: "4분기", "2023년": 5700, "2024년": 4700 }
                    ];
                    break;
                case 3: // MoM
                    columns = [
                        {binding: 'Month', header: '월', width: 100, align: 'center'},
                        {binding: '2023년', header: '2023년', width: '*', align: 'right'},
                        {binding: '2024년', header: '2024년', width: '*', align: 'right'}
                    ];
                    gridData = [
                        { Month: "1월", "2023년": 1000, "2024년": 1100 },
                        { Month: "2월", "2023년": 1500, "2024년": 1600 },
                        { Month: "3월", "2023년": 1200, "2024년": 1300 },
                        { Month: "4월", "2023년": 1800, "2024년": 1900 },
                        { Month: "5월", "2023년": 2000, "2024년": 2100 },
                        { Month: "6월", "2023년": 1700, "2024년": 1800 },
                        { Month: "7월", "2023년": 1900, "2024년": 2000 },
                        { Month: "8월", "2023년": 2200, "2024년": 2300 },
                        { Month: "9월", "2023년": 2100, "2024년": 2200 },
                        { Month: "10월", "2023년": 1800, "2024년": 1900 },
                        { Month: "11월", "2023년": 1600, "2024년": 1700 },
                        { Month: "12월", "2023년": 2300, "2024년": 2400 }
                    ];
                    break;
                case 4: // YTD
                    columns = [
                        {binding: 'Month', header: '월', width: 100, align: 'center'},
                        {binding: '2023년', header: '누적 2023년', width: '*', align: 'right'},
                        {binding: '2024년', header: '누적 2024년', width: '*', align: 'right'}
                    ];
                    gridData = [
                        { Month: "1월", "2023년": 1000, "2024년": 1100 },
                        { Month: "2월", "2023년": 2500, "2024년": 2700 },
                        { Month: "3월", "2023년": 3700, "2024년": 4000 },
                        { Month: "4월", "2023년": 5500, "2024년": 5900 },
                        { Month: "5월", "2023년": 7500, "2024년": 8000 },
                        { Month: "6월", "2023년": 9200, "2024년": 9800 },
                        { Month: "7월", "2023년": 11100, "2024년": 11800 },
                        { Month: "8월", "2023년": 13300, "2024년": 14100 },
                        { Month: "9월", "2023년": 15400, "2024년": 16300 },
                        { Month: "10월", "2023년": 17200, "2024년": 18200 },
                        { Month: "11월", "2023년": 18800, "2024년": 19900 },
                        { Month: "12월", "2023년": 21100, "2024년": 22300 }
                    ];
                    break;
            }

            let viewdata = new wijmo.collections.CollectionView(gridData);
            let grid = new wijmo.grid.FlexGrid(gridId, {
                autoGenerateColumns: false,
                showMarquee: true,
                columns: columns,
                itemsSource: viewdata,
                isReadOnly: true
            });

            // 맨 앞에 헤더부분 없애기
            grid.rowHeaders.columns.splice(0, 1);
        }

    </script>
</th:block>

</html>